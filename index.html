<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Renova - Revolução Matemática</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@300;400;600;700&family=Cinzel:wght@400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- MathJax para renderizar fórmulas LaTeX -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Toast notifications -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    
    <style>
        /* VARIÁVEIS DE CORES E ESTILOS */
        :root {
            --primary-dark: #0a0a0f;
            --secondary-dark: #121218;
            --tertiary-dark: #1a1a24;
            --accent-purple: #6a0dad;
            --accent-blue: #0d6efd;
            --accent-teal: #20c997;
            --accent-red: #dc3545;
            --accent-gold: #ffd700;
            --text-primary: #f8f9fa;
            --text-secondary: #adb5bd;
            --border-color: #2d2d3a;
            --shadow-color: rgba(106, 13, 173, 0.2);
            --font-mono: 'Source Code Pro', monospace;
            --font-decorative: 'Cinzel', serif;
            --font-tech: 'Orbitron', sans-serif;
        }

        /* RESET E ESTILOS GERAIS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-mono);
            background-color: var(--primary-dark);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(106, 13, 173, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(13, 110, 253, 0.05) 0%, transparent 20%);
        }

        a {
            color: var(--accent-teal);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--accent-blue);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* SIDEBAR */
        .sidebar {
            width: 250px;
            background-color: var(--secondary-dark);
            border-right: 1px solid var(--border-color);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.3);
        }

        .logo-container {
            text-align: center;
            padding: 20px 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .logo {
            font-family: var(--font-decorative);
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-purple);
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo-symbol {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--accent-gold);
        }

        .logo-subtitle {
            font-size: 0.7rem;
            color: var(--text-secondary);
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .user-info {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
            position: relative;
        }

        .user-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin: 0 auto 10px;
            border: 2px solid var(--accent-teal);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-avatar-upload {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.7);
            color: white;
            text-align: center;
            padding: 5px;
            font-size: 0.7rem;
            display: none;
        }

        .user-avatar:hover .user-avatar-upload {
            display: block;
        }

        #avatar-upload {
            display: none;
        }

        .user-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .user-level {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            background-color: var(--accent-purple);
            color: white;
            margin-top: 5px;
        }

        .level-observador {
            background-color: #6c757d;
        }

        .level-iniciado {
            background-color: #198754;
        }

        .level-nucleo {
            background-color: var(--accent-red);
        }

        .nav-menu {
            list-style: none;
            padding: 0 15px;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            background-color: var(--tertiary-dark);
            color: var(--text-primary);
        }

        .nav-link i {
            margin-right: 10px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .nav-section {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 20px 0 10px;
            padding-left: 15px;
        }

        .notification-badge {
            background-color: var(--accent-red);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            margin-left: auto;
            cursor: pointer;
        }

        /* CONTEÚDO PRINCIPAL */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .page-title {
            font-family: var(--font-decorative);
            font-size: 2rem;
            color: var(--accent-teal);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            background-color: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 15px 8px 40px;
            color: var(--text-primary);
            width: 250px;
            font-family: var(--font-mono);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .notification-btn, .logout-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: color 0.3s;
            position: relative;
        }

        .notification-btn:hover, .logout-btn:hover {
            color: var(--text-primary);
        }

        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent-red);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* DASHBOARD */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background-color: var(--secondary-dark);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px var(--shadow-color);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--accent-teal);
        }

        .card-icon {
            font-size: 1.5rem;
            color: var(--accent-purple);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--tertiary-dark);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border-left: 4px solid var(--accent-purple);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-teal);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .recent-activities {
            list-style: none;
        }

        .activity-item {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .activity-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px 10px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--tertiary-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: var(--accent-blue);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-family: var(--font-mono);
            font-size: 0.95rem;
        }

        .btn-primary {
            background-color: var(--accent-purple);
            color: white;
        }

        .btn-primary:hover {
            background-color: #5a0a9c;
        }

        .btn-secondary {
            background-color: var(--tertiary-dark);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--border-color);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        /* MODAIS */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--secondary-dark);
            border-radius: 15px;
            border: 1px solid var(--border-color);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            padding: 25px 30px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.8rem;
            font-family: var(--font-decorative);
            color: var(--accent-teal);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--accent-red);
        }

        .modal-body {
            padding: 25px 30px;
        }

        /* SEÇÕES DE CONTEÚDO */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.8rem;
            font-family: var(--font-decorative);
            color: var(--accent-teal);
        }

        .theories-list, .groups-list, .forum-topics {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .theory-card, .group-card, .topic-card {
            background-color: var(--secondary-dark);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .theory-card:hover, .group-card:hover, .topic-card:hover {
            border-color: var(--accent-purple);
            box-shadow: 0 5px 15px var(--shadow-color);
            transform: translateY(-3px);
        }

        .theory-header, .group-header, .topic-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .theory-title, .group-title, .topic-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .theory-author, .group-members, .topic-author {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .theory-status, .group-type, .topic-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-developing {
            background-color: rgba(32, 201, 151, 0.2);
            color: var(--accent-teal);
        }

        .status-published {
            background-color: rgba(13, 110, 253, 0.2);
            color: var(--accent-blue);
        }

        .status-archived {
            background-color: rgba(108, 117, 125, 0.2);
            color: var(--text-secondary);
        }

        .type-public {
            background-color: rgba(32, 201, 151, 0.2);
            color: var(--accent-teal);
        }

        .type-private {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--accent-red);
        }

        .type-restricted {
            background-color: rgba(255, 215, 0, 0.2);
            color: var(--accent-gold);
        }

        .theory-description, .group-description, .topic-description {
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .theory-meta, .group-meta, .topic-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        /* FORMULÁRIOS */
        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background-color: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* LOGIN PAGE */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--primary-dark);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(106, 13, 173, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(13, 110, 253, 0.1) 0%, transparent 40%);
        }

        .login-box {
            width: 100%;
            max-width: 450px;
            background-color: var(--secondary-dark);
            border-radius: 15px;
            border: 1px solid var(--border-color);
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo .logo {
            font-size: 2.2rem;
        }

        .login-title {
            text-align: center;
            font-family: var(--font-decorative);
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: var(--accent-teal);
        }

        .login-footer {
            text-align: center;
            margin-top: 30px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* CHAT */
        .chat-container {
            display: flex;
            height: 70vh;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            overflow: hidden;
        }

        .chat-sidebar {
            width: 250px;
            background-color: var(--tertiary-dark);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
        }

        .chat-group {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .chat-group:hover, .chat-group.active {
            background-color: rgba(106, 13, 173, 0.2);
        }

        .chat-group-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-right: 10px;
        }

        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 15px 20px;
            background-color: var(--secondary-dark);
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            margin-bottom: 15px;
            max-width: 70%;
            padding: 12px 15px;
            border-radius: 10px;
            position: relative;
            animation: messageAppear 0.3s ease;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-sent {
            align-self: flex-end;
            background-color: rgba(106, 13, 173, 0.3);
            border: 1px solid rgba(106, 13, 173, 0.5);
        }

        .message-received {
            align-self: flex-start;
            background-color: var(--tertiary-dark);
            border: 1px solid var(--border-color);
        }

        .message-sender {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--accent-teal);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message-sender-level {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            background-color: var(--accent-purple);
        }

        .message-content {
            line-height: 1.5;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: right;
            margin-top: 5px;
        }

        .chat-input-container {
            padding: 15px;
            background-color: var(--secondary-dark);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-input textarea {
            background-color: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            color: var(--text-primary);
            font-family: var(--font-mono);
            padding: 12px 15px;
            resize: none;
            min-height: 60px;
            max-height: 120px;
        }

        .chat-input-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .latex-preview {
            background-color: var(--tertiary-dark);
            border: 1px dashed var(--border-color);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            display: none;
        }

        .latex-preview.active {
            display: block;
        }

        /* TABELAS */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--tertiary-dark);
            font-weight: 600;
            color: var(--accent-teal);
        }

        tr:hover {
            background-color: rgba(255, 255, 255, 0.03);
        }

        /* RITO DE INICIAÇÃO */
        .initiation-container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .initiation-step {
            margin-bottom: 40px;
            padding: 30px;
            background-color: var(--secondary-dark);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .step-number {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent-purple);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .step-title {
            font-size: 1.4rem;
            color: var(--accent-teal);
            margin-bottom: 15px;
            font-family: var(--font-decorative);
        }

        /* NOTIFICAÇÕES */
        .notifications-modal .notification-item {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .notifications-modal .notification-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .notifications-modal .notification-item.unread {
            background-color: rgba(106, 13, 173, 0.1);
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--accent-teal);
        }

        .notification-time {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* RESPONSIVIDADE */
        @media (max-width: 1100px) {
            .sidebar {
                width: 70px;
                overflow-x: hidden;
            }
            
            .logo-text, .user-name, .user-level, .nav-section, .nav-text {
                display: none;
            }
            
            .logo-symbol {
                font-size: 2rem;
            }
            
            .nav-link {
                justify-content: center;
                padding: 15px;
            }
            
            .nav-link i {
                margin-right: 0;
                font-size: 1.4rem;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .search-box input {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .theories-list, .groups-list, .forum-topics {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .search-box input {
                width: 150px;
            }
            
            .chat-container {
                flex-direction: column;
                height: 80vh;
            }
            
            .chat-sidebar {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
        }

        /* ANIMAÇÕES E EFEITOS ESPECIAIS */
        .math-symbol {
            font-family: "Times New Roman", serif;
            font-style: italic;
        }

        .glowing-text {
            text-shadow: 0 0 5px var(--accent-purple), 0 0 10px rgba(106, 13, 173, 0.5);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(106, 13, 173, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(106, 13, 173, 0); }
            100% { box-shadow: 0 0 0 0 rgba(106, 13, 173, 0); }
        }

        .fractal-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.05;
            z-index: -1;
            background-image: 
                radial-gradient(circle at 20% 30%, var(--accent-purple) 0%, transparent 10%),
                radial-gradient(circle at 80% 70%, var(--accent-blue) 0%, transparent 10%),
                radial-gradient(circle at 40% 80%, var(--accent-teal) 0%, transparent 10%);
        }

        /* TOAST NOTIFICATIONS CUSTOM */
        .toast-success {
            background-color: var(--accent-teal) !important;
        }

        .toast-error {
            background-color: var(--accent-red) !important;
        }

        .toast-info {
            background-color: var(--accent-blue) !important;
        }

        .toast-warning {
            background-color: var(--accent-gold) !important;
            color: #000 !important;
        }

        /* DISCUSSÃO DETALHADA */
        .discussion-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .discussion-header {
            background-color: var(--secondary-dark);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .discussion-title {
            font-size: 1.8rem;
            color: var(--accent-teal);
            margin-bottom: 10px;
            font-family: var(--font-decorative);
        }

        .discussion-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .discussion-content {
            background-color: var(--secondary-dark);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            line-height: 1.8;
        }

        .discussion-replies {
            background-color: var(--secondary-dark);
            border-radius: 10px;
            padding: 25px;
            border: 1px solid var(--border-color);
        }

        .reply {
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .reply:last-child {
            border-bottom: none;
        }

        .reply-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .reply-author {
            font-weight: 600;
            color: var(--accent-teal);
        }

        .reply-time {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .reply-content {
            line-height: 1.6;
        }

        .reply-form {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <!-- TELA DE LOGIN (INICIAL) -->
    <div id="login-page" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <div class="logo">
                    <div class="logo-symbol">∞</div>
                    <div class="logo-text">ALGEBRA RENOVA</div>
                    <div class="logo-subtitle">Revolution. Algebra et Perseverantia.</div>
                </div>
            </div>
            
            <h2 class="login-title">Acesso ao Portal</h2>
            
            <form id="login-form">
                <div class="form-group">
                    <label class="form-label" for="login-username">Nome Simbólico</label>
                    <input type="text" class="form-control" id="login-username" placeholder="Enter seu nome simbólico" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="login-password">Senha de Iniciação</label>
                    <input type="password" class="form-control" id="login-password" placeholder="Enter a senha de iniciação" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="login-level">Nível de Acesso</label>
                    <select class="form-control" id="login-level" required>
                        <option value="">Selecione seu nível</option>
                        <option value="observador">Observador</option>
                        <option value="iniciado">Iniciado</option>
                        <option value="nucleo">Núcleo</option>
                    </select>
                </div>
                
                <!-- Campo extra para chave do Núcleo (inicialmente oculto) -->
                <div class="form-group" id="master-key-group" style="display: none;">
                    <label class="form-label" for="master-key">Chave de Acesso do Núcleo</label>
                    <input type="password" class="form-control" id="master-key" placeholder="Enter a chave secreta do Núcleo">
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">Apenas membros do Núcleo possuem esta chave</small>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 14px;">Acessar Portal</button>
            </form>
            
            <div class="login-footer">
                <p>Área restrita aos membros de Algebra Renova</p>
                <p>"Matemática é opcional – assim como a sanidade"</p>
            </div>
        </div>
    </div>

    <!-- CONTEÚDO PRINCIPAL DO SITE (APÓS LOGIN) -->
    <div id="main-site" class="container" style="display: none;">
        <!-- MENU LATERAL -->
        <aside class="sidebar">
            <div class="logo-container">
                <div class="logo">
                    <div class="logo-symbol">∞</div>
                    <div class="logo-text">ALGEBRA RENOVA</div>
                    <div class="logo-subtitle">Revolution. Algebra et Perseverantia.</div>
                </div>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">
                    <div class="user-avatar-upload">Alterar Foto</div>
                </div>
                <input type="file" id="avatar-upload" accept="image/*">
                <div class="user-name" id="user-name">Membro Algebra Renova</div>
                <div class="user-level level-observador" id="user-level">Observador</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-section">Navegação Principal</li>
                <li class="nav-item">
                    <a class="nav-link active" data-section="dashboard">
                        <i class="fas fa-chart-network"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="manifesto">
                        <i class="fas fa-scroll"></i>
                        <span class="nav-text">Manifesto</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="theories">
                        <i class="fas fa-atom"></i>
                        <span class="nav-text">Teorias</span>
                        <span class="notification-badge" id="theory-notif">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="research-groups">
                        <i class="fas fa-users-cog"></i>
                        <span class="nav-text">Grupos de Pesquisa</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="forum">
                        <i class="fas fa-comments"></i>
                        <span class="nav-text">Fórum de Dúvidas</span>
                        <span class="notification-badge" id="forum-notif">0</span>
                    </a>
                </li>
                
                <li class="nav-section">Comunicação</li>
                <li class="nav-item">
                    <a class="nav-link" data-section="chat">
                        <i class="fas fa-comment-dots"></i>
                        <span class="nav-text">Chat Geral</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="files">
                        <i class="fas fa-archive"></i>
                        <span class="nav-text">Arquivos</span>
                    </a>
                </li>
                
                <li class="nav-section">Hierarquia</li>
                <li class="nav-item">
                    <a class="nav-link" data-section="initiation">
                        <i class="fas fa-door-open"></i>
                        <span class="nav-text">Rito de Iniciação</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="profile">
                        <i class="fas fa-user-cog"></i>
                        <span class="nav-text">Perfil</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="members">
                        <i class="fas fa-chess-queen"></i>
                        <span class="nav-text">Membros</span>
                    </a>
                </li>
            </ul>
            
            <div style="padding: 20px 15px; margin-top: 30px; border-top: 1px solid var(--border-color);">
                <p style="font-size: 0.8rem; color: var(--text-secondary); text-align: center;">
                    "A álgebra que renasce das ruínas do tradicional"
                </p>
            </div>
        </aside>

        <!-- CONTEÚDO PRINCIPAL -->
        <main class="main-content">
            <!-- CABEÇALHO -->
            <header class="header">
                <h1 class="page-title" id="page-title">Dashboard</h1>
                <div class="header-actions">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Buscar teorias, membros..." id="global-search">
                    </div>
                    <button class="notification-btn" id="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count" id="notification-count">0</span>
                    </button>
                    <button class="logout-btn" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </header>

            <!-- SEÇÕES DE CONTEÚDO -->
            
            <!-- DASHBOARD -->
            <section id="dashboard" class="content-section active">
                <div class="dashboard">
                    <!-- CARD DE ESTATÍSTICAS -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Estatísticas da Organização</h3>
                            <div class="card-icon"><i class="fas fa-chart-bar"></i></div>
                        </div>
                        <div class="stats-container">
                            <div class="stat-card">
                                <div class="stat-value" id="stat-members">1</div>
                                <div class="stat-label">Membros</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-theories">0</div>
                                <div class="stat-label">Teorias Ativas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-groups">6</div>
                                <div class="stat-label">Grupos de Pesquisa</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-documents">0</div>
                                <div class="stat-label">Documentos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-conjectures">0</div>
                                <div class="stat-label">Conjecturas Ativas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">∞</div>
                                <div class="stat-label">Possibilidades</div>
                            </div>
                        </div>
                    </div>

                    <!-- CARD DE ATIVIDADES RECENTES -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Atividades Recentes</h3>
                            <div class="card-icon"><i class="fas fa-history"></i></div>
                        </div>
                        <ul class="recent-activities" id="recent-activities">
                            <li class="activity-item">
                                <div class="activity-icon"><i class="fas fa-door-open"></i></div>
                                <div class="activity-content">
                                    <div class="activity-title">Bem-vindo ao Algebra Renova</div>
                                    <div class="activity-time">Sua jornada começa agora</div>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- CARD DE TEORIAS EM DESTAQUE -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Teorias em Destaque</h3>
                            <div class="card-icon"><i class="fas fa-star"></i></div>
                        </div>
                        <div class="theories-list" style="grid-template-columns: 1fr;" id="featured-theories">
                            <!-- Conteúdo dinâmico -->
                        </div>
                        <button class="btn btn-secondary" style="width: 100%; margin-top: 15px;" data-section="theories">Ver Todas as Teorias</button>
                    </div>

                    <!-- CARD DE CONVITE -->
                    <div class="card pulse">
                        <div class="card-header">
                            <h3 class="card-title">Próximo Rito de Iniciação</h3>
                            <div class="card-icon"><i class="fas fa-door-open"></i></div>
                        </div>
                        <p style="margin-bottom: 20px; color: var(--text-secondary);">O próximo rito de iniciação para novos membros será agendado em breve. Para participar, você deve primeiro atingir o nível mínimo de contribuição no fórum.</p>
                        <button class="btn btn-primary" data-section="initiation">Saiba Mais</button>
                    </div>
                </div>
            </section>

            <!-- MANIFESTO -->
            <section id="manifesto" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Manifesto Algebra Renova</h2>
                </div>
                
                <div class="card" style="margin-bottom: 30px;">
                    <div class="card-header">
                        <h3 class="card-title">Revolution. Algebra et Perseverantia.</h3>
                        <div class="card-icon"><i class="fas fa-scroll"></i></div>
                    </div>
                    <div style="padding: 0 20px 20px;">
                        <blockquote style="border-left: 4px solid var(--accent-purple); padding-left: 20px; margin: 20px 0; font-style: italic; color: var(--text-secondary);">
                            "Algebra Renova é mais do que um grupo de pesquisa. É uma rebelião matemática. Uma revolução intelectual. Uma reconstrução dos próprios fundamentos do pensamento estrutural e algébrico."
                        </blockquote>
                        
                        <h4 style="color: var(--accent-teal); margin: 25px 0 15px;">A Origem do Nome</h4>
                        <p>O nome <strong>Algebra Renova</strong> surge da fusão entre o <strong>clássico e o revolucionário</strong>.</p>
                        
                        <ul style="padding-left: 20px; margin: 15px 0;">
                            <li style="margin-bottom: 10px;"><strong>Algebra</strong>: Refere-se ao campo estrutural fundamental da matemática, mas aqui entendido em seu sentido mais profundo — não apenas como a manipulação de símbolos ou equações, mas como o <em>tecido estrutural da realidade teórica</em>.</li>
                            <li style="margin-bottom: 10px;"><strong>Renova</strong>: Do latim <em>renovare</em>, "renovar", "renascer", "recriar". Uma evocação ao renascimento matemático. Ao ato de destruir estruturas caducas e criar novas formas de pensamento algébrico.</li>
                        </ul>
                        
                        <p><strong>Algebra Renova</strong>, portanto, significa: <em>A álgebra que renasce das ruínas do tradicional, mais poderosa, mais estranha, mais verdadeira.</em></p>
                        
                        <h4 style="color: var(--accent-teal); margin: 25px 0 15px;">Símbolos e seu Significado</h4>
                        
                        <div style="display: flex; flex-wrap: wrap; gap: 20px; margin: 20px 0;">
                            <div style="flex: 1; min-width: 250px; background-color: var(--tertiary-dark); padding: 20px; border-radius: 8px;">
                                <h5 style="color: var(--accent-blue); margin-bottom: 10px;"><i class="fas fa-butterfly"></i> A Borboleta</h5>
                                <p>Simboliza a transformação radical. Representa a transfunctoração: a capacidade de uma estrutura emergir em outro domínio, com regras totalmente novas.</p>
                            </div>
                            <div style="flex: 1; min-width: 250px; background-color: var(--tertiary-dark); padding: 20px; border-radius: 8px;">
                                <h5 style="color: var(--accent-red); margin-bottom: 10px;"><i class="fas fa-eye"></i> A Espada com Olho</h5>
                                <p>A espada representa a precisão cortante, o rigor lógico. O olho que chora representa a visão profunda, a contemplação infinita das estruturas ocultas.</p>
                            </div>
                            <div style="flex: 1; min-width: 250px; background-color: var(--tertiary-dark); padding: 20px; border-radius: 8px;">
                                <h5 style="color: var(--accent-teal); margin-bottom: 10px;"><i class="fas fa-shield-alt"></i> O Escudo com o Lema</h5>
                                <p>Simboliza a defesa da nova matemática contra o dogma. Contém o lema: <strong>Revolution. Algebra et Perseverantia.</strong></p>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--accent-teal); margin: 25px 0 15px;">Missão e Objetivos</h4>
                        <p>Algebra Renova tem como missão a criação deliberada de estruturas matemáticas impossíveis. Seu objetivo não é resolver problemas já conhecidos, mas inventar realidades teóricas novas.</p>
                        
                        <ul style="padding-left: 20px; margin: 15px 0;">
                            <li style="margin-bottom: 8px;"><strong>Desenvolver novas teorias rigorosas.</strong></li>
                            <li style="margin-bottom: 8px;"><strong>Fundar subcampos dentro da álgebra e matemática abstrata.</strong></li>
                            <li style="margin-bottom: 8px;"><strong>Reformular a linguagem matemática como forma de expressão estrutural criativa.</strong></li>
                            <li style="margin-bottom: 8px;"><strong>Criar uma comunidade radical de pensadores.</strong></li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- TEORIAS -->
            <section id="theories" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Teorias Matemáticas</h2>
                    <button class="btn btn-primary" id="new-theory-btn"><i class="fas fa-plus"></i> Nova Teoria</button>
                </div>
                
                <div class="theories-list" id="theories-list">
                    <!-- Conteúdo dinâmico -->
                </div>
            </section>

            <!-- GRUPOS DE PESQUISA -->
            <section id="research-groups" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Grupos de Pesquisa</h2>
                    <button class="btn btn-primary" id="join-group-btn"><i class="fas fa-user-plus"></i> Solicitar Ingresso</button>
                </div>
                
                <div class="groups-list" id="groups-list">
                    <!-- Conteúdo dinâmico -->
                </div>
            </section>

            <!-- FÓRUM DE DÚVIDAS -->
            <section id="forum" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Fórum de Dúvidas e Debates</h2>
                    <button class="btn btn-primary" id="new-topic-btn"><i class="fas fa-plus"></i> Novo Tópico</button>
                </div>
                
                <div class="forum-topics" id="forum-topics">
                    <!-- Conteúdo dinâmico -->
                </div>
            </section>

            <!-- CHAT GERAL -->
            <section id="chat" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Chat Geral</h2>
                    <div class="header-actions">
                        <span id="online-count">Online: 1</span>
                    </div>
                </div>
                
                <div class="chat-container">
                    <div class="chat-sidebar" id="chat-sidebar">
                        <!-- Canais dinâmicos -->
                    </div>
                    
                    <div class="chat-main">
                        <div class="chat-header">
                            <span id="current-chat-title">Geral</span>
                            <button class="btn btn-small btn-secondary" id="chat-info-btn">
                                <i class="fas fa-info-circle"></i> Info
                            </button>
                        </div>
                        
                        <div class="chat-messages" id="chat-messages">
                            <!-- Mensagens dinâmicas -->
                        </div>
                        
                        <div class="chat-input-container">
                            <div class="chat-input">
                                <textarea id="chat-input" placeholder="Digite sua mensagem... Use $ para fórmulas LaTeX. Ex: $E = mc^2$" autocomplete="off"></textarea>
                                <div class="latex-preview" id="latex-preview"></div>
                                <div class="chat-input-actions">
                                    <button class="btn btn-small btn-secondary" id="latex-toggle">
                                        <i class="fas fa-square-root-alt"></i> LaTeX
                                    </button>
                                    <button class="btn btn-primary btn-small" id="send-message">
                                        <i class="fas fa-paper-plane"></i> Enviar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ARQUIVOS -->
            <section id="files" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Arquivos e Documentos</h2>
                    <button class="btn btn-primary" id="upload-file-btn"><i class="fas fa-upload"></i> Upload</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Documentos da Organização</h3>
                        <div class="card-icon"><i class="fas fa-archive"></i></div>
                    </div>
                    <div style="padding: 20px;">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Tipo</th>
                                        <th>Tamanho</th>
                                        <th>Upload por</th>
                                        <th>Data</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="files-table">
                                    <!-- Conteúdo dinâmico -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- RITO DE INICIAÇÃO -->
            <section id="initiation" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Rito de Iniciação</h2>
                </div>
                
                <div class="initiation-container">
                    <div class="initiation-step">
                        <div class="step-number">1</div>
                        <h3 class="step-title">Observador</h3>
                        <p>O primeiro nível é o de Observador. Nesta fase, você tem acesso limitado ao conteúdo, podendo ler o manifesto, visualizar teorias públicas e participar do fórum de forma restrita.</p>
                        <p style="margin-top: 15px; color: var(--accent-teal);"><strong>Pré-requisito:</strong> Criação de conta e primeiro login.</p>
                    </div>
                    
                    <div class="initiation-step">
                        <div class="step-number">2</div>
                        <h3 class="step-title">Iniciado</h3>
                        <p>O segundo nível é o de Iniciado. Aqui você ganha acesso a grupos de pesquisa públicos, pode propor novas teorias, participar ativamente do fórum e do chat, e acessar mais documentos.</p>
                        <p style="margin-top: 15px; color: var(--accent-teal);"><strong>Pré-requisito:</strong> Participação ativa no fórum e contribuição com pelo menos uma discussão significativa.</p>
                    </div>
                    
                    <div class="initiation-step">
                        <div class="step-number">3</div>
                        <h3 class="step-title">Núcleo</h3>
                        <p>O nível máximo é o de Núcleo. Membros do núcleo têm acesso total a todos os grupos (incluindo os restritos), podem moderar conteúdo, validar teorias e participar da direção estratégica da organização.</p>
                        <p style="margin-top: 15px; color: var(--accent-red);"><strong>Pré-requisito:</strong> Contribuição excepcional para a organização, seja através de teorias inovadoras, resolução de conjecturas complexas ou liderança em grupos de pesquisa. Acesso por convite apenas.</p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 40px;">
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">Para avançar de nível, demonstre seu comprometimento com a revolução matemática.</p>
                        <button class="btn btn-primary pulse" id="request-initiation">Solicitar Avaliação para Iniciado</button>
                    </div>
                </div>
            </section>

            <!-- PERFIL -->
            <section id="profile" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Perfil do Membro</h2>
                </div>
                
                <div class="form-container">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Configurações do Perfil</h3>
                            <div class="card-icon"><i class="fas fa-user-cog"></i></div>
                        </div>
                        <div style="padding: 20px;">
                            <form id="profile-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="profile-name">Nome Simbólico</label>
                                        <input type="text" class="form-control" id="profile-name" value="Membro Algebra Renova" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="profile-level">Nível Atual</label>
                                        <input type="text" class="form-control" id="profile-level" value="Observador" readonly>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="profile-description">Descrição/Áreas de Interesse</label>
                                    <textarea class="form-control" id="profile-description" rows="4" placeholder="Descreva suas áreas de interesse matemático, especialidades e objetivos dentro da organização..."></textarea>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="profile-expertise">Especialidades</label>
                                        <input type="text" class="form-control" id="profile-expertise" placeholder="Ex: Álgebra abstrata, Teoria das categorias, Topologia">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="profile-status">Status</label>
                                        <select class="form-control" id="profile-status">
                                            <option value="active">Ativo</option>
                                            <option value="inactive">Inativo</option>
                                            <option value="away">Ausente</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 15px; margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                                    <button type="button" class="btn btn-secondary" id="change-password-btn">Alterar Senha</button>
                                </div>
                            </form>
                            
                            <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                                <h4 style="color: var(--accent-teal); margin-bottom: 15px;">Estatísticas Pessoais</h4>
                                <div class="stats-container" style="grid-template-columns: repeat(2, 1fr);">
                                    <div class="stat-card">
                                        <div class="stat-value" id="profile-theories">0</div>
                                        <div class="stat-label">Teorias Criadas</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value" id="profile-posts">0</div>
                                        <div class="stat-label">Posts no Fórum</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value" id="profile-groups">0</div>
                                        <div class="stat-label">Grupos Participando</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value" id="profile-documents">0</div>
                                        <div class="stat-label">Documentos Enviados</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- MEMBROS -->
            <section id="members" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Membros da Organização</h2>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Hierarquia de Membros</h3>
                        <div class="card-icon"><i class="fas fa-chess-queen"></i></div>
                    </div>
                    <div style="padding: 20px;">
                        <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 30px;">
                            <div style="flex: 1; min-width: 250px; background-color: var(--tertiary-dark); padding: 20px; border-radius: 8px; border-top: 4px solid var(--accent-red);">
                                <h4 style="color: var(--accent-red); margin-bottom: 10px;">Núcleo</h4>
                                <p style="margin-bottom: 15px;">Acesso total, direção estratégica, validação de teorias.</p>
                                <ul style="list-style: none; padding-left: 0;" id="nucleo-list">
                                    <li style="padding: 5px 0;"><i class="fas fa-crown" style="margin-right: 8px; color: var(--accent-gold);"></i>Lohan Cunha (Fundador)</li>
                                </ul>
                            </div>
                            
                            <div style="flex: 1; min-width: 250px; background-color: var(--tertiary-dark); padding: 20px; border-radius: 8px; border-top: 4px solid var(--accent-teal);">
                                <h4 style="color: var(--accent-teal); margin-bottom: 10px;">Iniciados</h4>
                                <p style="margin-bottom: 15px;">Acesso amplo, podem propor teorias, liderar grupos públicos.</p>
                                <ul style="list-style: none; padding-left: 0;" id="iniciados-list">
                                    <!-- Dinâmico -->
                                </ul>
                            </div>
                            
                            <div style="flex: 1; min-width: 250px; background-color: var(--tertiary-dark); padding: 20px; border-radius: 8px; border-top: 4px solid #6c757d;">
                                <h4 style="color: #6c757d; margin-bottom: 10px;">Observadores</h4>
                                <p style="margin-bottom: 15px;">Acesso limitado, leitura de conteúdo, participação restrita no fórum.</p>
                                <ul style="list-style: none; padding-left: 0;" id="observadores-list">
                                    <!-- Dinâmico -->
                                </ul>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--accent-teal); margin: 25px 0 15px;">Regras de Conduta</h4>
                        <ul style="padding-left: 20px; margin-bottom: 30px;">
                            <li style="margin-bottom: 8px;">Respeito absoluto às ideias, mesmo as mais radicais.</li>
                            <li style="margin-bottom: 8px;">Rigor lógico acima de preferências pessoais.</li>
                            <li style="margin-bottom: 8px;">Confidencialidade do conteúdo restrito aos membros.</li>
                            <li style="margin-bottom: 8px;">Colaboração acima de competição.</li>
                            <li style="margin-bottom: 8px;">A matemática como linguagem de revolução, não como dogma.</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODAIS -->

    <!-- Modal Nova Teoria -->
    <div id="modal-new-theory" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nova Teoria</h3>
                <button class="modal-close" data-modal="modal-new-theory">&times;</button>
            </div>
            <div class="modal-body">
                <form id="theory-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="theory-name">Nome da Teoria *</label>
                            <input type="text" class="form-control" id="theory-name" placeholder="Ex: Álgebra Transdimensional" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="theory-group">Grupo de Pesquisa *</label>
                            <select class="form-control" id="theory-group" required>
                                <option value="">Selecione um grupo</option>
                                <option value="transfunctoracao">Transfunctoração</option>
                                <option value="transformacoes">Transformações Radicais</option>
                                <option value="estruturas">Estruturas Não-Convencionais</option>
                                <option value="algebra-superior">Álgebra Superior</option>
                                <option value="conjecturas">Conjecturas e "Caças"</option>
                                <option value="analise">Análise Não-Padrão</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="theory-description">Descrição da Teoria *</label>
                        <textarea class="form-control" id="theory-description" placeholder="Descreva a teoria proposta, seus fundamentos e objetivos..." rows="5" required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="theory-visibility">Visibilidade *</label>
                            <select class="form-control" id="theory-visibility" required>
                                <option value="public">Pública (todos os membros)</option>
                                <option value="private">Privada (apenas grupo de pesquisa)</option>
                                <option value="restricted">Restrita (apenas Núcleo)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="theory-status">Status Inicial *</label>
                            <select class="form-control" id="theory-status" required>
                                <option value="developing">Em desenvolvimento</option>
                                <option value="proposal">Proposta</option>
                                <option value="discussion">Em discussão</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="theory-tags">Tags (separadas por vírgula)</label>
                        <input type="text" class="form-control" id="theory-tags" placeholder="Ex: álgebra, transfunctoração, não-associativa, transdimensional">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="theory-content">Conteúdo Detalhado (LaTeX suportado)</label>
                        <textarea class="form-control" id="theory-content" placeholder="Descreva em detalhes sua teoria. Use $$ para fórmulas LaTeX. Ex: $$E = mc^2$$" rows="8"></textarea>
                        <small style="color: var(--text-secondary);">Dica: Use $$f(x) = \int_{-\infty}^{\infty} \hat{f}(\xi) e^{2\pi i \xi x} d\xi$$ para fórmulas</small>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="submit" class="btn btn-primary">Submeter Teoria</button>
                        <button type="button" class="btn btn-secondary" data-modal="modal-new-theory">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Novo Tópico -->
    <div id="modal-new-topic" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Novo Tópico de Discussão</h3>
                <button class="modal-close" data-modal="modal-new-topic">&times;</button>
            </div>
            <div class="modal-body">
                <form id="topic-form">
                    <div class="form-group">
                        <label class="form-label" for="topic-title">Título do Tópico *</label>
                        <input type="text" class="form-control" id="topic-title" placeholder="Ex: Dúvida sobre transfunctoração entre dimensões" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="topic-description">Descrição/Questão *</label>
                        <textarea class="form-control" id="topic-description" placeholder="Descreva sua dúvida, questão ou ponto de debate..." rows="5" required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="topic-category">Categoria *</label>
                            <select class="form-control" id="topic-category" required>
                                <option value="duvida">Dúvida Conceitual</option>
                                <option value="debate">Debate Teórico</option>
                                <option value="desafio">Desafio Matemático</option>
                                <option value="discussao">Discussão Geral</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="topic-tags">Tags (separadas por vírgula)</label>
                            <input type="text" class="form-control" id="topic-tags" placeholder="Ex: álgebra, transfunctoração, anti-identidades">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="topic-content">Conteúdo Detalhado (LaTeX suportado)</label>
                        <textarea class="form-control" id="topic-content" placeholder="Desenvolva sua discussão com detalhes. Use $ para fórmulas inline e $$ para fórmulas em bloco." rows="8"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="submit" class="btn btn-primary">Criar Tópico</button>
                        <button type="button" class="btn btn-secondary" data-modal="modal-new-topic">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Discussão Detalhada -->
    <div id="modal-discussion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="discussion-modal-title">Discussão</h3>
                <button class="modal-close" data-modal="modal-discussion">&times;</button>
            </div>
            <div class="modal-body">
                <div class="discussion-container" id="discussion-container">
                    <!-- Conteúdo dinâmico -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Notificações -->
    <div id="modal-notifications" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Notificações</h3>
                <button class="modal-close" data-modal="modal-notifications">&times;</button>
            </div>
            <div class="modal-body">
                <div id="notifications-list">
                    <!-- Conteúdo dinâmico -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Upload Arquivo -->
    <div id="modal-upload" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Upload de Arquivo</h3>
                <button class="modal-close" data-modal="modal-upload">&times;</button>
            </div>
            <div class="modal-body">
                <form id="upload-form">
                    <div class="form-group">
                        <label class="form-label" for="file-name">Nome do Arquivo *</label>
                        <input type="text" class="form-control" id="file-name" placeholder="Ex: Artigo_Transfunctoracao.pdf" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="file-type">Tipo de Arquivo *</label>
                            <select class="form-control" id="file-type" required>
                                <option value="pdf">PDF</option>
                                <option value="tex">LaTeX</option>
                                <option value="md">Markdown</option>
                                <option value="txt">Texto</option>
                                <option value="image">Imagem</option>
                                <option value="other">Outro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="file-visibility">Visibilidade *</label>
                            <select class="form-control" id="file-visibility" required>
                                <option value="public">Público</option>
                                <option value="private">Privado (apenas meu grupo)</option>
                                <option value="restricted">Restrito (apenas Núcleo)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="file-description">Descrição</label>
                        <textarea class="form-control" id="file-description" placeholder="Descreva o conteúdo do arquivo..." rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="file-upload">Selecionar Arquivo *</label>
                        <input type="file" class="form-control" id="file-upload" required>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="submit" class="btn btn-primary">Upload</button>
                        <button type="button" class="btn btn-secondary" data-modal="modal-upload">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Info Chat -->
    <div id="modal-chat-info" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="chat-info-title">Informações do Chat</h3>
                <button class="modal-close" data-modal="modal-chat-info">&times;</button>
            </div>
            <div class="modal-body">
                <div id="chat-info-content">
                    <!-- Conteúdo dinâmico -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Alterar Senha -->
    <div id="modal-change-password" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Alterar Senha</h3>
                <button class="modal-close" data-modal="modal-change-password">&times;</button>
            </div>
            <div class="modal-body">
                <form id="change-password-form">
                    <div class="form-group">
                        <label class="form-label" for="current-password">Senha Atual *</label>
                        <input type="password" class="form-control" id="current-password" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="new-password">Nova Senha *</label>
                        <input type="password" class="form-control" id="new-password" required>
                        <small style="color: var(--text-secondary);">Mínimo 8 caracteres</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="confirm-password">Confirmar Nova Senha *</label>
                        <input type="password" class="form-control" id="confirm-password" required>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="submit" class="btn btn-primary">Alterar Senha</button>
                        <button type="button" class="btn btn-secondary" data-modal="modal-change-password">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- BACKGROUND FRACTAL -->
    <div class="fractal-bg"></div>

    <script>
        // =============================================
        // CONSTANTES E CONFIGURAÇÕES
        // =============================================

        const MASTER_KEY = "algebra_renova_nucleo_2024"; // Chave secreta para acesso ao Núcleo
        const STORAGE_KEYS = {
            USER: 'algebra_renova_user',
            THEORIES: 'algebra_renova_theories',
            FORUM_TOPICS: 'algebra_renova_forum_topics',
            CHAT_MESSAGES: 'algebra_renova_chat_messages',
            NOTIFICATIONS: 'algebra_renova_notifications',
            FILES: 'algebra_renova_files',
            ACTIVITIES: 'algebra_renova_activities',
            MEMBERS: 'algebra_renova_members',
            CHAT_GROUPS: 'algebra_renova_chat_groups'
        };

        // Dados iniciais
        const INITIAL_DATA = {
            theories: [
                {
                    id: 1,
                    title: "Álgebra das Anti-identidades",
                    author: "Lohan Cunha",
                    authorLevel: "nucleo",
                    group: "Transfunctoração",
                    description: "Explora estruturas algébricas onde as identidades tradicionais são substituídas por seus opostos conceituais.",
                    content: "Na álgebra tradicional, temos identidades como $a + 0 = a$ e $a \\cdot 1 = a$. Nesta teoria, propomos sistemas onde estas identidades não se mantêm: $$a + 0 \\neq a$$ $$a \\cdot 1 \\neq a$$ Isso permite a criação de estruturas totalmente novas.",
                    status: "developing",
                    version: "v1.0.0",
                    date: new Date().toISOString(),
                    visibility: "public",
                    tags: "álgebra, anti-identidades, transfunctoração",
                    replies: []
                },
                {
                    id: 2,
                    title: "Transfunctoração Quântica",
                    author: "Lohan Cunha",
                    authorLevel: "nucleo",
                    group: "Transformações Radicais",
                    description: "Estuda como estruturas algébricas podem ser 'transportadas' entre diferentes domínios matemáticos.",
                    content: "A transfunctoração quântica permite mover estruturas entre espaços de dimensão diferente mantendo certas propriedades invariantes: $$\\mathcal{F}: \\mathcal{C} \\to \\mathcal{D}$$ onde $\\mathcal{C}$ e $\\mathcal{D}$ são categorias distintas.",
                    status: "published",
                    version: "v2.0.0",
                    date: new Date().toISOString(),
                    visibility: "public",
                    tags: "transfunctoração, quântica, transformações",
                    replies: []
                }
            ],
            forumTopics: [
                {
                    id: 1,
                    title: "Interpretação da Anti-identidade a+0 ≠ a",
                    author: "Lohan Cunha",
                    authorLevel: "nucleo",
                    description: "Como interpretar sistemas onde o elemento neutro aditivo não funciona como neutro?",
                    content: "Em sistemas tradicionais, o elemento neutro aditivo $0$ satisfaz $a + 0 = a$ para todo $a$. Em nossa teoria das anti-identidades, temos $a + 0 \\neq a$. Qual seria a interpretação física/matemática disso?",
                    category: "debate",
                    tags: "álgebra, anti-identidades, interpretação",
                    replies: [],
                    status: "active",
                    date: new Date().toISOString(),
                    views: 0
                }
            ],
            chatMessages: {
                geral: [
                    {
                        id: 1,
                        sender: "Sistema Algebra Renova",
                        senderLevel: "system",
                        message: "Bem-vindo ao chat. Conecte-se com outros membros para discutir ideias, teorias e conjecturas.",
                        time: new Date().toISOString(),
                        type: "received"
                    }
                ],
                transfunctoracao: [],
                transformacoes: [],
                estruturas: [],
                algebra_superior: [],
                conjecturas: [],
                analise: []
            },
            notifications: [],
            files: [
                {
                    id: 1,
                    name: "Manifesto_Algebra_Renova.pdf",
                    type: "pdf",
                    size: "2.4 MB",
                    uploadedBy: "Lohan Cunha",
                    uploadedByLevel: "nucleo",
                    date: new Date().toISOString(),
                    description: "Manifesto fundacional da organização",
                    visibility: "public",
                    url: "#"
                }
            ],
            activities: [
                {
                    id: 1,
                    title: "Bem-vindo ao Algebra Renova",
                    time: new Date().toISOString(),
                    icon: "door-open",
                    type: "system"
                }
            ],
            members: [
                {
                    id: 1,
                    name: "Lohan Cunha",
                    level: "nucleo",
                    avatar: "LC",
                    joinDate: new Date().toISOString(),
                    description: "Fundador do Algebra Renova",
                    expertise: "Álgebra Abstrata, Teoria das Categorias",
                    status: "active",
                    theoriesCount: 2,
                    postsCount: 1
                }
            ],
            chatGroups: [
                {
                    id: "geral",
                    name: "Geral",
                    description: "Discussões gerais da organização",
                    type: "public",
                    icon: "hashtag",
                    members: ["all"]
                },
                {
                    id: "transfunctoracao",
                    name: "Transfunctoração",
                    description: "Discussões sobre transfunctoração",
                    type: "private",
                    icon: "butterfly",
                    members: ["nucleo"]
                },
                {
                    id: "transformacoes",
                    name: "Transformações Radicais",
                    description: "Grupo de transformações não-convencionais",
                    type: "public",
                    icon: "exchange-alt",
                    members: ["all"]
                },
                {
                    id: "estruturas",
                    name: "Estruturas Não-Convencionais",
                    description: "Estruturas que violam axiomas fundamentais",
                    type: "private",
                    icon: "cubes",
                    members: ["nucleo", "iniciado"]
                },
                {
                    id: "algebra_superior",
                    name: "Álgebra Superior",
                    description: "Álgebra além dos limites tradicionais",
                    type: "public",
                    icon: "infinity",
                    members: ["all"]
                },
                {
                    id: "conjecturas",
                    name: "Conjecturas e Caças",
                    description: "Caça às conjecturas mais complexas",
                    type: "restricted",
                    icon: "search",
                    members: ["nucleo"]
                },
                {
                    id: "analise",
                    name: "Análise Não-Padrão",
                    description: "Análise além do cálculo tradicional",
                    type: "public",
                    icon: "chart-line",
                    members: ["all"]
                }
            ]
        };

        // =============================================
        // ESTADO GLOBAL DA APLICAÇÃO
        // =============================================

        let currentUser = null;
        let theories = [];
        let forumTopics = [];
        let chatMessages = {};
        let notifications = [];
        let files = [];
        let activities = [];
        let members = [];
        let chatGroups = [];
        let currentChatGroup = "geral";
        let unreadNotifications = 0;

        // =============================================
        // FUNÇÕES DE PERSISTÊNCIA (LOCALSTORAGE)
        // =============================================

        function initializeStorage() {
            // Inicializar todos os dados no localStorage se não existirem
            Object.keys(STORAGE_KEYS).forEach(key => {
                if (!localStorage.getItem(STORAGE_KEYS[key])) {
                    localStorage.setItem(STORAGE_KEYS[key], JSON.stringify(INITIAL_DATA[key.toLowerCase()] || []));
                }
            });
            
            // Carregar dados do localStorage
            loadFromStorage();
        }

        function loadFromStorage() {
            try {
                theories = JSON.parse(localStorage.getItem(STORAGE_KEYS.THEORIES)) || [];
                forumTopics = JSON.parse(localStorage.getItem(STORAGE_KEYS.FORUM_TOPICS)) || [];
                chatMessages = JSON.parse(localStorage.getItem(STORAGE_KEYS.CHAT_MESSAGES)) || INITIAL_DATA.chatMessages;
                notifications = JSON.parse(localStorage.getItem(STORAGE_KEYS.NOTIFICATIONS)) || [];
                files = JSON.parse(localStorage.getItem(STORAGE_KEYS.FILES)) || [];
                activities = JSON.parse(localStorage.getItem(STORAGE_KEYS.ACTIVITIES)) || [];
                members = JSON.parse(localStorage.getItem(STORAGE_KEYS.MEMBERS)) || [];
                chatGroups = JSON.parse(localStorage.getItem(STORAGE_KEYS.CHAT_GROUPS)) || [];
                
                // Carregar usuário se existir
                const savedUser = localStorage.getItem(STORAGE_KEYS.USER);
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                }
            } catch (error) {
                console.error("Erro ao carregar do localStorage:", error);
                // Resetar para dados iniciais em caso de erro
                theories = INITIAL_DATA.theories;
                forumTopics = INITIAL_DATA.forumTopics;
                chatMessages = INITIAL_DATA.chatMessages;
                notifications = INITIAL_DATA.notifications;
                files = INITIAL_DATA.files;
                activities = INITIAL_DATA.activities;
                members = INITIAL_DATA.members;
                chatGroups = INITIAL_DATA.chatGroups;
            }
        }

        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (error) {
                console.error(`Erro ao salvar ${key}:`, error);
                showToast("Erro ao salvar dados", "error");
            }
        }

        function saveUser() {
            if (currentUser) {
                // Adicionar timestamp de última atividade
                currentUser.lastActivity = new Date().toISOString();
                saveToStorage(STORAGE_KEYS.USER, currentUser);
                
                // Atualizar na lista de membros
                const memberIndex = members.findIndex(m => m.id === currentUser.id);
                if (memberIndex !== -1) {
                    members[memberIndex] = {...currentUser};
                } else {
                    // Se não existe, adicionar
                    members.push({...currentUser});
                }
                saveToStorage(STORAGE_KEYS.MEMBERS, members);
            }
        }

        function saveTheories() {
            saveToStorage(STORAGE_KEYS.THEORIES, theories);
        }

        function saveForumTopics() {
            saveToStorage(STORAGE_KEYS.FORUM_TOPICS, forumTopics);
        }

        function saveChatMessages() {
            saveToStorage(STORAGE_KEYS.CHAT_MESSAGES, chatMessages);
        }

        function saveNotifications() {
            saveToStorage(STORAGE_KEYS.NOTIFICATIONS, notifications);
        }

        function saveFiles() {
            saveToStorage(STORAGE_KEYS.FILES, files);
        }

        function saveActivities() {
            saveToStorage(STORAGE_KEYS.ACTIVITIES, activities);
        }

        // =============================================
        // FUNÇÕES DE UTILIDADE
        // =============================================

        function showToast(message, type = "success") {
            toastr.options = {
                positionClass: "toast-top-right",
                progressBar: true,
                closeButton: true,
                timeOut: 3000,
                extendedTimeOut: 1000
            };
            
            switch(type) {
                case "success":
                    toastr.success(message);
                    break;
                case "error":
                    toastr.error(message);
                    break;
                case "warning":
                    toastr.warning(message);
                    break;
                case "info":
                    toastr.info(message);
                    break;
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return "Agora";
            if (diffMins < 60) return `${diffMins} min atrás`;
            if (diffHours < 24) return `${diffHours} h atrás`;
            if (diffDays < 7) return `${diffDays} dias atrás`;
            
            return date.toLocaleDateString('pt-BR');
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function hasAccessToGroup(group) {
            if (!currentUser) return false;
            
            if (group.type === "public") return true;
            if (group.type === "restricted") return currentUser.level === "nucleo";
            if (group.type === "private") {
                return group.members.includes(currentUser.level) || group.members.includes("all");
            }
            return false;
        }

        // =============================================
        // FUNÇÕES DE MANIPULAÇÃO DE DADOS
        // =============================================

        function createNewTheory(theoryData) {
            const newTheory = {
                id: generateId(),
                ...theoryData,
                author: currentUser.name,
                authorLevel: currentUser.level,
                date: new Date().toISOString(),
                replies: [],
                version: "v1.0.0"
            };
            
            theories.push(newTheory);
            saveTheories();
            
            // Adicionar atividade
            addActivity(`Nova teoria criada: "${theoryData.title}"`, "lightbulb");
            
            // Adicionar notificação para membros do Núcleo
            if (currentUser.level !== "nucleo") {
                members.filter(m => m.level === "nucleo").forEach(member => {
                    addNotification(member.id, "Nova teoria para revisão", `${currentUser.name} criou a teoria "${theoryData.title}"`, "theory", newTheory.id);
                });
            }
            
            showToast("Teoria criada com sucesso!", "success");
            return newTheory;
        }

        function createNewTopic(topicData) {
            const newTopic = {
                id: generateId(),
                ...topicData,
                author: currentUser.name,
                authorLevel: currentUser.level,
                date: new Date().toISOString(),
                replies: [],
                views: 0,
                status: "active"
            };
            
            forumTopics.push(newTopic);
            saveForumTopics();
            
            // Adicionar atividade
            addActivity(`Novo tópico no fórum: "${topicData.title}"`, "comments");
            
            showToast("Tópico criado com sucesso!", "success");
            return newTopic;
        }

        function addChatMessageToGroup(groupId, messageData) {
            if (!chatMessages[groupId]) {
                chatMessages[groupId] = [];
            }
            
            const newMessage = {
                id: generateId(),
                ...messageData,
                sender: currentUser.name,
                senderLevel: currentUser.level,
                time: new Date().toISOString(),
                type: "sent"
            };
            
            chatMessages[groupId].push(newMessage);
            saveChatMessages();
            
            // Renderizar mensagem imediatamente
            renderChatMessages(groupId);
            
            return newMessage;
        }

        function addNotification(userId, title, message, type, referenceId) {
            const notification = {
                id: generateId(),
                userId,
                title,
                message,
                type,
                referenceId,
                read: false,
                date: new Date().toISOString()
            };
            
            notifications.push(notification);
            saveNotifications();
            
            // Se for para o usuário atual, atualizar contador
            if (currentUser && userId === currentUser.id) {
                updateNotificationBadge();
            }
            
            return notification;
        }

        function addActivity(title, icon) {
            const activity = {
                id: generateId(),
                title,
                icon,
                time: new Date().toISOString(),
                userId: currentUser?.id
            };
            
            activities.unshift(activity);
            if (activities.length > 10) activities.pop();
            saveActivities();
            
            renderActivities();
        }

        function addFile(fileData) {
            const newFile = {
                id: generateId(),
                ...fileData,
                uploadedBy: currentUser.name,
                uploadedByLevel: currentUser.level,
                date: new Date().toISOString()
            };
            
            files.push(newFile);
            saveFiles();
            
            addActivity(`Novo arquivo enviado: "${fileData.name}"`, "file-upload");
            showToast("Arquivo enviado com sucesso!", "success");
            
            return newFile;
        }

        // =============================================
        // FUNÇÕES DE RENDERIZAÇÃO
        // =============================================

        function renderTheories() {
            const theoriesList = document.getElementById('theories-list');
            const featuredTheories = document.getElementById('featured-theories');
            
            if (!theoriesList) return;
            
            theoriesList.innerHTML = '';
            
            if (theories.length === 0) {
                theoriesList.innerHTML = `
                    <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <h4 style="color: var(--accent-teal); margin-bottom: 15px;">Nenhuma teoria ainda</h4>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">Seja o primeiro a propor uma nova teoria matemática!</p>
                        ${currentUser && currentUser.level !== "observador" ? 
                            '<button class="btn btn-primary" id="create-first-theory">Criar Primeira Teoria</button>' : 
                            '<p style="color: var(--accent-red);">Apenas membros Iniciados e Núcleo podem criar teorias</p>'}
                    </div>
                `;
                
                document.getElementById('create-first-theory')?.addEventListener('click', () => {
                    openModal('modal-new-theory');
                });
            } else {
                theories.forEach(theory => {
                    const hasAccess = theory.visibility === "public" || 
                                     (theory.visibility === "private" && currentUser?.level === theory.authorLevel) ||
                                     (theory.visibility === "restricted" && currentUser?.level === "nucleo");
                    
                    if (!hasAccess) return;
                    
                    const theoryCard = document.createElement('div');
                    theoryCard.className = 'theory-card';
                    theoryCard.dataset.id = theory.id;
                    
                    let statusClass = 'status-developing';
                    let statusText = 'Em desenvolvimento';
                    
                    if (theory.status === 'published') {
                        statusClass = 'status-published';
                        statusText = 'Publicada';
                    } else if (theory.status === 'proposal') {
                        statusClass = 'status-developing';
                        statusText = 'Proposta';
                    }
                    
                    theoryCard.innerHTML = `
                        <div class="theory-header">
                            <div>
                                <h4 class="theory-title">${theory.title}</h4>
                                <div class="theory-author">Por ${theory.author} • Grupo: ${theory.group}</div>
                            </div>
                            <span class="theory-status ${statusClass}">${statusText}</span>
                        </div>
                        <p class="theory-description">${theory.description}</p>
                        <div class="theory-meta">
                            <span><i class="fas fa-calendar"></i> ${formatDate(theory.date)}</span>
                            <span><i class="fas fa-code-branch"></i> ${theory.version}</span>
                        </div>
                    `;
                    
                    theoryCard.addEventListener('click', () => openDiscussionModal(theory, 'theory'));
                    theoriesList.appendChild(theoryCard);
                });
            }
            
            // Teorias em destaque
            if (featuredTheories) {
                featuredTheories.innerHTML = '';
                const featured = theories
                    .filter(t => t.visibility === "public")
                    .slice(-2)
                    .reverse();
                
                featured.forEach(theory => {
                    const theoryCard = document.createElement('div');
                    theoryCard.className = 'theory-card';
                    theoryCard.dataset.id = theory.id;
                    
                    let statusClass = 'status-developing';
                    let statusText = 'Em desenvolvimento';
                    
                    if (theory.status === 'published') {
                        statusClass = 'status-published';
                        statusText = 'Publicada';
                    }
                    
                    theoryCard.innerHTML = `
                        <div class="theory-header">
                            <div>
                                <h4 class="theory-title">${theory.title}</h4>
                                <div class="theory-author">Por ${theory.author}</div>
                            </div>
                            <span class="theory-status ${statusClass}">${statusText}</span>
                        </div>
                        <p class="theory-description">${theory.description.substring(0, 100)}${theory.description.length > 100 ? '...' : ''}</p>
                        <div class="theory-meta">
                            <span><i class="fas fa-calendar"></i> ${formatDate(theory.date)}</span>
                            <span><i class="fas fa-eye"></i> Ver detalhes</span>
                        </div>
                    `;
                    
                    theoryCard.addEventListener('click', () => openDiscussionModal(theory, 'theory'));
                    featuredTheories.appendChild(theoryCard);
                });
            }
            
            updateNotificationBadge();
        }

        function renderForumTopics() {
            const forumTopicsContainer = document.getElementById('forum-topics');
            
            if (!forumTopicsContainer) return;
            
            forumTopicsContainer.innerHTML = '';
            
            if (forumTopics.length === 0) {
                forumTopicsContainer.innerHTML = `
                    <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <h4 style="color: var(--accent-teal); margin-bottom: 15px;">Nenhum tópico ainda</h4>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">Inicie uma discussão sobre matemática avançada!</p>
                        <button class="btn btn-primary" id="create-first-topic">Criar Primeiro Tópico</button>
                    </div>
                `;
                
                document.getElementById('create-first-topic')?.addEventListener('click', () => {
                    openModal('modal-new-topic');
                });
            } else {
                forumTopics.forEach(topic => {
                    const topicCard = document.createElement('div');
                    topicCard.className = 'topic-card';
                    topicCard.dataset.id = topic.id;
                    
                    topicCard.innerHTML = `
                        <div class="topic-header">
                            <div>
                                <h4 class="topic-title">${topic.title}</h4>
                                <div class="topic-author">Por ${topic.author} • ${formatDate(topic.date)}</div>
                            </div>
                            <span class="topic-status status-developing">${topic.status === 'active' ? 'Ativo' : 'Fechado'}</span>
                        </div>
                        <p class="topic-description">${topic.description}</p>
                        <div class="topic-meta">
                            <span><i class="fas fa-comment"></i> ${topic.replies.length} resposta${topic.replies.length !== 1 ? 's' : ''}</span>
                            <span><i class="fas fa-eye"></i> ${topic.views} visualizações</span>
                        </div>
                    `;
                    
                    topicCard.addEventListener('click', () => openDiscussionModal(topic, 'forum'));
                    forumTopicsContainer.appendChild(topicCard);
                });
            }
            
            updateNotificationBadge();
        }

        function renderChatGroups() {
            const chatSidebar = document.getElementById('chat-sidebar');
            
            if (!chatSidebar) return;
            
            chatSidebar.innerHTML = '';
            
            chatGroups.forEach(group => {
                if (!hasAccessToGroup(group)) return;
                
                const groupElement = document.createElement('div');
                groupElement.className = `chat-group ${currentChatGroup === group.id ? 'active' : ''}`;
                groupElement.dataset.group = group.id;
                
                groupElement.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <div class="chat-group-icon">
                            <i class="fas fa-${group.icon}"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600;">${group.name}</div>
                            <small style="color: var(--text-secondary);">${group.description}</small>
                        </div>
                    </div>
                `;
                
                groupElement.addEventListener('click', () => {
                    currentChatGroup = group.id;
                    document.getElementById('current-chat-title').textContent = group.name;
                    renderChatGroups();
                    renderChatMessages(group.id);
                });
                
                chatSidebar.appendChild(groupElement);
            });
        }

        function renderChatMessages(groupId = currentChatGroup) {
            const chatMessagesContainer = document.getElementById('chat-messages');
            
            if (!chatMessagesContainer) return;
            
            chatMessagesContainer.innerHTML = '';
            
            const messages = chatMessages[groupId] || [];
            
            if (messages.length === 0) {
                chatMessagesContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Nenhuma mensagem ainda. Seja o primeiro a enviar uma mensagem!</p>
                    </div>
                `;
            } else {
                messages.forEach(msg => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message message-${msg.type}`;
                    
                    const levelClass = msg.senderLevel === "nucleo" ? "level-nucleo" : 
                                      msg.senderLevel === "iniciado" ? "level-iniciado" : 
                                      msg.senderLevel === "system" ? "level-observador" : "level-observador";
                    
                    const levelText = msg.senderLevel === "nucleo" ? "Núcleo" : 
                                     msg.senderLevel === "iniciado" ? "Iniciado" : 
                                     msg.senderLevel === "system" ? "Sistema" : "Observador";
                    
                    messageDiv.innerHTML = `
                        <div class="message-sender">
                            ${msg.sender}
                            ${msg.senderLevel !== "system" ? `<span class="message-sender-level ${levelClass}">${levelText}</span>` : ''}
                        </div>
                        <div class="message-content">${renderLatexInText(msg.message)}</div>
                        <div class="message-time">${formatDate(msg.time)}</div>
                    `;
                    
                    chatMessagesContainer.appendChild(messageDiv);
                });
            }
            
            // Scroll para o final
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
            
            // Renderizar MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([chatMessagesContainer]).catch(err => console.log(err));
            }
        }

        function renderLatexInText(text) {
            // Converte LaTeX inline ($...$) para MathJax
            return text.replace(/\$(.*?)\$/g, '\\\\($1\\\\)')
                      .replace(/\$\$(.*?)\$\$/g, '\\\\[$1\\\\]');
        }

        function renderNotifications() {
            const notificationsList = document.getElementById('notifications-list');
            
            if (!notificationsList) return;
            
            notificationsList.innerHTML = '';
            
            const userNotifications = notifications.filter(n => n.userId === currentUser.id);
            unreadNotifications = userNotifications.filter(n => !n.read).length;
            
            if (userNotifications.length === 0) {
                notificationsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-bell-slash" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Nenhuma notificação</p>
                    </div>
                `;
            } else {
                userNotifications.slice().reverse().forEach(notification => {
                    const notificationElement = document.createElement('div');
                    notificationElement.className = `notification-item ${notification.read ? '' : 'unread'}`;
                    notificationElement.dataset.id = notification.id;
                    
                    let icon = 'bell';
                    if (notification.type === 'theory') icon = 'atom';
                    if (notification.type === 'forum') icon = 'comment';
                    if (notification.type === 'system') icon = 'info-circle';
                    
                    notificationElement.innerHTML = `
                        <div style="display: flex; align-items: flex-start; gap: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--tertiary-dark); display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-${icon}" style="color: var(--accent-teal);"></i>
                            </div>
                            <div style="flex: 1;">
                                <div class="notification-title">${notification.title}</div>
                                <div style="color: var(--text-secondary); margin: 5px 0;">${notification.message}</div>
                                <div class="notification-time">${formatDate(notification.date)}</div>
                            </div>
                            ${!notification.read ? '<div style="width: 10px; height: 10px; border-radius: 50%; background-color: var(--accent-red);"></div>' : ''}
                        </div>
                    `;
                    
                    notificationElement.addEventListener('click', () => {
                        // Marcar como lida
                        notification.read = true;
                        saveNotifications();
                        updateNotificationBadge();
                        
                        // Navegar para o conteúdo relacionado
                        if (notification.type === 'theory') {
                            const theory = theories.find(t => t.id === notification.referenceId);
                            if (theory) {
                                openDiscussionModal(theory, 'theory');
                                closeModal('modal-notifications');
                            }
                        } else if (notification.type === 'forum') {
                            const topic = forumTopics.find(t => t.id === notification.referenceId);
                            if (topic) {
                                openDiscussionModal(topic, 'forum');
                                closeModal('modal-notifications');
                            }
                        }
                    });
                    
                    notificationsList.appendChild(notificationElement);
                });
            }
            
            updateNotificationBadge();
        }

        function renderActivities() {
            const activitiesList = document.getElementById('recent-activities');
            
            if (!activitiesList) return;
            
            activitiesList.innerHTML = '';
            
            const recentActivities = activities.slice(0, 5);
            
            if (recentActivities.length === 0) {
                activitiesList.innerHTML = `
                    <li class="activity-item">
                        <div class="activity-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="activity-content">
                            <div class="activity-title">Nenhuma atividade recente</div>
                            <div class="activity-time">Comece a explorar o site</div>
                        </div>
                    </li>
                `;
            } else {
                recentActivities.forEach(activity => {
                    const activityItem = document.createElement('li');
                    activityItem.className = 'activity-item';
                    
                    activityItem.innerHTML = `
                        <div class="activity-icon"><i class="fas fa-${activity.icon}"></i></div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.title}</div>
                            <div class="activity-time">${formatDate(activity.time)}</div>
                        </div>
                    `;
                    
                    activitiesList.appendChild(activityItem);
                });
            }
        }

        function renderFiles() {
            const filesTable = document.getElementById('files-table');
            
            if (!filesTable) return;
            
            filesTable.innerHTML = '';
            
            const userFiles = files.filter(file => 
                file.visibility === "public" || 
                (file.visibility === "private" && file.uploadedBy === currentUser.name) ||
                (file.visibility === "restricted" && currentUser.level === "nucleo")
            );
            
            if (userFiles.length === 0) {
                filesTable.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            Nenhum arquivo disponível
                        </td>
                    </tr>
                `;
            } else {
                userFiles.forEach(file => {
                    let icon = 'file';
                    let iconColor = '#6c757d';
                    
                    if (file.type === 'pdf') {
                        icon = 'file-pdf';
                        iconColor = '#e74c3c';
                    } else if (file.type === 'tex') {
                        icon = 'code';
                        iconColor = '#3498db';
                    } else if (file.type === 'image') {
                        icon = 'file-image';
                        iconColor = '#2ecc71';
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><i class="fas fa-${icon}" style="color: ${iconColor}; margin-right: 8px;"></i> ${file.name}</td>
                        <td>${file.type.toUpperCase()}</td>
                        <td>${file.size}</td>
                        <td>${file.uploadedBy}</td>
                        <td>${formatDate(file.date)}</td>
                        <td>
                            <button class="btn btn-secondary btn-small" data-file-id="${file.id}">
                                <i class="fas fa-download"></i>
                            </button>
                            ${file.description ? `<button class="btn btn-secondary btn-small" title="${file.description}">
                                <i class="fas fa-eye"></i>
                            </button>` : ''}
                        </td>
                    `;
                    
                    filesTable.appendChild(row);
                });
            }
        }

        function renderMembers() {
            const nucleoList = document.getElementById('nucleo-list');
            const iniciadosList = document.getElementById('iniciados-list');
            const observadoresList = document.getElementById('observadores-list');
            
            if (nucleoList) {
                nucleoList.innerHTML = '';
                members.filter(m => m.level === "nucleo").forEach(member => {
                    const li = document.createElement('li');
                    li.style.padding = '5px 0';
                    li.innerHTML = `<i class="fas fa-crown" style="margin-right: 8px; color: var(--accent-gold);"></i>${member.name}${member.name === "Lohan Cunha" ? " (Fundador)" : ""}`;
                    nucleoList.appendChild(li);
                });
            }
            
            if (iniciadosList) {
                iniciadosList.innerHTML = '';
                const iniciados = members.filter(m => m.level === "iniciado");
                if (iniciados.length === 0) {
                    iniciadosList.innerHTML = '<li style="padding: 5px 0;"><i class="fas fa-user-check" style="margin-right: 8px; color: var(--accent-teal);"></i>[Aguardando membros]</li>';
                } else {
                    iniciados.forEach(member => {
                        const li = document.createElement('li');
                        li.style.padding = '5px 0';
                        li.innerHTML = `<i class="fas fa-user-check" style="margin-right: 8px; color: var(--accent-teal);"></i>${member.name}`;
                        iniciadosList.appendChild(li);
                    });
                }
            }
            
            if (observadoresList) {
                observadoresList.innerHTML = '';
                const observadores = members.filter(m => m.level === "observador" && m.id !== currentUser?.id);
                if (observadores.length === 0) {
                    observadoresList.innerHTML = `<li style="padding: 5px 0;"><i class="fas fa-user" style="margin-right: 8px; color: #6c757d;"></i>${currentUser ? currentUser.name : "Você"}</li>`;
                } else {
                    observadores.forEach(member => {
                        const li = document.createElement('li');
                        li.style.padding = '5px 0';
                        li.innerHTML = `<i class="fas fa-user" style="margin-right: 8px; color: #6c757d;"></i>${member.name}`;
                        observadoresList.appendChild(li);
                    });
                    // Adicionar o usuário atual
                    if (currentUser && currentUser.level === "observador") {
                        const li = document.createElement('li');
                        li.style.padding = '5px 0';
                        li.innerHTML = `<i class="fas fa-user" style="margin-right: 8px; color: #6c757d;"></i>${currentUser.name} (Você)`;
                        observadoresList.appendChild(li);
                    }
                }
            }
        }

        function renderGroups() {
            const groupsList = document.getElementById('groups-list');
            
            if (!groupsList) return;
            
            groupsList.innerHTML = '';
            
            const groupsData = [
                {
                    id: 'transfunctoracao',
                    title: 'Transfunctoração',
                    members: members.filter(m => m.level === "nucleo").length,
                    description: 'Estuda a transferência de estruturas entre diferentes domínios matemáticos',
                    type: 'private',
                    icon: 'butterfly'
                },
                {
                    id: 'transformacoes',
                    title: 'Transformações Radicais',
                    members: members.filter(m => m.level !== "observador").length,
                    description: 'Explora transformações que não preservam estruturas tradicionais',
                    type: 'public',
                    icon: 'exchange-alt'
                },
                {
                    id: 'estruturas',
                    title: 'Estruturas Não-Convencionais',
                    members: members.filter(m => m.level === "nucleo" || m.level === "iniciado").length,
                    description: 'Desenvolve estruturas que violam axiomas fundamentais',
                    type: 'private',
                    icon: 'cubes'
                },
                {
                    id: 'algebra_superior',
                    title: 'Álgebra Superior',
                    members: members.length,
                    description: 'Expande os limites da álgebra tradicional',
                    type: 'public',
                    icon: 'infinity'
                },
                {
                    id: 'conjecturas',
                    title: 'Conjecturas e "Caças"',
                    members: members.filter(m => m.level === "nucleo").length,
                    description: 'Foca na formulação e resolução de conjecturas complexas',
                    type: 'restricted',
                    icon: 'search'
                },
                {
                    id: 'analise',
                    title: 'Análise Não-Padrão',
                    members: members.length,
                    description: 'Desenvolve frameworks analíticos transcendentais',
                    type: 'public',
                    icon: 'chart-line'
                }
            ];
            
            groupsData.forEach(group => {
                const hasAccess = group.type === "public" || 
                                 (group.type === "private" && currentUser.level !== "observador") ||
                                 (group.type === "restricted" && currentUser.level === "nucleo");
                
                if (!hasAccess) return;
                
                const groupCard = document.createElement('div');
                groupCard.className = 'group-card';
                
                let typeClass = 'type-public';
                let typeText = 'Público';
                
                if (group.type === 'private') {
                    typeClass = 'type-private';
                    typeText = 'Privado';
                } else if (group.type === 'restricted') {
                    typeClass = 'type-restricted';
                    typeText = 'Restrito';
                }
                
                groupCard.innerHTML = `
                    <div class="group-header">
                        <div>
                            <h4 class="group-title">${group.title}</h4>
                            <div class="group-members">${group.members} membro${group.members !== 1 ? 's' : ''}</div>
                        </div>
                        <span class="group-type ${typeClass}">${typeText}</span>
                    </div>
                    <p class="group-description">${group.description}</p>
                    <div class="group-meta">
                        <span><i class="fas fa-${group.icon}"></i> ${group.title}</span>
                        <span><i class="fas fa-comments"></i> Acessar chat</span>
                    </div>
                `;
                
                groupCard.addEventListener('click', () => {
                    // Navegar para o chat do grupo
                    document.querySelector(`.nav-link[data-section="chat"]`).click();
                    currentChatGroup = group.id;
                    document.getElementById('current-chat-title').textContent = group.title;
                    renderChatGroups();
                    renderChatMessages(group.id);
                });
                
                groupsList.appendChild(groupCard);
            });
        }

        // =============================================
        // FUNÇÕES DE MODAIS
        // =============================================

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        function openDiscussionModal(item, type) {
            const modal = document.getElementById('modal-discussion');
            const title = document.getElementById('discussion-modal-title');
            const container = document.getElementById('discussion-container');
            
            if (!modal || !title || !container) return;
            
            // Incrementar views se for tópico
            if (type === 'forum') {
                item.views++;
                saveForumTopics();
            }
            
            title.textContent = item.title;
            
            let content = '';
            
            if (type === 'theory') {
                content = `
                    <div class="discussion-header">
                        <h1 class="discussion-title">${item.title}</h1>
                        <div style="color: var(--text-secondary); margin-bottom: 15px;">
                            <i class="fas fa-user"></i> ${item.author} • 
                            <i class="fas fa-users"></i> ${item.group} • 
                            <i class="fas fa-calendar"></i> ${formatDate(item.date)}
                        </div>
                        <p style="color: var(--text-primary); margin-bottom: 20px;">${item.description}</p>
                        <div class="discussion-meta">
                            <span><i class="fas fa-tags"></i> ${item.tags || 'Sem tags'}</span>
                            <span><i class="fas fa-code-branch"></i> ${item.version}</span>
                        </div>
                    </div>
                    
                    <div class="discussion-content">
                        ${renderLatexInText(item.content || item.description)}
                    </div>
                `;
            } else if (type === 'forum') {
                content = `
                    <div class="discussion-header">
                        <h1 class="discussion-title">${item.title}</h1>
                        <div style="color: var(--text-secondary); margin-bottom: 15px;">
                            <i class="fas fa-user"></i> ${item.author} • 
                            <i class="fas fa-comments"></i> ${item.replies.length} respostas • 
                            <i class="fas fa-eye"></i> ${item.views} visualizações
                        </div>
                        <div class="discussion-meta">
                            <span><i class="fas fa-tags"></i> ${item.tags || 'Sem tags'}</span>
                            <span><i class="fas fa-calendar"></i> ${formatDate(item.date)}</span>
                        </div>
                    </div>
                    
                    <div class="discussion-content">
                        ${renderLatexInText(item.content || item.description)}
                    </div>
                `;
            }
            
            // Adicionar seção de respostas
            content += `
                <div class="discussion-replies">
                    <h3 style="color: var(--accent-teal); margin-bottom: 20px;">
                        ${item.replies.length} Resposta${item.replies.length !== 1 ? 's' : ''}
                    </h3>
                    
                    <div id="replies-list">
                        ${item.replies.map(reply => `
                            <div class="reply">
                                <div class="reply-header">
                                    <div class="reply-author">${reply.author}</div>
                                    <div class="reply-time">${formatDate(reply.date)}</div>
                                </div>
                                <div class="reply-content">${renderLatexInText(reply.content)}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${currentUser ? `
                        <div class="reply-form">
                            <h4 style="color: var(--accent-teal); margin-bottom: 15px;">Adicionar Resposta</h4>
                            <textarea id="reply-content" class="form-control" rows="4" placeholder="Escreva sua resposta... Use $ para fórmulas LaTeX"></textarea>
                            <button id="submit-reply" class="btn btn-primary" style="margin-top: 15px;" data-id="${item.id}" data-type="${type}">
                                <i class="fas fa-paper-plane"></i> Enviar Resposta
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
            
            container.innerHTML = content;
            
            // Adicionar evento ao botão de resposta
            const submitBtn = document.getElementById('submit-reply');
            if (submitBtn) {
                submitBtn.addEventListener('click', function() {
                    const replyContent = document.getElementById('reply-content').value;
                    if (!replyContent.trim()) {
                        showToast("Digite uma resposta", "warning");
                        return;
                    }
                    
                    const reply = {
                        id: generateId(),
                        author: currentUser.name,
                        authorLevel: currentUser.level,
                        content: replyContent,
                        date: new Date().toISOString()
                    };
                    
                    item.replies.push(reply);
                    
                    if (type === 'theory') {
                        saveTheories();
                    } else if (type === 'forum') {
                        saveForumTopics();
                    }
                    
                    // Adicionar notificação ao autor original
                    if (item.author !== currentUser.name) {
                        const authorMember = members.find(m => m.name === item.author);
                        if (authorMember) {
                            addNotification(
                                authorMember.id,
                                "Nova resposta",
                                `${currentUser.name} respondeu ao seu ${type === 'theory' ? 'teoria' : 'tópico'}: "${item.title}"`,
                                type,
                                item.id
                            );
                        }
                    }
                    
                    showToast("Resposta enviada com sucesso!", "success");
                    
                    // Fechar e reabrir modal para atualizar
                    closeModal('modal-discussion');
                    setTimeout(() => openDiscussionModal(item, type), 100);
                });
            }
            
            openModal('modal-discussion');
            
            // Renderizar MathJax
            if (window.MathJax) {
                setTimeout(() => MathJax.typesetPromise([container]).catch(err => console.log(err)), 100);
            }
        }

        // =============================================
        // FUNÇÕES DE ATUALIZAÇÃO DE UI
        // =============================================

        function updateNotificationBadge() {
            const notificationCount = document.getElementById('notification-count');
            const theoryNotif = document.getElementById('theory-notif');
            const forumNotif = document.getElementById('forum-notif');
            
            if (notificationCount) {
                notificationCount.textContent = unreadNotifications;
                notificationCount.style.display = unreadNotifications > 0 ? 'flex' : 'none';
            }
            
            // Atualizar badges específicos
            if (theoryNotif) {
                const newTheories = theories.filter(t => 
                    t.date > currentUser?.lastActivity && 
                    t.author !== currentUser?.name
                ).length;
                theoryNotif.textContent = newTheories;
                theoryNotif.style.display = newTheories > 0 ? 'flex' : 'none';
            }
            
            if (forumNotif) {
                const newTopics = forumTopics.filter(t => 
                    t.date > currentUser?.lastActivity && 
                    t.author !== currentUser?.name
                ).length;
                forumNotif.textContent = newTopics;
                forumNotif.style.display = newTopics > 0 ? 'flex' : 'none';
            }
        }

        function updateStatistics() {
            if (!currentUser) return;
            
            // Atualizar estatísticas gerais
            document.getElementById('stat-members').textContent = members.length;
            document.getElementById('stat-theories').textContent = theories.length;
            document.getElementById('stat-groups').textContent = chatGroups.filter(g => hasAccessToGroup(g)).length;
            document.getElementById('stat-documents').textContent = files.length;
            document.getElementById('stat-conjectures').textContent = theories.filter(t => 
                t.title.toLowerCase().includes('conjectura') || 
                t.description.toLowerCase().includes('conjectura')
            ).length;
            
            // Atualizar estatísticas do perfil
            const userTheories = theories.filter(t => t.author === currentUser.name).length;
            const userPosts = forumTopics.filter(t => t.author === currentUser.name).length + 
                            theories.reduce((sum, t) => sum + t.replies.filter(r => r.author === currentUser.name).length, 0) +
                            forumTopics.reduce((sum, t) => sum + t.replies.filter(r => r.author === currentUser.name).length, 0);
            
            document.getElementById('profile-theories').textContent = userTheories;
            document.getElementById('profile-posts').textContent = userPosts;
            document.getElementById('profile-groups').textContent = chatGroups.filter(g => hasAccessToGroup(g)).length;
            document.getElementById('profile-documents').textContent = files.filter(f => f.uploadedBy === currentUser.name).length;
        }

        function updateUserInterface() {
            if (!currentUser) return;
            
            // Atualizar informações do usuário
            document.getElementById('user-name').textContent = currentUser.name;
            document.getElementById('user-avatar').textContent = currentUser.avatar || currentUser.name.substring(0, 2).toUpperCase();
            
            // Atualizar nível
            const userLevelEl = document.getElementById('user-level');
            userLevelEl.textContent = 
                currentUser.level === 'observador' ? 'Observador' : 
                currentUser.level === 'iniciado' ? 'Iniciado' : 'Núcleo';
            
            userLevelEl.className = 'user-level';
            if (currentUser.level === 'observador') userLevelEl.classList.add('level-observador');
            else if (currentUser.level === 'iniciado') userLevelEl.classList.add('level-iniciado');
            else userLevelEl.classList.add('level-nucleo');
            
            // Atualizar nome no chat
            document.getElementById('current-user-chat').textContent = currentUser.name;
            
            // Atualizar perfil
            document.getElementById('profile-name').value = currentUser.name;
            document.getElementById('profile-level').value = 
                currentUser.level === 'observador' ? 'Observador' : 
                currentUser.level === 'iniciado' ? 'Iniciado' : 'Núcleo';
            
            // Esconder/mostrar botões baseado no nível
            const newTheoryBtn = document.getElementById('new-theory-btn');
            if (newTheoryBtn) {
                newTheoryBtn.style.display = currentUser.level === 'observador' ? 'none' : 'block';
            }
            
            // Atualizar lista de membros
            renderMembers();
        }

        // =============================================
        // FUNÇÕES DE EVENTOS E HANDLERS
        // =============================================

        function setupLogin() {
            const loginForm = document.getElementById('login-form');
            const loginLevel = document.getElementById('login-level');
            const masterKeyGroup = document.getElementById('master-key-group');
            
            // Mostrar/ocultar campo da chave mestra
            loginLevel.addEventListener('change', function() {
                masterKeyGroup.style.display = this.value === 'nucleo' ? 'block' : 'none';
            });
            
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;
                const level = document.getElementById('login-level').value;
                
                if (!username || !password || !level) {
                    showToast("Preencha todos os campos", "error");
                    return;
                }
                
                // Verificação especial para Núcleo
                if (level === 'nucleo') {
                    const masterKey = document.getElementById('master-key').value;
                    if (masterKey !== MASTER_KEY) {
                        showToast("Chave de acesso do Núcleo incorreta", "error");
                        return;
                    }
                }
                
                // Verificar se usuário já existe
                let user = members.find(m => m.name === username);
                
                if (!user) {
                    // Criar novo usuário
                    user = {
                        id: generateId(),
                        name: username,
                        level: level,
                        avatar: username.substring(0, 2).toUpperCase(),
                        joinDate: new Date().toISOString(),
                        lastActivity: new Date().toISOString(),
                        description: "",
                        expertise: "",
                        status: "active",
                        theoriesCount: 0,
                        postsCount: 0
                    };
                    
                    members.push(user);
                    saveToStorage(STORAGE_KEYS.MEMBERS, members);
                    
                    // Adicionar notificação de boas-vindas
                    addNotification(user.id, "Bem-vindo ao Algebra Renova!", "Sua jornada matemática começa agora. Explore as teorias e participe das discussões.", "system");
                }
                
                // Atualizar usuário atual
                currentUser = user;
                saveUser();
                
                // Mostrar toast de boas-vindas
                showToast(`Bem-vindo, ${username}!`, "success");
                
                // Adicionar atividade
                addActivity(`Login realizado: ${username}`, "sign-in-alt");
                
                // Fazer login automático
                autoLogin();
            });
        }

        function autoLogin() {
            const loginPage = document.getElementById('login-page');
            const mainSite = document.getElementById('main-site');
            
            if (currentUser) {
                loginPage.style.display = 'none';
                mainSite.style.display = 'flex';
                
                updateUserInterface();
                renderAllContent();
                updateStatistics();
                
                // Adicionar atividade
                addActivity(`Sessão restaurada: ${currentUser.name}`, "history");
            }
        }

        function setupLogout() {
            const logoutBtn = document.getElementById('logout-btn');
            
            logoutBtn.addEventListener('click', function() {
                if (confirm('Tem certeza que deseja sair?')) {
                    // Limpar usuário do localStorage
                    localStorage.removeItem(STORAGE_KEYS.USER);
                    
                    // Recarregar página
                    location.reload();
                }
            });
        }

        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const pageTitle = document.getElementById('page-title');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const sectionId = this.dataset.section;
                    
                    // Atualizar navegação ativa
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Mostrar seção correspondente
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === sectionId) {
                            section.classList.add('active');
                            
                            // Atualizar título da página
                            let titleText = '';
                            switch(sectionId) {
                                case 'dashboard': titleText = 'Dashboard'; break;
                                case 'manifesto': titleText = 'Manifesto'; break;
                                case 'theories': titleText = 'Teorias'; break;
                                case 'research-groups': titleText = 'Grupos de Pesquisa'; break;
                                case 'forum': titleText = 'Fórum de Dúvidas'; break;
                                case 'chat': titleText = 'Chat Geral'; break;
                                case 'files': titleText = 'Arquivos'; break;
                                case 'initiation': titleText = 'Rito de Iniciação'; break;
                                case 'profile': titleText = 'Perfil'; break;
                                case 'members': titleText = 'Membros'; break;
                                default: titleText = 'Dashboard';
                            }
                            pageTitle.textContent = titleText;
                            
                            // Renderizar conteúdo específico se necessário
                            if (sectionId === 'chat') {
                                renderChatGroups();
                                renderChatMessages();
                            }
                        }
                    });
                });
            });
            
            // Botões que navegam para seções
            document.querySelectorAll('button[data-section]').forEach(button => {
                button.addEventListener('click', function() {
                    const sectionId = this.dataset.section;
                    const targetLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);
                    if (targetLink) targetLink.click();
                });
            });
        }

        function setupModals() {
            // Fechar modais com botão X
            document.querySelectorAll('.modal-close').forEach(button => {
                button.addEventListener('click', function() {
                    const modalId = this.dataset.modal;
                    closeModal(modalId);
                });
            });
            
            // Fechar modais clicando fora
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });
            
            // Botão Nova Teoria
            document.getElementById('new-theory-btn')?.addEventListener('click', () => {
                if (!currentUser) return;
                if (currentUser.level === 'observador') {
                    showToast("Apenas membros Iniciados e Núcleo podem criar teorias", "warning");
                    return;
                }
                openModal('modal-new-theory');
            });
            
            // Botão Novo Tópico
            document.getElementById('new-topic-btn')?.addEventListener('click', () => {
                openModal('modal-new-topic');
            });
            
            // Botão Notificações
            document.getElementById('notification-btn')?.addEventListener('click', () => {
                renderNotifications();
                openModal('modal-notifications');
            });
            
            // Botão Upload
            document.getElementById('upload-file-btn')?.addEventListener('click', () => {
                openModal('modal-upload');
            });
            
            // Botão Info Chat
            document.getElementById('chat-info-btn')?.addEventListener('click', () => {
                const group = chatGroups.find(g => g.id === currentChatGroup);
                if (group) {
                    const content = document.getElementById('chat-info-content');
                    content.innerHTML = `
                        <h4 style="color: var(--accent-teal); margin-bottom: 15px;">${group.name}</h4>
                        <p style="margin-bottom: 15px;">${group.description}</p>
                        <div style="color: var(--text-secondary);">
                            <p><i class="fas fa-users"></i> Tipo: ${group.type === 'public' ? 'Público' : group.type === 'private' ? 'Privado' : 'Restrito'}</p>
                            <p><i class="fas fa-user-shield"></i> Acesso: ${group.members.join(', ')}</p>
                            <p><i class="fas fa-comments"></i> ${(chatMessages[currentChatGroup] || []).length} mensagens</p>
                        </div>
                    `;
                    openModal('modal-chat-info');
                }
            });
            
            // Botão Alterar Senha
            document.getElementById('change-password-btn')?.addEventListener('click', () => {
                openModal('modal-change-password');
            });
            
            // Botão Solicitar Ingresso em Grupo
            document.getElementById('join-group-btn')?.addEventListener('click', () => {
                if (currentUser.level === 'observador') {
                    showToast("Observadores podem apenas visualizar grupos públicos. Solicite o nível de Iniciado.", "info");
                } else {
                    showToast("Solicitação enviada aos administradores do grupo.", "success");
                    addActivity("Solicitação de ingresso em grupo enviada", "user-plus");
                }
            });
            
            // Botão Solicitar Iniciação
            document.getElementById('request-initiation')?.addEventListener('click', () => {
                if (currentUser.level === 'observador') {
                    const hasContributions = theories.filter(t => t.author === currentUser.name).length > 0 || 
                                           forumTopics.filter(t => t.author === currentUser.name).length > 0;
                    
                    if (hasContributions) {
                        showToast("Solicitação enviada ao Núcleo para avaliação.", "success");
                        
                        // Notificar membros do Núcleo
                        members.filter(m => m.level === "nucleo").forEach(member => {
                            addNotification(
                                member.id,
                                "Solicitação de promoção",
                                `${currentUser.name} solicitou promoção para Iniciado`,
                                "system"
                            );
                        });
                        
                        addActivity("Solicitação para Iniciado enviada", "user-check");
                    } else {
                        showToast("Contribua com teorias ou discussões antes de solicitar promoção.", "warning");
                    }
                } else {
                    showToast(`Você já é ${currentUser.level === 'iniciado' ? 'Iniciado' : 'membro do Núcleo'}.`, "info");
                }
            });
        }

        function setupForms() {
            // Formulário de Nova Teoria
            document.getElementById('theory-form')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const theoryData = {
                    title: document.getElementById('theory-name').value,
                    group: document.getElementById('theory-group').options[document.getElementById('theory-group').selectedIndex].text,
                    description: document.getElementById('theory-description').value,
                    content: document.getElementById('theory-content').value,
                    visibility: document.getElementById('theory-visibility').value,
                    status: document.getElementById('theory-status').value,
                    tags: document.getElementById('theory-tags').value
                };
                
                createNewTheory(theoryData);
                closeModal('modal-new-theory');
                this.reset();
                
                // Atualizar exibição
                renderTheories();
                updateStatistics();
            });
            
            // Formulário de Novo Tópico
            document.getElementById('topic-form')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const topicData = {
                    title: document.getElementById('topic-title').value,
                    description: document.getElementById('topic-description').value,
                    content: document.getElementById('topic-content').value,
                    category: document.getElementById('topic-category').value,
                    tags: document.getElementById('topic-tags').value
                };
                
                createNewTopic(topicData);
                closeModal('modal-new-topic');
                this.reset();
                
                // Atualizar exibição
                renderForumTopics();
                updateStatistics();
            });
            
            // Formulário de Upload
            document.getElementById('upload-form')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const fileData = {
                    name: document.getElementById('file-name').value,
                    type: document.getElementById('file-type').value,
                    size: "1.2 MB", // Simulado
                    description: document.getElementById('file-description').value,
                    visibility: document.getElementById('file-visibility').value,
                    url: "#" // Simulado
                };
                
                addFile(fileData);
                closeModal('modal-upload');
                this.reset();
                
                // Atualizar exibição
                renderFiles();
                updateStatistics();
            });
            
            // Formulário de Perfil
            document.getElementById('profile-form')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!currentUser) return;
                
                currentUser.name = document.getElementById('profile-name').value;
                currentUser.avatar = currentUser.name.substring(0, 2).toUpperCase();
                currentUser.description = document.getElementById('profile-description').value;
                currentUser.expertise = document.getElementById('profile-expertise').value;
                currentUser.status = document.getElementById('profile-status').value;
                
                saveUser();
                updateUserInterface();
                
                showToast("Perfil atualizado com sucesso!", "success");
                addActivity("Perfil atualizado", "user-edit");
            });
            
            // Formulário de Alterar Senha
            document.getElementById('change-password-form')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const currentPassword = document.getElementById('current-password').value;
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                
                if (newPassword.length < 8) {
                    showToast("A nova senha deve ter pelo menos 8 caracteres", "error");
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    showToast("As senhas não coincidem", "error");
                    return;
                }
                
                // Simulação - em app real, verificar senha atual
                showToast("Senha alterada com sucesso!", "success");
                closeModal('modal-change-password');
                this.reset();
            });
        }

        function setupChat() {
            const chatInput = document.getElementById('chat-input');
            const sendMessageBtn = document.getElementById('send-message');
            const latexToggle = document.getElementById('latex-toggle');
            const latexPreview = document.getElementById('latex-preview');
            
            let showLatexPreview = false;
            
            // Alternar preview de LaTeX
            latexToggle?.addEventListener('click', () => {
                showLatexPreview = !showLatexPreview;
                latexPreview.classList.toggle('active', showLatexPreview);
                updateLatexPreview();
            });
            
            // Atualizar preview de LaTeX em tempo real
            chatInput?.addEventListener('input', () => {
                if (showLatexPreview) {
                    updateLatexPreview();
                }
            });
            
            function updateLatexPreview() {
                if (!latexPreview) return;
                
                const text = chatInput.value;
                latexPreview.innerHTML = renderLatexInText(text);
                
                if (window.MathJax) {
                    MathJax.typesetPromise([latexPreview]).catch(err => console.log(err));
                }
            }
            
            // Enviar mensagem
            function sendMessage() {
                if (!chatInput || !chatInput.value.trim()) return;
                
                const messageData = {
                    message: chatInput.value
                };
                
                addChatMessageToGroup(currentChatGroup, messageData);
                chatInput.value = '';
                
                if (showLatexPreview) {
                    showLatexPreview = false;
                    latexPreview.classList.remove('active');
                }
                
                // Focar no input novamente
                chatInput.focus();
            }
            
            sendMessageBtn?.addEventListener('click', sendMessage);
            
            chatInput?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        }

        function setupAvatarUpload() {
            const avatar = document.getElementById('user-avatar');
            const uploadInput = document.getElementById('avatar-upload');
            
            avatar?.addEventListener('click', () => {
                uploadInput.click();
            });
            
            uploadInput?.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!file.type.match('image.*')) {
                    showToast("Selecione um arquivo de imagem", "error");
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    avatar.innerHTML = `
                        <img src="${event.target.result}" alt="${currentUser.name}">
                        <div class="user-avatar-upload">Alterar Foto</div>
                    `;
                    
                    // Salvar no localStorage (simulado)
                    currentUser.avatarUrl = event.target.result;
                    saveUser();
                    
                    showToast("Foto de perfil atualizada!", "success");
                };
                reader.readAsDataURL(file);
            });
        }

        function setupSearch() {
            const searchInput = document.getElementById('global-search');
            
            searchInput?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const term = this.value.toLowerCase().trim();
                    if (!term) return;
                    
                    // Buscar em teorias
                    const theoryResults = theories.filter(t => 
                        t.title.toLowerCase().includes(term) || 
                        t.description.toLowerCase().includes(term) ||
                        t.tags.toLowerCase().includes(term) ||
                        t.author.toLowerCase().includes(term)
                    );
                    
                    // Buscar em tópicos
                    const topicResults = forumTopics.filter(t => 
                        t.title.toLowerCase().includes(term) || 
                        t.description.toLowerCase().includes(term) ||
                        t.tags.toLowerCase().includes(term) ||
                        t.author.toLowerCase().includes(term)
                    );
                    
                    // Mostrar resultados
                    let resultText = `Resultados para "${term}":\n\n`;
                    
                    if (theoryResults.length > 0) {
                        resultText += `Teorias (${theoryResults.length}):\n`;
                        theoryResults.forEach((t, i) => {
                            resultText += `${i+1}. ${t.title} - ${t.author}\n`;
                        });
                        resultText += '\n';
                    }
                    
                    if (topicResults.length > 0) {
                        resultText += `Tópicos (${topicResults.length}):\n`;
                        topicResults.forEach((t, i) => {
                            resultText += `${i+1}. ${t.title} - ${t.author}\n`;
                        });
                    }
                    
                    if (theoryResults.length === 0 && topicResults.length === 0) {
                        resultText = `Nenhum resultado encontrado para "${term}"`;
                    }
                    
                    alert(resultText);
                    this.value = '';
                }
            });
        }

        // =============================================
        // INICIALIZAÇÃO
        // =============================================

        function renderAllContent() {
            renderTheories();
            renderForumTopics();
            renderChatGroups();
            renderChatMessages();
            renderNotifications();
            renderActivities();
            renderFiles();
            renderGroups();
            renderMembers();
            updateStatistics();
            updateNotificationBadge();
        }

        function initializeApp() {
            // Configurar Toastr
            toastr.options = {
                positionClass: "toast-top-right",
                progressBar: true,
                closeButton: true,
                timeOut: 3000,
                extendedTimeOut: 1000
            };
            
            // Inicializar localStorage
            initializeStorage();
            
            // Verificar login automático
            if (currentUser) {
                autoLogin();
            }
            
            // Configurar eventos
            setupLogin();
            setupLogout();
            setupNavigation();
            setupModals();
            setupForms();
            setupChat();
            setupAvatarUpload();
            setupSearch();
            
            // Configurar MathJax
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        }

        // Inicializar quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
