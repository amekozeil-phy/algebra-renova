<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Renova - Rede Social</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #11111a;
            --bg-tertiary: #1a1a2e;
            --bg-quaternary: #252540;
            --bg-hover: #2d2d4a;
            --accent-primary: #9d00ff;
            --accent-secondary: #00d9ff;
            --accent-tertiary: #ff00cc;
            --text-primary: #f0f0ff;
            --text-secondary: #b0b0d0;
            --text-muted: #8888aa;
            --border-color: #2a2a3e;
            --success: #00ff88;
            --warning: #ffcc00;
            --error: #ff5555;
            --online: #00ff88;
            --idle: #ffaa00;
            --dnd: #ff5555;
            --offline: #666699;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Login */
        .login-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
        }

        .login-box {
            background: var(--bg-secondary);
            padding: 40px;
            border-radius: 15px;
            width: 400px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--accent-primary);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .renova-logo {
            font-family: 'Times New Roman', serif;
            font-size: 42px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: var(--text-muted);
            font-style: italic;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
        }

        .login-footer {
            text-align: center;
            margin-top: 20px;
            color: var(--text-muted);
        }

        .login-footer a {
            color: var(--accent-secondary);
            text-decoration: none;
        }

        /* Navbar Lateral */
        .navbar {
            width: 80px;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            border-right: 1px solid var(--border-color);
        }

        .nav-item {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.3s;
            position: relative;
        }

        .nav-item:hover, .nav-item.active {
            background: var(--accent-primary);
            color: white;
        }

        .nav-item .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--error);
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-search {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .section-title {
            color: var(--text-muted);
            font-size: 14px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .friend-item, .group-item, .chat-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 8px;
            transition: background 0.2s;
        }

        .friend-item:hover, .group-item:hover, .chat-item:hover,
        .friend-item.active, .group-item.active, .chat-item.active {
            background: var(--bg-hover);
        }

        .friend-avatar, .group-avatar, .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            position: relative;
        }

        .status {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--bg-secondary);
        }

        .status.online { background: var(--online); }
        .status.idle { background: var(--idle); }
        .status.dnd { background: var(--dnd); }
        .status.offline { background: var(--offline); }

        .friend-info, .group-info {
            flex: 1;
        }

        .friend-name, .group-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .friend-status, .group-members {
            font-size: 12px;
            color: var(--text-muted);
        }

        .add-btn {
            color: var(--accent-secondary);
            cursor: pointer;
        }

        /* Conteúdo Principal */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
        }

        .content-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 24px;
            font-weight: bold;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .action-btn {
            padding: 8px 15px;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: background 0.2s;
        }

        .action-btn:hover {
            background: var(--bg-hover);
        }

        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        /* Chat */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            gap: 15px;
            max-width: 70%;
        }

        .message.own {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .message-content {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 15px;
            position: relative;
        }

        .message.own .message-content {
            background: var(--accent-primary);
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .message-sender {
            font-weight: bold;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        .message.own .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .message-text {
            line-height: 1.5;
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }

        .chat-input-box {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 15px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            resize: none;
            height: 60px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .send-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        /* Perfil */
        .profile-container {
            padding: 20px;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .profile-avatar-upload {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            cursor: pointer;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
        }

        .avatar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .profile-avatar-upload:hover .avatar-overlay {
            opacity: 1;
        }

        .profile-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-status {
            color: var(--text-muted);
        }

        .profile-form {
            max-width: 500px;
            margin: 0 auto;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group.half {
            flex: 1;
        }

        /* Grupos */
        .groups-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .group-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: transform 0.2s;
            cursor: pointer;
        }

        .group-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-primary);
        }

        .group-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .group-card-avatar {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin-right: 15px;
        }

        .group-card-name {
            font-size: 18px;
            font-weight: bold;
        }

        .group-card-members {
            font-size: 14px;
            color: var(--text-muted);
        }

        .group-card-description {
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .group-card-actions {
            display: flex;
            gap: 10px;
        }

        .group-btn {
            flex: 1;
            padding: 8px;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            transition: background 0.2s;
        }

        .group-btn.primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .group-btn:hover {
            background: var(--bg-hover);
        }

        .group-btn.primary:hover {
            opacity: 0.9;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 15px;
            width: 500px;
            max-width: 90%;
            max-height: 90%;
            overflow: hidden;
            border: 1px solid var(--accent-primary);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: white;
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .modal-btn.secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            cursor: pointer;
        }

        /* Utilitários */
        .hidden {
            display: none !important;
        }

        .scrollbar {
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) var(--bg-secondary);
        }

        .scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background-color: var(--border-color);
            border-radius: 4px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                left: 80px;
                top: 0;
                bottom: 0;
                z-index: 100;
                box-shadow: 5px 0 15px rgba(0, 0, 0, 0.5);
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .groups-container {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <div class="renova-logo">Algebra Renova</div>
                <div class="login-subtitle">Revolution. Algebra et Perseverantia.</div>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label class="form-label">Nome de Usuário</label>
                    <input type="text" id="loginUsername" class="form-input" placeholder="seu_nick">
                </div>
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="••••••••">
                </div>
                <button class="login-btn" onclick="login()">Entrar</button>
                <div class="login-footer">
                    Primeira vez aqui? <a href="#" onclick="showRegister()">Crie uma conta</a>
                </div>
            </div>
        </div>
    </div>

    <!-- App Principal (escondido inicialmente) -->
    <div id="appScreen" class="app-container hidden">
        <!-- Navbar Lateral -->
        <div class="navbar">
            <div class="nav-item active" data-page="chat">
                <i class="fas fa-comments"></i>
            </div>
            <div class="nav-item" data-page="friends">
                <i class="fas fa-user-friends"></i>
                <span class="badge" id="friendRequestsBadge">0</span>
            </div>
            <div class="nav-item" data-page="groups">
                <i class="fas fa-users"></i>
            </div>
            <div class="nav-item" data-page="profile">
                <i class="fas fa-user"></i>
            </div>
            <div class="nav-item" data-page="collaboration">
                <i class="fas fa-code-branch"></i>
            </div>
            <div class="nav-item" onclick="logout()" style="margin-top: auto;">
                <i class="fas fa-sign-out-alt"></i>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-search">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Buscar..." id="sidebarSearch">
                </div>
            </div>
            <div class="sidebar-content scrollbar" id="sidebarContent">
                <!-- Conteúdo dinâmico -->
            </div>
        </div>

        <!-- Conteúdo Principal -->
        <div class="main-content">
            <!-- Cabeçalho dinâmico -->
            <div class="content-header" id="contentHeader">
                <div class="header-title" id="pageTitle">Conversas</div>
                <div class="header-actions" id="pageActions"></div>
            </div>

            <!-- Corpo dinâmico -->
            <div class="content-body scrollbar" id="contentBody">
                <!-- Conteúdo será carregado aqui -->
            </div>
        </div>
    </div>

    <!-- Modal Adicionar Amigo -->
    <div id="addFriendModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Adicionar Amigo</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nome de usuário</label>
                    <input type="text" id="addFriendUsername" class="form-input" placeholder="Digite o nick do amigo">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeModal('addFriendModal')">Cancelar</button>
                <button class="modal-btn primary" onclick="sendFriendRequest()">Enviar Solicitação</button>
            </div>
        </div>
        <button class="close-modal" onclick="closeModal('addFriendModal')">×</button>
    </div>

    <!-- Modal Criar Grupo -->
    <div id="createGroupModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Criar Grupo de Pesquisa</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nome do Grupo</label>
                    <input type="text" id="groupName" class="form-input" placeholder="Ex: Teoria das Anti-Identidades">
                </div>
                <div class="form-group">
                    <label class="form-label">Descrição</label>
                    <textarea id="groupDescription" class="form-input" rows="3" placeholder="Descreva o foco do grupo..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Membros iniciais (separados por vírgula)</label>
                    <input type="text" id="groupMembers" class="form-input" placeholder="nick1, nick2, nick3">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeModal('createGroupModal')">Cancelar</button>
                <button class="modal-btn primary" onclick="createGroup()">Criar Grupo</button>
            </div>
        </div>
        <button class="close-modal" onclick="closeModal('createGroupModal')">×</button>
    </div>

    <!-- Modal Upload Arquivo -->
    <div id="uploadFileModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Enviar Arquivo</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Selecionar Arquivo</label>
                    <input type="file" id="fileInput" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Descrição (opcional)</label>
                    <input type="text" id="fileDescription" class="form-input" placeholder="Breve descrição do arquivo">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeModal('uploadFileModal')">Cancelar</button>
                <button class="modal-btn primary" onclick="uploadFile()">Enviar</button>
            </div>
        </div>
        <button class="close-modal" onclick="closeModal('uploadFileModal')">×</button>
    </div>

    <script>
        // Sistema de Banco de Dados Local
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('algebraUsers')) || [];
        let friends = JSON.parse(localStorage.getItem('algebraFriends')) || {};
        let friendRequests = JSON.parse(localStorage.getItem('algebraFriendRequests')) || {};
        let messages = JSON.parse(localStorage.getItem('algebraMessages')) || {};
        let groups = JSON.parse(localStorage.getItem('algebraGroups')) || [];
        let onlineUsers = JSON.parse(localStorage.getItem('algebraOnline')) || [];

        // Páginas disponíveis
        const pages = {
            chat: { title: "Conversas", icon: "comments" },
            friends: { title: "Amigos", icon: "user-friends" },
            groups: { title: "Grupos", icon: "users" },
            profile: { title: "Meu Perfil", icon: "user" },
            collaboration: { title: "Colaboração", icon: "code-branch" }
        };

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se há usuário logado
            const savedUser = localStorage.getItem('algebraCurrentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
            }
            
            setupEventListeners();
        });

        // Configurar eventos
        function setupEventListeners() {
            // Login com Enter
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            // Navegação
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    if (this.getAttribute('onclick') === 'logout()') return;
                    
                    const page = this.getAttribute('data-page');
                    navigateTo(page);
                    
                    // Ativar item
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Busca na sidebar
            document.getElementById('sidebarSearch').addEventListener('input', function(e) {
                filterSidebar(e.target.value);
            });
        }

        // Login
        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!username || !password) {
                alert("Por favor, preencha todos os campos.");
                return;
            }
            
            // Verificar se usuário existe
            let user = users.find(u => u.username === username);
            
            if (!user) {
                // Criar novo usuário
                user = {
                    id: Date.now().toString(),
                    username: username,
                    password: password, // Em produção, usar hash
                    displayName: username,
                    avatar: getInitials(username),
                    status: "online",
                    bio: "Novo membro do Algebra Renova",
                    createdAt: new Date().toISOString()
                };
                users.push(user);
                localStorage.setItem('algebraUsers', JSON.stringify(users));
            } else if (user.password !== password) {
                alert("Senha incorreta.");
                return;
            }
            
            // Atualizar status online
            if (!onlineUsers.includes(user.id)) {
                onlineUsers.push(user.id);
                localStorage.setItem('algebraOnline', JSON.stringify(onlineUsers));
            }
            
            // Fazer login
            currentUser = user;
            localStorage.setItem('algebraCurrentUser', JSON.stringify(user));
            
            showApp();
        }

        // Mostrar aplicação
        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('hidden');
            
            // Navegar para página padrão
            navigateTo('chat');
            
            // Atualizar badge de solicitações
            updateFriendRequestsBadge();
        }

        // Navegar para página
        function navigateTo(page) {
            if (!pages[page]) return;
            
            // Atualizar título
            document.getElementById('pageTitle').textContent = pages[page].title;
            
            // Limpar ações
            document.getElementById('pageActions').innerHTML = '';
            
            // Carregar conteúdo
            const contentBody = document.getElementById('contentBody');
            contentBody.innerHTML = '';
            
            // Carregar sidebar
            loadSidebar(page);
            
            switch(page) {
                case 'chat':
                    loadChatPage();
                    break;
                case 'friends':
                    loadFriendsPage();
                    break;
                case 'groups':
                    loadGroupsPage();
                    break;
                case 'profile':
                    loadProfilePage();
                    break;
                case 'collaboration':
                    loadCollaborationPage();
                    break;
            }
        }

        // Carregar sidebar
        function loadSidebar(page) {
            const sidebarContent = document.getElementById('sidebarContent');
            sidebarContent.innerHTML = '';
            
            switch(page) {
                case 'chat':
                    loadChatSidebar();
                    break;
                case 'friends':
                    loadFriendsSidebar();
                    break;
                case 'groups':
                    loadGroupsSidebar();
                    break;
            }
        }

        // Filtrar sidebar
        function filterSidebar(searchTerm) {
            const items = document.querySelectorAll('.friend-item, .group-item, .chat-item');
            if (!searchTerm) {
                items.forEach(item => item.style.display = 'flex');
                return;
            }
            
            const term = searchTerm.toLowerCase();
            items.forEach(item => {
                const name = item.querySelector('.friend-name, .group-name, .chat-name').textContent.toLowerCase();
                item.style.display = name.includes(term) ? 'flex' : 'none';
            });
        }

        // PÁGINA: Chat
        function loadChatPage() {
            const contentBody = document.getElementById('contentBody');
            
            // Adicionar botão de upload
            const actions = document.getElementById('pageActions');
            actions.innerHTML = `
                <button class="action-btn" onclick="showUploadFileModal()">
                    <i class="fas fa-upload"></i> Enviar Arquivo
                </button>
            `;
            
            // Conteúdo do chat
            contentBody.innerHTML = `
                <div class="chat-container">
                    <div class="chat-messages scrollbar" id="chatMessages">
                        <div class="empty-state" id="emptyChat">
                            <i class="fas fa-comments"></i>
                            <h3>Nenhuma conversa selecionada</h3>
                            <p>Selecione uma conversa na sidebar para começar a trocar mensagens</p>
                        </div>
                    </div>
                    <div class="chat-input-container hidden" id="chatInputContainer">
                        <div class="chat-input-box">
                            <textarea class="chat-input" id="chatInput" placeholder="Digite sua mensagem..." rows="3"></textarea>
                            <button class="send-btn" onclick="sendMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Evento para enviar com Enter
            contentBody.addEventListener('keypress', function(e) {
                if (e.target.id === 'chatInput' && e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        }

        function loadChatSidebar() {
            const sidebarContent = document.getElementById('sidebarContent');
            
            // Conversas com amigos
            const friendsList = getFriendsList();
            if (friendsList.length > 0) {
                sidebarContent.innerHTML += `
                    <div class="section-title">
                        <span>Amigos Online</span>
                        <span class="add-btn" onclick="showAddFriendModal()">
                            <i class="fas fa-user-plus"></i>
                        </span>
                    </div>
                `;
                
                friendsList.forEach(friend => {
                    const isOnline = onlineUsers.includes(friend.id);
                    const lastMessage = getLastMessage(friend.id);
                    
                    const item = document.createElement('div');
                    item.className = `chat-item ${isOnline ? 'online' : ''}`;
                    item.innerHTML = `
                        <div class="chat-avatar">${friend.avatar}</div>
                        <div class="friend-info">
                            <div class="friend-name">${friend.displayName || friend.username}</div>
                            <div class="friend-status">${lastMessage || (isOnline ? 'Online' : 'Offline')}</div>
                        </div>
                    `;
                    
                    item.addEventListener('click', () => openChat(friend.id));
                    sidebarContent.appendChild(item);
                });
            }
            
            // Grupos
            const userGroups = groups.filter(g => g.members.includes(currentUser.id));
            if (userGroups.length > 0) {
                sidebarContent.innerHTML += `
                    <div class="section-title">
                        <span>Grupos</span>
                    </div>
                `;
                
                userGroups.forEach(group => {
                    const item = document.createElement('div');
                    item.className = 'group-item';
                    item.innerHTML = `
                        <div class="group-avatar">${getInitials(group.name)}</div>
                        <div class="group-info">
                            <div class="group-name">${group.name}</div>
                            <div class="group-members">${group.members.length} membros</div>
                        </div>
                    `;
                    
                    item.addEventListener('click', () => openGroupChat(group.id));
                    sidebarContent.appendChild(item);
                });
            }
        }

        // Abrir chat com amigo
        function openChat(friendId) {
            const friend = users.find(u => u.id === friendId);
            if (!friend) return;
            
            // Atualizar título
            document.getElementById('pageTitle').textContent = friend.displayName || friend.username;
            
            // Mostrar input
            document.getElementById('chatInputContainer').classList.remove('hidden');
            document.getElementById('emptyChat').classList.add('hidden');
            
            // Carregar mensagens
            loadMessages(friendId);
            
            // Focar no input
            setTimeout(() => {
                document.getElementById('chatInput').focus();
            }, 100);
        }

        // Abrir chat de grupo
        function openGroupChat(groupId) {
            const group = groups.find(g => g.id === groupId);
            if (!group) return;
            
            document.getElementById('pageTitle').textContent = group.name;
            document.getElementById('chatInputContainer').classList.remove('hidden');
            document.getElementById('emptyChat').classList.add('hidden');
            
            // Carregar mensagens do grupo
            loadGroupMessages(groupId);
            
            setTimeout(() => {
                document.getElementById('chatInput').focus();
            }, 100);
        }

        // Carregar mensagens
        function loadMessages(friendId) {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            
            const chatKey = [currentUser.id, friendId].sort().join('_');
            const chat = messages[chatKey] || [];
            
            chat.forEach(msg => {
                const isOwn = msg.senderId === currentUser.id;
                const sender = users.find(u => u.id === msg.senderId);
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isOwn ? 'own' : ''}`;
                messageDiv.innerHTML = `
                    <div class="message-avatar">${sender?.avatar || '?'}</div>
                    <div class="message-content">
                        <div class="message-header">
                            <div class="message-sender">${sender?.displayName || sender?.username || 'Usuário'}</div>
                            <div class="message-time">${formatTime(msg.timestamp)}</div>
                        </div>
                        <div class="message-text">${msg.content}</div>
                        ${msg.file ? `<div class="file-attachment"><i class="fas fa-file"></i> ${msg.file.name}</div>` : ''}
                    </div>
                `;
                
                chatMessages.appendChild(messageDiv);
            });
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Carregar mensagens do grupo
        function loadGroupMessages(groupId) {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            
            const chatKey = `group_${groupId}`;
            const chat = messages[chatKey] || [];
            
            chat.forEach(msg => {
                const isOwn = msg.senderId === currentUser.id;
                const sender = users.find(u => u.id === msg.senderId);
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isOwn ? 'own' : ''}`;
                messageDiv.innerHTML = `
                    <div class="message-avatar">${sender?.avatar || '?'}</div>
                    <div class="message-content">
                        <div class="message-header">
                            <div class="message-sender">${sender?.displayName || sender?.username || 'Usuário'}</div>
                            <div class="message-time">${formatTime(msg.timestamp)}</div>
                        </div>
                        <div class="message-text">${msg.content}</div>
                        ${msg.file ? `<div class="file-attachment"><i class="fas fa-file"></i> ${msg.file.name}</div>` : ''}
                    </div>
                `;
                
                chatMessages.appendChild(messageDiv);
            });
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Enviar mensagem
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const content = input.value.trim();
            
            if (!content) return;
            
            // Determinar tipo de chat (individual ou grupo)
            const pageTitle = document.getElementById('pageTitle').textContent;
            let chatKey = null;
            let isGroup = false;
            
            // Verificar se é grupo
            const group = groups.find(g => g.name === pageTitle);
            if (group) {
                chatKey = `group_${group.id}`;
                isGroup = true;
            } else {
                // É chat individual
                const friend = users.find(u => 
                    u.displayName === pageTitle || u.username === pageTitle
                );
                if (!friend) return;
                
                chatKey = [currentUser.id, friend.id].sort().join('_');
            }
            
            // Criar mensagem
            const message = {
                id: Date.now().toString(),
                senderId: currentUser.id,
                content: content,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            // Adicionar ao histórico
            if (!messages[chatKey]) messages[chatKey] = [];
            messages[chatKey].push(message);
            localStorage.setItem('algebraMessages', JSON.stringify(messages));
            
            // Adicionar ao chat
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message own';
            messageDiv.innerHTML = `
                <div class="message-avatar">${currentUser.avatar}</div>
                <div class="message-content">
                    <div class="message-header">
                        <div class="message-sender">Você</div>
                        <div class="message-time">Agora</div>
                    </div>
                    <div class="message-text">${content}</div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            // Limpar input e scroll
            input.value = '';
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Notificar outros usuários (simulado)
            if (isGroup) {
                // Notificar membros do grupo
                const members = group.members.filter(id => id !== currentUser.id);
                members.forEach(memberId => {
                    console.log(`Notificando ${memberId} sobre nova mensagem no grupo ${group.name}`);
                });
            } else {
                // Notificar amigo
                const friendId = chatKey.split('_').find(id => id !== currentUser.id);
                console.log(`Notificando ${friendId} sobre nova mensagem`);
            }
        }

        // PÁGINA: Amigos
        function loadFriendsPage() {
            const contentBody = document.getElementById('contentBody');
            const actions = document.getElementById('pageActions');
            
            actions.innerHTML = `
                <button class="action-btn" onclick="showAddFriendModal()">
                    <i class="fas fa-user-plus"></i> Adicionar Amigo
                </button>
            `;
            
            contentBody.innerHTML = `
                <div class="friends-container">
                    <div class="section-title" style="margin: 0 0 20px 0;">
                        <span>Solicitações de Amizade</span>
                    </div>
                    <div id="friendRequestsList"></div>
                    
                    <div class="section-title" style="margin: 30px 0 20px 0;">
                        <span>Meus Amigos</span>
                    </div>
                    <div id="friendsList"></div>
                </div>
            `;
            
            loadFriendRequests();
            loadFriendsList();
        }

        function loadFriendsSidebar() {
            const sidebarContent = document.getElementById('sidebarContent');
            
            // Solicitações pendentes
            const requests = friendRequests[currentUser.id] || [];
            if (requests.length > 0) {
                sidebarContent.innerHTML += `
                    <div class="section-title">
                        <span>Solicitações Pendentes</span>
                        <span class="badge">${requests.length}</span>
                    </div>
                `;
                
                requests.forEach(requestId => {
                    const user = users.find(u => u.id === requestId);
                    if (!user) return;
                    
                    const item = document.createElement('div');
                    item.className = 'friend-item';
                    item.innerHTML = `
                        <div class="friend-avatar">${user.avatar}</div>
                        <div class="friend-info">
                            <div class="friend-name">${user.displayName || user.username}</div>
                            <div class="friend-status">Solicitação pendente</div>
                        </div>
                        <div class="friend-actions">
                            <button onclick="acceptFriendRequest('${user.id}')" style="background: var(--success); border: none; color: white; padding: 5px 10px; border-radius: 5px; margin-right: 5px;">✓</button>
                            <button onclick="declineFriendRequest('${user.id}')" style="background: var(--error); border: none; color: white; padding: 5px 10px; border-radius: 5px;">✗</button>
                        </div>
                    `;
                    
                    sidebarContent.appendChild(item);
                });
            }
            
            // Lista de amigos
            const friends = getFriendsList();
            if (friends.length > 0) {
                sidebarContent.innerHTML += `
                    <div class="section-title">
                        <span>Amigos</span>
                    </div>
                `;
                
                friends.forEach(friend => {
                    const isOnline = onlineUsers.includes(friend.id);
                    
                    const item = document.createElement('div');
                    item.className = `friend-item ${isOnline ? 'online' : ''}`;
                    item.innerHTML = `
                        <div class="friend-avatar">
                            ${friend.avatar}
                            <div class="status ${isOnline ? 'online' : 'offline'}"></div>
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${friend.displayName || friend.username}</div>
                            <div class="friend-status">${isOnline ? 'Online' : 'Offline'}</div>
                        </div>
                    `;
                    
                    item.addEventListener('click', () => openChat(friend.id));
                    sidebarContent.appendChild(item);
                });
            }
        }

        function loadFriendRequests() {
            const requestsList = document.getElementById('friendRequestsList');
            const requests = friendRequests[currentUser.id] || [];
            
            if (requests.length === 0) {
                requestsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-clock"></i>
                        <p>Nenhuma solicitação de amizade pendente</p>
                    </div>
                `;
                return;
            }
            
            requestsList.innerHTML = '';
            requests.forEach(requestId => {
                const user = users.find(u => u.id === requestId);
                if (!user) return;
                
                const div = document.createElement('div');
                div.className = 'friend-item';
                div.innerHTML = `
                    <div class="friend-avatar">${user.avatar}</div>
                    <div class="friend-info">
                        <div class="friend-name">${user.displayName || user.username}</div>
                        <div class="friend-status">Quer ser seu amigo</div>
                    </div>
                    <div class="friend-actions">
                        <button class="action-btn" onclick="acceptFriendRequest('${user.id}')" style="background: var(--success);">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="action-btn" onclick="declineFriendRequest('${user.id}')" style="background: var(--error);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                requestsList.appendChild(div);
            });
        }

        function loadFriendsList() {
            const friendsList = document.getElementById('friendsList');
            const friends = getFriendsList();
            
            if (friends.length === 0) {
                friendsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-friends"></i>
                        <p>Você ainda não tem amigos. Adicione alguns!</p>
                        <button class="action-btn" onclick="showAddFriendModal()" style="margin-top: 15px;">
                            <i class="fas fa-user-plus"></i> Adicionar Amigos
                        </button>
                    </div>
                `;
                return;
            }
            
            friendsList.innerHTML = '';
            friends.forEach(friend => {
                const isOnline = onlineUsers.includes(friend.id);
                
                const div = document.createElement('div');
                div.className = 'friend-item';
                div.innerHTML = `
                    <div class="friend-avatar">
                        ${friend.avatar}
                        <div class="status ${isOnline ? 'online' : 'offline'}"></div>
                    </div>
                    <div class="friend-info">
                        <div class="friend-name">${friend.displayName || friend.username}</div>
                        <div class="friend-status">${isOnline ? 'Online' : 'Offline'}</div>
                    </div>
                    <div class="friend-actions">
                        <button class="action-btn" onclick="openChat('${friend.id}')">
                            <i class="fas fa-comment"></i>
                        </button>
                        <button class="action-btn" onclick="removeFriend('${friend.id}')" style="background: var(--error);">
                            <i class="fas fa-user-minus"></i>
                        </button>
                    </div>
                `;
                
                friendsList.appendChild(div);
            });
        }

        // Mostrar modal adicionar amigo
        function showAddFriendModal() {
            document.getElementById('addFriendModal').classList.remove('hidden');
        }

        // Enviar solicitação de amizade
        function sendFriendRequest() {
            const username = document.getElementById('addFriendUsername').value.trim();
            
            if (!username) {
                alert("Digite um nome de usuário.");
                return;
            }
            
            if (username === currentUser.username) {
                alert("Você não pode adicionar a si mesmo.");
                return;
            }
            
            const friend = users.find(u => u.username === username);
            if (!friend) {
                alert("Usuário não encontrado.");
                return;
            }
            
            // Verificar se já são amigos
            if (friends[currentUser.id]?.includes(friend.id)) {
                alert("Vocês já são amigos!");
                return;
            }
            
            // Verificar se já existe solicitação
            if (friendRequests[friend.id]?.includes(currentUser.id)) {
                alert("Solicitação já enviada.");
                return;
            }
            
            // Adicionar solicitação
            if (!friendRequests[friend.id]) friendRequests[friend.id] = [];
            friendRequests[friend.id].push(currentUser.id);
            localStorage.setItem('algebraFriendRequests', JSON.stringify(friendRequests));
            
            closeModal('addFriendModal');
            alert(`Solicitação enviada para ${username}!`);
            
            // Atualizar badge
            updateFriendRequestsBadge();
        }

        // Aceitar solicitação
        function acceptFriendRequest(userId) {
            // Remover da lista de solicitações
            if (friendRequests[currentUser.id]) {
                friendRequests[currentUser.id] = friendRequests[currentUser.id].filter(id => id !== userId);
                localStorage.setItem('algebraFriendRequests', JSON.stringify(friendRequests));
            }
            
            // Adicionar como amigo
            if (!friends[currentUser.id]) friends[currentUser.id] = [];
            if (!friends[userId]) friends[userId] = [];
            
            if (!friends[currentUser.id].includes(userId)) {
                friends[currentUser.id].push(userId);
            }
            if (!friends[userId].includes(currentUser.id)) {
                friends[userId].push(currentUser.id);
            }
            
            localStorage.setItem('algebraFriends', JSON.stringify(friends));
            
            // Atualizar interface
            loadFriendRequests();
            loadFriendsList();
            if (document.getElementById('sidebarContent')) {
                loadFriendsSidebar();
            }
            
            updateFriendRequestsBadge();
            alert("Amigo adicionado!");
        }

        // Recusar solicitação
        function declineFriendRequest(userId) {
            if (friendRequests[currentUser.id]) {
                friendRequests[currentUser.id] = friendRequests[currentUser.id].filter(id => id !== userId);
                localStorage.setItem('algebraFriendRequests', JSON.stringify(friendRequests));
            }
            
            loadFriendRequests();
            if (document.getElementById('sidebarContent')) {
                loadFriendsSidebar();
            }
            
            updateFriendRequestsBadge();
        }

        // Remover amigo
        function removeFriend(userId) {
            if (!confirm("Tem certeza que deseja remover este amigo?")) return;
            
            if (friends[currentUser.id]) {
                friends[currentUser.id] = friends[currentUser.id].filter(id => id !== userId);
            }
            if (friends[userId]) {
                friends[userId] = friends[userId].filter(id => id !== currentUser.id);
            }
            
            localStorage.setItem('algebraFriends', JSON.stringify(friends));
            loadFriendsList();
            
            if (document.getElementById('sidebarContent')) {
                loadFriendsSidebar();
            }
        }

        // PÁGINA: Grupos
        function loadGroupsPage() {
            const contentBody = document.getElementById('contentBody');
            const actions = document.getElementById('pageActions');
            
            actions.innerHTML = `
                <button class="action-btn" onclick="showCreateGroupModal()">
                    <i class="fas fa-plus"></i> Criar Grupo
                </button>
            `;
            
            contentBody.innerHTML = `
                <div class="groups-container" id="groupsList"></div>
            `;
            
            loadGroupsList();
        }

        function loadGroupsSidebar() {
            const sidebarContent = document.getElementById('sidebarContent');
            const userGroups = groups.filter(g => g.members.includes(currentUser.id));
            
            if (userGroups.length > 0) {
                sidebarContent.innerHTML += `
                    <div class="section-title">
                        <span>Meus Grupos</span>
                    </div>
                `;
                
                userGroups.forEach(group => {
                    const item = document.createElement('div');
                    item.className = 'group-item';
                    item.innerHTML = `
                        <div class="group-avatar">${getInitials(group.name)}</div>
                        <div class="group-info">
                            <div class="group-name">${group.name}</div>
                            <div class="group-members">${group.members.length} membros</div>
                        </div>
                    `;
                    
                    item.addEventListener('click', () => openGroupChat(group.id));
                    sidebarContent.appendChild(item);
                });
            }
        }

        function loadGroupsList() {
            const groupsList = document.getElementById('groupsList');
            const userGroups = groups.filter(g => g.members.includes(currentUser.id));
            
            if (userGroups.length === 0) {
                groupsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>Você não está em nenhum grupo</h3>
                        <p>Crie um grupo ou peça para ser adicionado a um existente</p>
                        <button class="action-btn" onclick="showCreateGroupModal()" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Criar Primeiro Grupo
                        </button>
                    </div>
                `;
                return;
            }
            
            groupsList.innerHTML = '';
            userGroups.forEach(group => {
                const membersCount = group.members.length;
                const isOwner = group.owner === currentUser.id;
                
                const card = document.createElement('div');
                card.className = 'group-card';
                card.innerHTML = `
                    <div class="group-card-header">
                        <div class="group-card-avatar">${getInitials(group.name)}</div>
                        <div>
                            <div class="group-card-name">${group.name}</div>
                            <div class="group-card-members">${membersCount} membro${membersCount !== 1 ? 's' : ''}</div>
                        </div>
                    </div>
                    <div class="group-card-description">${group.description || 'Sem descrição'}</div>
                    <div class="group-card-actions">
                        <button class="group-btn primary" onclick="openGroupChat('${group.id}')">
                            <i class="fas fa-comments"></i> Chat
                        </button>
                        ${isOwner ? `
                        <button class="group-btn" onclick="editGroup('${group.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        ` : ''}
                    </div>
                `;
                
                groupsList.appendChild(card);
            });
        }

        // Mostrar modal criar grupo
        function showCreateGroupModal() {
            document.getElementById('createGroupModal').classList.remove('hidden');
        }

        // Criar grupo
        function createGroup() {
            const name = document.getElementById('groupName').value.trim();
            const description = document.getElementById('groupDescription').value.trim();
            const membersInput = document.getElementById('groupMembers').value.trim();
            
            if (!name) {
                alert("Digite um nome para o grupo.");
                return;
            }
            
            // Processar membros
            let memberIds = [currentUser.id]; // Adicionar criador
            if (membersInput) {
                const usernames = membersInput.split(',').map(u => u.trim());
                usernames.forEach(username => {
                    const user = users.find(u => u.username === username);
                    if (user && user.id !== currentUser.id) {
                        memberIds.push(user.id);
                    }
                });
            }
            
            // Criar grupo
            const group = {
                id: Date.now().toString(),
                name: name,
                description: description,
                owner: currentUser.id,
                members: memberIds,
                createdAt: new Date().toISOString()
            };
            
            groups.push(group);
            localStorage.setItem('algebraGroups', JSON.stringify(groups));
            
            closeModal('createGroupModal');
            alert(`Grupo "${name}" criado com sucesso!`);
            
            // Limpar formulário
            document.getElementById('groupName').value = '';
            document.getElementById('groupDescription').value = '';
            document.getElementById('groupMembers').value = '';
            
            // Atualizar interface
            loadGroupsList();
            if (document.getElementById('sidebarContent')) {
                loadGroupsSidebar();
            }
        }

        // Editar grupo
        function editGroup(groupId) {
            const group = groups.find(g => g.id === groupId);
            if (!group || group.owner !== currentUser.id) return;
            
            const newName = prompt("Novo nome do grupo:", group.name);
            if (newName) {
                group.name = newName;
                localStorage.setItem('algebraGroups', JSON.stringify(groups));
                loadGroupsList();
                
                if (document.getElementById('sidebarContent')) {
                    loadGroupsSidebar();
                }
            }
        }

        // PÁGINA: Perfil
        function loadProfilePage() {
            const contentBody = document.getElementById('contentBody');
            
            contentBody.innerHTML = `
                <div class="profile-container">
                    <div class="profile-header">
                        <div class="profile-avatar-upload" onclick="changeAvatar()">
                            <div class="profile-avatar" id="profileAvatar">
                                ${currentUser.avatar}
                            </div>
                            <div class="avatar-overlay">
                                <i class="fas fa-camera"></i>
                            </div>
                        </div>
                        <div class="profile-name" id="profileName">${currentUser.displayName || currentUser.username}</div>
                        <div class="profile-status" id="profileStatus">${currentUser.bio || 'Membro do Algebra Renova'}</div>
                    </div>
                    
                    <div class="profile-form">
                        <div class="form-row">
                            <div class="form-group half">
                                <label class="form-label">Nome de exibição</label>
                                <input type="text" id="displayName" class="form-input" value="${currentUser.displayName || ''}" placeholder="Seu nome para exibição">
                            </div>
                            <div class="form-group half">
                                <label class="form-label">Status</label>
                                <select id="userStatusSelect" class="form-input">
                                    <option value="online" ${currentUser.status === 'online' ? 'selected' : ''}>Online</option>
                                    <option value="idle" ${currentUser.status === 'idle' ? 'selected' : ''}>Ausente</option>
                                    <option value="dnd" ${currentUser.status === 'dnd' ? 'selected' : ''}>Não Perturbe</option>
                                    <option value="offline" ${currentUser.status === 'offline' ? 'selected' : ''}>Offline</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Biografia</label>
                            <textarea id="userBio" class="form-input" rows="4" placeholder="Fale sobre seus interesses matemáticos...">${currentUser.bio || ''}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Nova senha (opcional)</label>
                            <input type="password" id="newPassword" class="form-input" placeholder="Deixe em branco para manter a atual">
                        </div>
                        
                        <button class="login-btn" onclick="saveProfile()" style="margin-top: 20px;">
                            <i class="fas fa-save"></i> Salvar Alterações
                        </button>
                    </div>
                </div>
            `;
        }

        // Mudar avatar
        function changeAvatar() {
            const initials = prompt("Digite novas iniciais (2 letras):", currentUser.avatar);
            if (initials && initials.length === 2) {
                currentUser.avatar = initials.toUpperCase();
                document.getElementById('profileAvatar').textContent = currentUser.avatar;
                saveUserData();
                
                // Atualizar em todos os lugares
                updateUserInAllChats();
            }
        }

        // Salvar perfil
        function saveProfile() {
            const displayName = document.getElementById('displayName').value.trim();
            const status = document.getElementById('userStatusSelect').value;
            const bio = document.getElementById('userBio').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            
            currentUser.displayName = displayName || currentUser.username;
            currentUser.status = status;
            currentUser.bio = bio;
            
            if (newPassword) {
                currentUser.password = newPassword;
            }
            
            // Atualizar no array de usuários
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('algebraUsers', JSON.stringify(users));
                localStorage.setItem('algebraCurrentUser', JSON.stringify(currentUser));
            }
            
            alert("Perfil atualizado com sucesso!");
            
            // Atualizar exibição
            document.getElementById('profileName').textContent = currentUser.displayName;
            document.getElementById('profileStatus').textContent = currentUser.bio;
        }

        // PÁGINA: Colaboração
        function loadCollaborationPage() {
            const contentBody = document.getElementById('contentBody');
            
            contentBody.innerHTML = `
                <div class="collaboration-container">
                    <div style="text-align: center; padding: 40px 20px;">
                        <i class="fas fa-code-branch" style="font-size: 64px; color: var(--accent-primary); margin-bottom: 20px;"></i>
                        <h2 style="margin-bottom: 15px;">Área de Colaboração</h2>
                        <p style="color: var(--text-muted); max-width: 600px; margin: 0 auto 30px;">
                            Colabore em tempo real com seus amigos e grupos. 
                            Crie documentos matemáticos, compartilhe telas e trabalhe juntos em projetos.
                        </p>
                        
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button class="action-btn" onclick="startCollaboration('document')" style="padding: 15px 25px;">
                                <i class="fas fa-file-alt"></i> Novo Documento
                            </button>
                            <button class="action-btn" onclick="startCollaboration('whiteboard')" style="padding: 15px 25px;">
                                <i class="fas fa-chalkboard"></i> Quadro Branco
                            </button>
                            <button class="action-btn" onclick="startCollaboration('code')" style="padding: 15px 25px;">
                                <i class="fas fa-code"></i> Editor de Código
                            </button>
                        </div>
                        
                        <div style="margin-top: 40px; text-align: left; max-width: 800px; margin-left: auto; margin-right: auto;">
                            <h3 style="margin-bottom: 15px;">Colaborações Recentes</h3>
                            <div id="recentCollaborations" style="background: var(--bg-secondary); border-radius: 10px; padding: 20px;">
                                <div class="empty-state">
                                    <i class="fas fa-clock"></i>
                                    <p>Nenhuma colaboração recente</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Iniciar colaboração
        function startCollaboration(type) {
            let roomName = prompt(`Nome da sala de ${type}:`);
            if (!roomName) return;
            
            // Criar ID único para a sala
            const roomId = Date.now().toString();
            
            // Redirecionar para sala (simulado)
            alert(`Sala "${roomName}" criada! ID: ${roomId}\n\nEm uma versão completa, isso abriria uma nova janela com ferramentas de colaboração em tempo real.`);
            
            // Adicionar às recentes
            const recent = document.getElementById('recentCollaborations');
            if (recent.querySelector('.empty-state')) {
                recent.innerHTML = '';
            }
            
            const item = document.createElement('div');
            item.className = 'friend-item';
            item.innerHTML = `
                <div class="friend-avatar">
                    <i class="fas fa-${type === 'document' ? 'file-alt' : type === 'whiteboard' ? 'chalkboard' : 'code'}"></i>
                </div>
                <div class="friend-info">
                    <div class="friend-name">${roomName}</div>
                    <div class="friend-status">${type} • Criado agora</div>
                </div>
                <div class="friend-actions">
                    <button class="action-btn" onclick="joinCollaboration('${roomId}')">
                        <i class="fas fa-join"></i> Entrar
                    </button>
                </div>
            `;
            
            recent.prepend(item);
        }

        // Mostrar modal upload arquivo
        function showUploadFileModal() {
            document.getElementById('uploadFileModal').classList.remove('hidden');
        }

        // Upload de arquivo (simulado)
        function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const description = document.getElementById('fileDescription').value.trim();
            
            if (!fileInput.files[0]) {
                alert("Selecione um arquivo.");
                return;
            }
            
            const file = fileInput.files[0];
            
            // Em uma implementação real, aqui enviaríamos para um servidor
            alert(`Arquivo "${file.name}" enviado com sucesso!${description ? '\nDescrição: ' + description : ''}`);
            
            closeModal('uploadFileModal');
            
            // Limpar formulário
            fileInput.value = '';
            document.getElementById('fileDescription').value = '';
            
            // Adicionar mensagem no chat atual (se houver)
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.value = `[Arquivo enviado: ${file.name}] ${description}`;
            }
        }

        // Fechar modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Logout
        function logout() {
            if (confirm("Deseja sair?")) {
                // Remover do online
                onlineUsers = onlineUsers.filter(id => id !== currentUser.id);
                localStorage.setItem('algebraOnline', JSON.stringify(onlineUsers));
                
                // Limpar usuário atual
                currentUser = null;
                localStorage.removeItem('algebraCurrentUser');
                
                // Mostrar login
                document.getElementById('appScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                
                // Limpar campos
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
            }
        }

        // Funções auxiliares
        function getFriendsList() {
            const friendIds = friends[currentUser.id] || [];
            return users.filter(u => friendIds.includes(u.id));
        }

        function getLastMessage(userId) {
            const chatKey = [currentUser.id, userId].sort().join('_');
            const chat = messages[chatKey] || [];
            if (chat.length === 0) return null;
            
            const lastMsg = chat[chat.length - 1];
            return lastMsg.content.substring(0, 30) + (lastMsg.content.length > 30 ? '...' : '');
        }

        function updateFriendRequestsBadge() {
            const requests = friendRequests[currentUser.id] || [];
            const badge = document.getElementById('friendRequestsBadge');
            if (badge) {
                badge.textContent = requests.length;
                badge.style.display = requests.length > 0 ? 'block' : 'none';
            }
        }

        function formatTime(isoString) {
            const date = new Date(isoString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Agora';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}min atrás`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h atrás`;
            
            return date.toLocaleDateString('pt-BR');
        }

        function getInitials(name) {
            return name.split(' ')
                .map(word => word.charAt(0))
                .join('')
                .toUpperCase()
                .substring(0, 2) || '??';
        }

        function saveUserData() {
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('algebraUsers', JSON.stringify(users));
                localStorage.setItem('algebraCurrentUser', JSON.stringify(currentUser));
            }
        }

        function updateUserInAllChats() {
            // Em uma implementação real, atualizaria o avatar em todas as mensagens
            console.log("Avatar atualizado em todo o sistema");
        }

        function showRegister() {
            alert("Para criar uma conta, basta digitar um nome de usuário e senha no login. O sistema criará automaticamente.");
        }
    </script>
</body>
</html>
