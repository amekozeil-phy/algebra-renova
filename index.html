<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Renova - Rede Social Cient√≠fica</title>
    <!-- MathJax para renderiza√ß√£o de LaTeX -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary-dark: #0a0a0f;
            --secondary-dark: #12121a;
            --accent-gold: #d4af37;
            --accent-neon: #00ffff;
            --accent-renovated: #9b59b6;
            --accent-observer: #7f8c8d;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #2a2a3a;
            --card-bg: #161622;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--primary-dark);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(100, 100, 150, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(180, 180, 220, 0.05) 0%, transparent 20%);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Barra Lateral */
        .sidebar {
            width: 300px;
            background-color: var(--secondary-dark);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
        }

        .logo-container {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: 2px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--accent-gold), var(--accent-neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }

        .logo::after {
            content: "‚üÅ";
            position: absolute;
            right: -25px;
            top: 0;
            font-size: 20px;
            color: var(--accent-gold);
        }

        .motto {
            font-style: italic;
            color: var(--text-secondary);
            font-size: 12px;
            letter-spacing: 1px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #2a2a3a, #1a1a2a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin-right: 15px;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }

        /* Cores dos n√≠veis */
        .avatar.observer { border: 2px solid var(--accent-observer); }
        .avatar.initiate { border: 2px solid var(--accent-neon); box-shadow: 0 0 10px rgba(0, 255, 255, 0.3); }
        .avatar.renovated { border: 2px solid var(--accent-renovated); box-shadow: 0 0 10px rgba(155, 89, 182, 0.3); }
        .avatar.core { 
            border: 2px solid var(--accent-gold); 
            box-shadow: 0 0 20px var(--accent-gold), inset 0 0 10px rgba(212, 175, 55, 0.3);
        }

        .avatar.bot::after {
            content: "ü§ñ";
            position: absolute;
            bottom: -5px;
            right: -5px;
            font-size: 16px;
            background: var(--secondary-dark);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .user-info.observer h3 { color: var(--accent-observer); }
        .user-info.initiate h3 { color: var(--accent-neon); }
        .user-info.renovated h3 { color: var(--accent-renovated); }
        .user-info.core h3 { color: var(--accent-gold); }

        .user-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .user-stats {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .bot-badge {
            background: rgba(155, 89, 182, 0.2);
            color: var(--accent-renovated);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        /* Navega√ß√£o */
        .nav-tabs {
            display: flex;
            flex-direction: column;
            margin-bottom: 25px;
        }

        .tab-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            text-align: left;
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            font-size: 16px;
        }

        .tab-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .tab-btn.active {
            background-color: rgba(100, 100, 150, 0.2);
            color: var(--accent-neon);
            border-left: 3px solid var(--accent-neon);
        }

        .tab-btn i {
            margin-right: 10px;
            font-size: 18px;
        }

        .tab-badge {
            background: var(--accent-neon);
            color: var(--primary-dark);
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
            font-weight: bold;
        }

        /* Lista de Amigos */
        .friends-section {
            margin-top: auto;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .section-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .friends-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .friend-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .friend-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .friend-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3a3a4a, #2a2a3a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-right: 10px;
            background-size: cover;
            background-position: center;
        }

        .friend-name {
            font-size: 14px;
            flex: 1;
        }

        .friend-level {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Conte√∫do Principal */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .page-title {
            font-size: 28px;
            background: linear-gradient(45deg, var(--accent-gold), var(--accent-neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Card de Conte√∫do */
        .content-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .content-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            color: var(--text-primary);
        }

        .card-date {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .card-author {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            background-size: cover;
            background-position: center;
        }

        .author-info h4 {
            font-size: 16px;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .author-info p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .theory-content {
            line-height: 1.6;
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .theory-content p {
            margin-bottom: 15px;
        }

        .theory-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-pending { background: rgba(241, 196, 15, 0.2); color: #f1c40f; }
        .status-approved { background: rgba(46, 204, 113, 0.2); color: var(--success); }
        .status-rejected { background: rgba(231, 76, 60, 0.2); color: var(--danger); }

        /* Bot√µes */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #2a2a3a, #1a1a2a);
            color: var(--accent-neon);
            border: 1px solid var(--accent-neon);
        }

        .btn-primary:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2a2a3a, #1a1a2a);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #d35400, #f39c12);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #c0392b, #e74c3c);
            color: white;
        }

        .btn-small {
            padding: 5px 12px;
            font-size: 12px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            width: 90%;
            max-width: 700px;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            color: var(--accent-neon);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: var(--accent-neon);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            resize: vertical;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-neon);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .form-textarea {
            min-height: 150px;
            font-family: 'Courier New', monospace;
            line-height: 1.5;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 25px;
        }

        /* Upload de Foto */
        .avatar-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3a3a4a, #2a2a3a);
            margin-bottom: 15px;
            background-size: cover;
            background-position: center;
            border: 2px solid var(--border-color);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .avatar-preview:hover::after {
            content: "Alterar";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .avatar-input {
            display: none;
        }

        /* Coment√°rios */
        .comments-section {
            margin-top: 30px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .comment-form {
            margin-bottom: 25px;
        }

        .comment-form textarea {
            min-height: 100px;
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .comment {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            border-left: 3px solid var(--border-color);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .comment-author {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .comment-author-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            background-size: cover;
            background-position: center;
        }

        .comment-content {
            line-height: 1.5;
            color: var(--text-primary);
        }

        .comment-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Grupos */
        .groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .group-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .group-card:hover {
            border-color: var(--accent-neon);
            transform: translateY(-5px);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .group-name {
            font-size: 18px;
            color: var(--accent-neon);
        }

        .group-members {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .group-description {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .group-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tag {
            background: rgba(0, 255, 255, 0.1);
            color: var(--accent-neon);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .group-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Chat do Grupo */
        .group-chat-container {
            display: flex;
            flex-direction: column;
            height: 500px;
            background-color: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .group-chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.2);
        }

        .group-chat-back-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            margin-right: 15px;
            cursor: pointer;
        }

        .group-chat-info h4 {
            font-size: 18px;
            color: var(--accent-neon);
        }

        .group-chat-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .group-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .group-message {
            max-width: 80%;
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.4;
            position: relative;
        }

        .group-message.sent {
            align-self: flex-end;
            background-color: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-bottom-right-radius: 5px;
        }

        .group-message.received {
            align-self: flex-start;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 5px;
        }

        .group-message-author {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-secondary);
        }

        .group-message-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
            text-align: right;
        }

        .group-chat-input-area {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
        }

        .group-chat-input {
            flex: 1;
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
        }

        .group-chat-input:focus {
            outline: none;
            border-color: var(--accent-neon);
        }

        /* Desafios */
        .challenges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .challenge-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .challenge-card:hover {
            border-color: var(--accent-warning);
            transform: translateY(-5px);
        }

        .challenge-difficulty {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .difficulty-easy { background: rgba(46, 204, 113, 0.2); color: var(--success); }
        .difficulty-medium { background: rgba(241, 196, 15, 0.2); color: #f1c40f; }
        .difficulty-hard { background: rgba(231, 76, 60, 0.2); color: var(--danger); }
        .difficulty-extreme { background: rgba(155, 89, 182, 0.2); color: var(--accent-renovated); }

        /* Tabela de Hierarquia */
        .hierarchy-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .hierarchy-table th, .hierarchy-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .hierarchy-table th {
            color: var(--accent-neon);
            font-weight: 600;
        }

        .hierarchy-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .level-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-observer { background: rgba(127, 140, 141, 0.2); color: var(--accent-observer); }
        .badge-initiate { background: rgba(0, 255, 255, 0.2); color: var(--accent-neon); }
        .badge-renovated { background: rgba(155, 89, 182, 0.2); color: var(--accent-renovated); }
        .badge-core { background: rgba(212, 175, 55, 0.2); color: var(--accent-gold); }

        /* Chat Privado */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            background-color: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.2);
        }

        .chat-back-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            margin-right: 15px;
            cursor: pointer;
        }

        .chat-friend-info h4 {
            font-size: 18px;
        }

        .chat-friend-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            max-width: 70%;
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.4;
            position: relative;
        }

        .message.sent {
            align-self: flex-end;
            background-color: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-bottom-right-radius: 5px;
        }

        .message.received {
            align-self: flex-start;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
            text-align: right;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent-neon);
        }

        /* Solicita√ß√µes de Amizade */
        .requests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .request-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--border-color);
        }

        .request-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .request-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            background-size: cover;
            background-position: center;
        }

        .request-info h4 {
            font-size: 16px;
            margin-bottom: 3px;
        }

        .request-info p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .request-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .request-actions .btn-small {
            flex: 1;
        }

        /* LaTeX Preview */
        .latex-preview {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px dashed var(--border-color);
            min-height: 80px;
        }

        .latex-preview-title {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        /* Badges e Status */
        .status-online {
            color: var(--success);
            font-size: 12px;
        }

        .status-offline {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Contribui√ß√µes */
        .contributions {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .contribution-item {
            text-align: center;
        }

        .contribution-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-neon);
        }

        .contribution-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Responsividade */
        @media (max-width: 1024px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 400px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .groups-grid, .challenges-grid, .requests-grid {
                grid-template-columns: 1fr;
            }
            
            .hierarchy-table {
                display: block;
                overflow-x: auto;
            }
        }

        /* Anima√ß√µes */
        .pulse-gold {
            animation: pulseGold 2s infinite;
        }

        @keyframes pulseGold {
            0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }

        /* Loader */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-neon);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* A√ß√µes do N√∫cleo */
        .nucleus-actions {
            background: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .nucleus-actions h4 {
            color: var(--accent-gold);
            margin-bottom: 10px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
    <!-- √çcones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Modal de Login -->
    <div class="modal active" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Algebra Renova - Acesso</h2>
            </div>
            <form id="loginForm">
                <div class="avatar-upload">
                    <div class="avatar-preview" id="avatarPreviewLogin" style="background-image: url('https://api.dicebear.com/7.x/identicon/svg?seed=AlgebraRenova')"></div>
                    <input type="file" id="avatarUploadLogin" class="avatar-input" accept="image/*">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="username">Nome de Usu√°rio</label>
                    <input type="text" id="username" class="form-input" placeholder="Digite seu nome de usu√°rio" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="userEmail">Email</label>
                    <input type="email" id="userEmail" class="form-input" placeholder="seu@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">N√≠vel Inicial (Todos come√ßam como Observadores)</label>
                    <select id="initialLevel" class="form-input" disabled>
                        <option value="observer">Observador</option>
                    </select>
                    <small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 5px;">
                        Todos iniciam como Observadores. Suba de n√≠vel contribuindo!
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Chave Especial do N√∫cleo (opcional)</label>
                    <input type="password" id="nucleusKey" class="form-input" placeholder="Digite apenas se tiver a chave especial">
                    <small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 5px;">
                        Apenas para membros do N√∫cleo: "Renova, O Not Trad"
                    </small>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Entrar na Revolu√ß√£o
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="app-container" style="display: none;" id="mainApp">
        <!-- Barra Lateral -->
        <aside class="sidebar">
            <div class="logo-container">
                <div class="logo">ALGEBRA RENOVA</div>
                <div class="motto">Revolution. Algebra et Perseverantia.</div>
            </div>

            <!-- Perfil do Usu√°rio -->
            <div class="user-profile">
                <div class="avatar" id="userAvatar">
                    <!-- Avatar ser√° carregado via JS -->
                </div>
                <div class="user-info" id="userInfo">
                    <h3 id="userName">An√¥nimo <span id="userBotBadge" class="bot-badge" style="display: none;">BOT</span></h3>
                    <p id="userSpecialty">Observador</p>
                    <div class="user-stats">
                        <div class="stat" id="contributionPoints">0 pontos</div>
                        <div class="stat" id="theoriesCount">0 teorias</div>
                    </div>
                </div>
            </div>

            <!-- Navega√ß√£o -->
            <div class="nav-tabs">
                <button class="tab-btn active" data-tab="home">
                    <i class="fas fa-home"></i> Home
                </button>
                <button class="tab-btn" data-tab="theories">
                    <i class="fas fa-atom"></i> Teorias
                    <span class="tab-badge" id="pendingTheoriesBadge" style="display: none;">0</span>
                </button>
                <button class="tab-btn" data-tab="groups">
                    <i class="fas fa-users"></i> Grupos
                </button>
                <button class="tab-btn" data-tab="challenges">
                    <i class="fas fa-puzzle-piece"></i> Desafios
                </button>
                <button class="tab-btn" data-tab="members">
                    <i class="fas fa-user-friends"></i> Membros
                    <span class="tab-badge" id="friendRequestsBadge" style="display: none;">0</span>
                </button>
                <button class="tab-btn" data-tab="hierarchy">
                    <i class="fas fa-sitemap"></i> Hierarquia
                </button>
                <button class="tab-btn" data-tab="profile">
                    <i class="fas fa-user-edit"></i> Perfil
                </button>
                <button class="tab-btn" data-tab="chat">
                    <i class="fas fa-comments"></i> Chat
                </button>
            </div>

            <!-- Lista de Amigos -->
            <div class="friends-section">
                <div class="section-title">
                    <span>Contactos Diretos</span>
                    <span id="friendsCount">0</span>
                </div>
                <div class="friends-list" id="friendsList">
                    <!-- Lista de amigos ser√° preenchida via JS -->
                    <div class="friend-item" style="justify-content: center; color: var(--text-secondary);">
                        Nenhum contacto ainda
                    </div>
                </div>
            </div>

            <!-- Logout -->
            <button class="btn btn-secondary" id="logoutBtn" style="margin-top: 20px;">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </aside>

        <!-- Conte√∫do Principal -->
        <main class="main-content">
            <!-- Home -->
            <div class="tab-content active" id="homeContent">
                <div class="page-header">
                    <h1 class="page-title">Algebra Renova</h1>
                    <div>
                        <button class="btn btn-primary" id="newTheoryBtn">
                            <i class="fas fa-plus"></i> Nova Teoria
                        </button>
                        <button class="btn btn-warning" id="newChallengeBtn">
                            <i class="fas fa-puzzle-piece"></i> Novo Desafio
                        </button>
                    </div>
                </div>
                
                <div class="content-card">
                    <h2 class="card-title">Bem-vindo √† Revolu√ß√£o</h2>
                    <div class="card-date" id="currentDate">Carregando data...</div>
                    <div class="theory-content">
                        <p>"Algebra Renova √© mais do que um grupo de pesquisa. √â uma rebeli√£o matem√°tica. Uma revolu√ß√£o intelectual. Uma reconstru√ß√£o dos pr√≥prios fundamentos do pensamento estrutural e alg√©brico."</p>
                        <p>Aqui, desenvolvemos novas teorias rigorosas e fundamos subcampos dentro da √°lgebra e matem√°tica abstrata que a pr√≥pria matem√°tica n√£o consegue tratar mesmo com √°reas t√©cnicas.</p>
                        
                        <div class="contributions">
                            <div class="contribution-item">
                                <div class="contribution-value" id="totalTheoriesHome">0</div>
                                <div class="contribution-label">Teorias Publicadas</div>
                            </div>
                            <div class="contribution-item">
                                <div class="contribution-value" id="totalChallengesHome">0</div>
                                <div class="contribution-label">Desafios Ativos</div>
                            </div>
                            <div class="contribution-item">
                                <div class="contribution-value" id="totalGroupsHome">0</div>
                                <div class="contribution-label">Grupos de Pesquisa</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-card">
                    <h2 class="card-title">Teorias Recentes</h2>
                    <div id="recentTheories">
                        <!-- Teorias recentes ser√£o carregadas aqui -->
                    </div>
                </div>

                <div class="content-card">
                    <h2 class="card-title">Desafios Ativos</h2>
                    <div id="recentChallenges">
                        <!-- Desafios recentes ser√£o carregadas aqui -->
                    </div>
                </div>
            </div>

            <!-- Teorias -->
            <div class="tab-content" id="theoriesContent">
                <div class="page-header">
                    <h1 class="page-title">Reposit√≥rio de Teorias</h1>
                    <button class="btn btn-primary" id="newTheoryBtn2">
                        <i class="fas fa-plus"></i> Nova Teoria
                    </button>
                </div>
                
                <div id="theoriesList">
                    <!-- Lista de teorias ser√° preenchida via JS -->
                </div>
            </div>

            <!-- Grupos -->
            <div class="tab-content" id="groupsContent">
                <div class="page-header">
                    <h1 class="page-title">Grupos de Pesquisa</h1>
                    <button class="btn btn-primary" id="newGroupBtn">
                        <i class="fas fa-plus"></i> Novo Grupo
                    </button>
                </div>
                
                <div id="groupsList">
                    <!-- Lista de grupos ser√° preenchida via JS -->
                </div>
            </div>

            <!-- Desafios -->
            <div class="tab-content" id="challengesContent">
                <div class="page-header">
                    <h1 class="page-title">Desafios Matem√°ticos</h1>
                    <button class="btn btn-warning" id="newChallengeBtn2">
                        <i class="fas fa-plus"></i> Novo Desafio
                    </button>
                </div>
                
                <div id="challengesList">
                    <!-- Lista de desafios ser√° preenchida via JS -->
                </div>
            </div>

            <!-- Membros -->
            <div class="tab-content" id="membersContent">
                <div class="page-header">
                    <h1 class="page-title">Membros da Comunidade</h1>
                    <button class="btn btn-primary" id="manageRequestsBtn" style="display: none;">
                        <i class="fas fa-user-plus"></i> Gerenciar Solicita√ß√µes
                    </button>
                </div>
                
                <!-- Solicita√ß√µes de Amizade (vis√≠vel apenas para usu√°rios reais) -->
                <div id="friendRequestsSection" style="display: none;">
                    <h2 style="margin-bottom: 15px; color: var(--accent-neon);">Solicita√ß√µes de Amizade</h2>
                    <div class="requests-grid" id="friendRequestsGrid">
                        <!-- Solicita√ß√µes ser√£o carregadas aqui -->
                    </div>
                    <hr style="margin: 25px 0; border-color: var(--border-color);">
                </div>
                
                <div id="membersGrid" class="members-grid">
                    <!-- Membros ser√£o carregados aqui -->
                </div>
            </div>

            <!-- Hierarquia -->
            <div class="tab-content" id="hierarchyContent">
                <div class="page-header">
                    <h1 class="page-title">Hierarquia do Algebra Renova</h1>
                </div>
                
                <div class="content-card">
                    <h2 class="card-title">Sistema de N√≠veis</h2>
                    <p style="margin-bottom: 20px; color: var(--text-secondary);">
                        A hierarquia √© baseada em contribui√ß√µes. Cada intera√ß√£o ganha pontos que podem levar √† promo√ß√£o.
                    </p>
                    
                    <table class="hierarchy-table">
                        <thead>
                            <tr>
                                <th>N√≠vel</th>
                                <th>Pontos Necess√°rios</th>
                                <th>Privil√©gios</th>
                                <th>Cor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="level-badge badge-observer">Observador</span></td>
                                <td>0</td>
                                <td>Visualizar teorias, participar de grupos b√°sicos</td>
                                <td><span style="color: var(--accent-observer);">‚óè</span> Cinza</td>
                            </tr>
                            <tr>
                                <td><span class="level-badge badge-initiate">Iniciado</span></td>
                                <td>500 pontos</td>
                                <td>Criar teorias, liderar grupos, responder desafios</td>
                                <td><span style="color: var(--accent-neon);">‚óè</span> Azul Neon</td>
                            </tr>
                            <tr>
                                <td><span class="level-badge badge-renovated">Renovado</span></td>
                                <td>1500 pontos</td>
                                <td>Aprovar teorias de iniciados, criar grupos avan√ßados</td>
                                <td><span style="color: var(--accent-renovated);">‚óè</span> Roxo</td>
                            </tr>
                            <tr>
                                <td><span class="level-badge badge-core">N√∫cleo</span></td>
                                <td>Chave Especial OU 15000 pontos</td>
                                <td>Aprovar/rejeitar teorias, moderar tudo, acesso total</td>
                                <td><span style="color: var(--accent-gold);">‚óè</span> Dourado</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 30px; padding: 20px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                        <h3 style="margin-bottom: 15px; color: var(--accent-neon);">Como Ganhar Pontos</h3>
                        <ul style="color: var(--text-secondary); line-height: 1.8;">
                            <li>Publicar uma teoria aprovada: <strong>+100 pontos</strong></li>
                            <li>Resolver um desafio: <strong>+50 pontos</strong></li>
                            <li>Comentar em teoria: <strong>+10 pontos</strong></li>
                            <li>Criar grupo: <strong>+30 pontos</strong></li>
                            <li>Participar ativamente em grupos: <strong>+5 pontos/dia</strong></li>
                            <li>Ajudar em d√∫vida: <strong>+20 pontos</strong></li>
                            <li>Ter teoria aprovada pelo N√∫cleo: <strong>+200 pontos</strong></li>
                        </ul>
                    </div>
                </div>
                
                <div class="content-card">
                    <h2 class="card-title">Seu Progresso</h2>
                    <div id="userProgress">
                        <!-- Progresso ser√° carregado aqui -->
                    </div>
                </div>
            </div>

            <!-- Perfil -->
            <div class="tab-content" id="profileContent">
                <div class="page-header">
                    <h1 class="page-title">Perfil</h1>
                </div>
                
                <div class="content-card">
                    <h2 class="card-title">Editar Perfil</h2>
                    <form id="profileForm">
                        <div class="avatar-upload">
                            <div class="avatar-preview" id="avatarPreview" style="background-image: url('https://api.dicebear.com/7.x/identicon/svg?seed=AlgebraRenova')"></div>
                            <input type="file" id="avatarUpload" class="avatar-input" accept="image/*">
                            <small style="color: var(--text-secondary); margin-top: 10px;">Clique na imagem para alterar sua foto</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="codename">Codinome Simb√≥lico</label>
                            <input type="text" id="codename" class="form-input" placeholder="Ex: 'Transfunctor' ou 'Anti-Identidade'" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="specialty">Especialidade Matem√°tica</label>
                            <input type="text" id="specialty" class="form-input" placeholder="Ex: 'Topologia Alg√©brica' ou 'Teoria das Categorias'" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="bio">Biografia</label>
                            <textarea id="bio" class="form-textarea" placeholder="Fale sobre seu interesse matem√°tico..." rows="3"></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                        </div>
                    </form>
                </div>
                
                <div class="content-card">
                    <h2 class="card-title">Suas Contribui√ß√µes</h2>
                    <div id="userContributions">
                        <!-- Contribui√ß√µes ser√£o carregadas aqui -->
                    </div>
                </div>
            </div>

            <!-- Chat -->
            <div class="tab-content" id="chatContent">
                <div class="page-header">
                    <h1 class="page-title">Chat Privado</h1>
                </div>
                
                <div id="chatSelection" class="content-card">
                    <h2 class="card-title">Selecione um contacto para conversar</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Clique em um amigo da lista √† esquerda para iniciar uma conversa</p>
                    <div id="chatPlaceholder" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>Nenhuma conversa selecionada</p>
                    </div>
                </div>
                
                <div id="chatContainer" class="chat-container" style="display: none;">
                    <!-- Chat ser√° carregado aqui -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para Nova Teoria -->
    <div class="modal" id="theoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Teoria Matem√°tica</h2>
                <button class="close-btn" id="closeTheoryModal">&times;</button>
            </div>
            <form id="theoryForm">
                <div class="form-group">
                    <label class="form-label" for="theoryTitle">T√≠tulo da Teoria</label>
                    <input type="text" id="theoryTitle" class="form-input" placeholder="Ex: 'Teoria da Transfunctora√ß√£o'" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="theoryCategory">Categoria</label>
                    <select id="theoryCategory" class="form-select">
                        <option value="algebra">√Ålgebra Abstrata</option>
                        <option value="topology">Topologia</option>
                        <option value="category">Teoria das Categorias</option>
                        <option value="logic">L√≥gica Matem√°tica</option>
                        <option value="geometry">Geometria N√£o-Euclidiana</option>
                        <option value="other">Outra</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="theoryContent">Conte√∫do (LaTeX suportado)</label>
                    <textarea id="theoryContent" class="form-textarea" placeholder="Escreva sua teoria aqui... Use $$...$$ para f√≥rmulas LaTeX" required rows="10"></textarea>
                    
                    <div class="latex-preview">
                        <div class="latex-preview-title">Pr√©-visualiza√ß√£o LaTeX:</div>
                        <div id="latexPreview"></div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelTheoryBtn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Enviar para Aprova√ß√£o</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Novo Grupo -->
    <div class="modal" id="groupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Grupo de Pesquisa</h2>
                <button class="close-btn" id="closeGroupModal">&times;</button>
            </div>
            <form id="groupForm">
                <div class="form-group">
                    <label class="form-label" for="groupName">Nome do Grupo</label>
                    <input type="text" id="groupName" class="form-input" placeholder="Ex: 'Grupo de Transfunctora√ß√£o'" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="groupDescription">Descri√ß√£o</label>
                    <textarea id="groupDescription" class="form-textarea" placeholder="Descreva o foco do grupo..." required rows="4"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="groupTags">Tags (separadas por v√≠rgula)</label>
                    <input type="text" id="groupTags" class="form-input" placeholder="Ex: √°lgebra, topologia, categorias">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="groupPrivacy">Privacidade</label>
                    <select id="groupPrivacy" class="form-select">
                        <option value="public">P√∫blico (qualquer um pode entrar)</option>
                        <option value="private">Privado (apenas por convite)</option>
                        <option value="restricted">Restrito (apenas Iniciados+)</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelGroupBtn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Criar Grupo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Novo Desafio -->
    <div class="modal" id="challengeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Desafio Matem√°tico</h2>
                <button class="close-btn" id="closeChallengeModal">&times;</button>
            </div>
            <form id="challengeForm">
                <div class="form-group">
                    <label class="form-label" for="challengeTitle">T√≠tulo do Desafio</label>
                    <input type="text" id="challengeTitle" class="form-input" placeholder="Ex: 'Prove que todo functor admite...'" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="challengeDescription">Descri√ß√£o do Problema</label>
                    <textarea id="challengeDescription" class="form-textarea" placeholder="Descreva o problema em detalhes..." required rows="6"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="challengeDifficulty">Dificuldade</label>
                    <select id="challengeDifficulty" class="form-select">
                        <option value="easy">F√°cil</option>
                        <option value="medium">M√©dio</option>
                        <option value="hard">Dif√≠cil</option>
                        <option value="extreme">Extremo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="challengeDeadline">Prazo (dias)</label>
                    <input type="number" id="challengeDeadline" class="form-input" value="7" min="1" max="30">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelChallengeBtn">Cancelar</button>
                    <button type="submit" class="btn btn-warning">Criar Desafio</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Coment√°rio -->
    <div class="modal" id="commentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Responder √† Teoria</h2>
                <button class="close-btn" id="closeCommentModal">&times;</button>
            </div>
            <form id="commentForm">
                <input type="hidden" id="commentTheoryId">
                
                <div class="form-group">
                    <label class="form-label" for="commentContent">Sua Resposta (LaTeX suportado)</label>
                    <textarea id="commentContent" class="form-textarea" placeholder="Escreva sua resposta aqui... Use $$...$$ para f√≥rmulas LaTeX" required rows="8"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelCommentBtn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Publicar Resposta</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Resolver Desafio -->
    <div class="modal" id="solutionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Enviar Solu√ß√£o</h2>
                <button class="close-btn" id="closeSolutionModal">&times;</button>
            </div>
            <form id="solutionForm">
                <input type="hidden" id="solutionChallengeId">
                
                <div class="form-group">
                    <label class="form-label" for="solutionContent">Sua Solu√ß√£o (LaTeX suportado)</label>
                    <textarea id="solutionContent" class="form-textarea" placeholder="Descreva sua solu√ß√£o em detalhes..." required rows="10"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelSolutionBtn">Cancelar</button>
                    <button type="submit" class="btn btn-success">Enviar Solu√ß√£o</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Chat do Grupo -->
    <div class="modal" id="groupChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="groupChatTitle">Chat do Grupo</h2>
                <button class="close-btn" id="closeGroupChatModal">&times;</button>
            </div>
            <div class="group-chat-container">
                <div class="group-chat-header">
                    <button class="group-chat-back-btn" id="groupChatBackBtn">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="group-chat-info">
                        <h4 id="groupChatName">Carregando...</h4>
                        <p id="groupChatInfo">0 membros</p>
                    </div>
                </div>
                <div class="group-chat-messages" id="groupChatMessages">
                    <!-- Mensagens do grupo ser√£o carregadas aqui -->
                </div>
                <div class="group-chat-input-area">
                    <input type="text" class="group-chat-input" id="groupChatInput" placeholder="Digite sua mensagem para o grupo...">
                    <button class="btn btn-primary" id="sendGroupMessageBtn">
                        <i class="fas fa-paper-plane"></i> Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Enviar Solicita√ß√£o de Amizade -->
    <div class="modal" id="friendRequestModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Enviar Solicita√ß√£o de Amizade</h2>
                <button class="close-btn" id="closeFriendRequestModal">&times;</button>
            </div>
            <form id="friendRequestForm">
                <input type="hidden" id="requestMemberId">
                
                <div class="form-group">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div class="avatar" id="requestMemberAvatar" style="width: 80px; height: 80px; margin: 0 auto 15px;"></div>
                        <h3 id="requestMemberName">Carregando...</h3>
                        <p id="requestMemberSpecialty" style="color: var(--text-secondary);"></p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="requestMessage">Mensagem (opcional)</label>
                    <textarea id="requestMessage" class="form-textarea" placeholder="Escreva uma mensagem para acompanhar sua solicita√ß√£o..." rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelFriendRequestBtn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Enviar Solicita√ß√£o</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ============================================
        // ESTADO GLOBAL DA APLICA√á√ÉO
        // ============================================
        const AppState = {
            currentUser: null,
            allMembers: [],
            theories: [],
            groups: [],
            challenges: [],
            privateMessages: {},
            groupMessages: {},
            comments: {},
            solutions: {},
            friendRequests: {},
            notifications: {},
            
            // Inicializar estado
            init() {
                this.loadState();
                
                // Se n√£o houver usu√°rios, criar alguns de exemplo (BOTS)
                if (this.allMembers.length === 0) {
                    this.createSampleBots();
                }
                
                // Se n√£o houver teorias, criar algumas de exemplo
                if (this.theories.length === 0) {
                    this.createSampleTheories();
                }
                
                // Se n√£o houver grupos, criar alguns de exemplo
                if (this.groups.length === 0) {
                    this.createSampleGroups();
                }
                
                // Se n√£o houver desafios, criar alguns de exemplo
                if (this.challenges.length === 0) {
                    this.createSampleChallenges();
                }
                
                // Verificar se h√° usu√°rio logado
                const savedUser = localStorage.getItem('algebraRenovaCurrentUser');
                if (savedUser) {
                    const userId = JSON.parse(savedUser);
                    this.currentUser = this.allMembers.find(m => m.id === userId);
                    if (this.currentUser) {
                        this.currentUser.online = true;
                        this.showMainApp();
                        this.updateUI();
                    }
                }
                
                // Atualizar data atual
                this.updateCurrentDate();
                
                // Configurar upload de avatar
                this.setupAvatarUpload();
            },
            
            // Carregar estado do localStorage
            loadState() {
                try {
                    const savedState = localStorage.getItem('algebraRenovaState');
                    if (savedState) {
                        const parsed = JSON.parse(savedState);
                        this.allMembers = parsed.allMembers || [];
                        this.theories = parsed.theories || [];
                        this.groups = parsed.groups || [];
                        this.challenges = parsed.challenges || [];
                        this.privateMessages = parsed.privateMessages || {};
                        this.groupMessages = parsed.groupMessages || {};
                        this.comments = parsed.comments || {};
                        this.solutions = parsed.solutions || {};
                        this.friendRequests = parsed.friendRequests || {};
                        this.notifications = parsed.notifications || {};
                    }
                } catch (e) {
                    console.error('Erro ao carregar estado:', e);
                }
            },
            
            // Salvar estado no localStorage
            saveState() {
                try {
                    const state = {
                        allMembers: this.allMembers,
                        theories: this.theories,
                        groups: this.groups,
                        challenges: this.challenges,
                        privateMessages: this.privateMessages,
                        groupMessages: this.groupMessages,
                        comments: this.comments,
                        solutions: this.solutions,
                        friendRequests: this.friendRequests,
                        notifications: this.notifications
                    };
                    localStorage.setItem('algebraRenovaState', JSON.stringify(state));
                    
                    // Salvar usu√°rio atual separadamente
                    if (this.currentUser) {
                        localStorage.setItem('algebraRenovaCurrentUser', JSON.stringify(this.currentUser.id));
                    } else {
                        localStorage.removeItem('algebraRenovaCurrentUser');
                    }
                } catch (e) {
                    console.error('Erro ao salvar estado:', e);
                }
            },
            
            // Criar BOTS de exemplo
            createSampleBots() {
                const bots = [
                    {
                        id: 'bot001',
                        username: 'Transfunctor',
                        email: 'transfunctor@algebrarenova.com',
                        codename: 'Transfunctor',
                        specialty: 'Teoria das Categorias',
                        level: 'core',
                        avatar: 'https://api.dicebear.com/7.x/identicon/svg?seed=Transfunctor',
                        bio: 'BOT 001: Especialista em transfunctora√ß√£o e estruturas n√£o-convencionais.',
                        friends: ['bot002', 'bot003'],
                        points: 15200,
                        theories: 8,
                        solutions: 12,
                        online: true,
                        joinDate: '2023-01-15',
                        isBot: true
                    },
                    {
                        id: 'bot002',
                        username: 'AntiIdentidade',
                        email: 'anti@algebrarenova.com',
                        codename: 'Anti-Identidade',
                        specialty: '√Ålgebra N√£o-Associativa',
                        level: 'renovated',
                        avatar: 'https://api.dicebear.com/7.x/identicon/svg?seed=AntiIdentidade',
                        bio: 'BOT 002: Pesquisador em estruturas alg√©bricas sem elemento identidade.',
                        friends: ['bot001', 'bot004'],
                        points: 1680,
                        theories: 5,
                        solutions: 8,
                        online: true,
                        joinDate: '2023-03-10',
                        isBot: true
                    },
                    {
                        id: 'bot003',
                        username: 'Borboleta',
                        email: 'borboleta@algebrarenova.com',
                        codename: 'Borboleta Metam√≥rfica',
                        specialty: 'Topologia Alg√©brica',
                        level: 'initiate',
                        avatar: 'https://api.dicebear.com/7.x/identicon/svg?seed=Borboleta',
                        bio: 'BOT 003: Interessada em transforma√ß√µes radicais de estruturas matem√°ticas.',
                        friends: ['bot001'],
                        points: 650,
                        theories: 2,
                        solutions: 3,
                        online: true,
                        joinDate: '2023-05-22',
                        isBot: true
                    },
                    {
                        id: 'bot004',
                        username: 'EspadaOlho',
                        email: 'espada@algebrarenova.com',
                        codename: 'Espada do Olho Chor√£o',
                        specialty: 'L√≥gica N√£o-Cl√°ssica',
                        level: 'initiate',
                        avatar: 'https://api.dicebear.com/7.x/identicon/svg?seed=EspadaOlho',
                        bio: 'BOT 004: Estudante de l√≥gicas alternativas e fundamentos da matem√°tica.',
                        friends: ['bot002'],
                        points: 520,
                        theories: 1,
                        solutions: 2,
                        online: true,
                        joinDate: '2023-06-18',
                        isBot: true
                    },
                    {
                        id: 'bot005',
                        username: 'Observador',
                        email: 'obs@algebrarenova.com',
                        codename: 'Observador Curioso',
                        specialty: 'Matem√°tica Geral',
                        level: 'observer',
                        avatar: 'https://api.dicebear.com/7.x/identicon/svg?seed=Observador',
                        bio: 'BOT 005: Aprendendo sobre as novas fronteiras da matem√°tica.',
                        friends: [],
                        points: 80,
                        theories: 0,
                        solutions: 1,
                        online: true,
                        joinDate: '2023-08-01',
                        isBot: true
                    }
                ];
                
                this.allMembers = bots;
                this.saveState();
            },
            
            // Criar teorias de exemplo
            createSampleTheories() {
                const sampleTheories = [
                    {
                        id: 'theory001',
                        title: 'Teoria da Transfunctora√ß√£o',
                        content: `A transfunctora√ß√£o √© o processo pelo qual uma estrutura alg√©brica emerge em outro dom√≠nio com regras totalmente novas. 

Seja $\\mathcal{C}$ uma categoria. Um transfunctor $\\mathcal{T}: \\mathcal{C} \\rightarrow \\mathcal{D}$ n√£o √© simplesmente um functor, mas uma transforma√ß√£o radical que obedece a:

$$
\\mathcal{T}(f \\circ g) = \\mathcal{T}(f) \\star \\mathcal{T}(g)
$$

onde $\\star$ √© uma opera√ß√£o n√£o convencional definida no contexto de $\\mathcal{D}$.

Esta teoria permite a constru√ß√£o de espa√ßos onde identidades tradicionais como $a \\cdot a^{-1} = 1$ s√£o substitu√≠das por anti-identidades do tipo:

$$
a \\dagger a^{\\sharp} = \\varepsilon(a)
$$

onde $\\varepsilon$ √© um operador de deforma√ß√£o categ√≥rica.`,
                        authorId: 'bot001',
                        category: 'category',
                        status: 'approved',
                        approvedBy: 'bot001',
                        date: '2023-10-15',
                        likes: 5,
                        comments: 3
                    },
                    {
                        id: 'theory002',
                        title: '√Ålgebra dos Espa√ßos Anti-Identit√°rios',
                        content: `Exploramos estruturas onde o elemento identidade n√£o existe, mas √© substitu√≠do por uma fam√≠lia de pseudo-identidades que dependem do contexto operacional.

Defini√ß√£o: Um espa√ßo anti-identit√°rio √© uma tripla $(A, \\bullet, \\Phi)$ onde:
- $A$ √© um conjunto
- $\\bullet: A \\times A \\rightarrow A$ √© uma opera√ß√£o bin√°ria
- $\\Phi: A \\rightarrow \\mathcal{P}(A)$ associa a cada elemento um conjunto de pseudo-identidades

A condi√ß√£o fundamental √©:
$$
\\forall a \\in A, \\exists \\phi \\in \\Phi(a) : a \\bullet \\phi = \\phi \\bullet a = a
$$

Por√©m, $\\phi$ n√£o √© √∫nico e pode n√£o pertencer a $\\Phi(b)$ para $b \\neq a$.

Esta estrutura desafia o Teorema de Cayley e exige uma reformula√ß√£o completa da teoria de grupos.`,
                        authorId: 'bot002',
                        category: 'algebra',
                        status: 'pending',
                        date: '2023-10-10',
                        likes: 3,
                        comments: 1
                    }
                ];
                
                this.theories = sampleTheories;
                
                // Coment√°rios de exemplo
                this.comments = {
                    'theory001': [
                        {
                            id: 'c001',
                            theoryId: 'theory001',
                            authorId: 'bot002',
                            content: 'Excelente trabalho! Voc√™ poderia elaborar sobre como o operador $\\varepsilon$ se comporta em rela√ß√£o √† composi√ß√£o de transfunctors?',
                            date: '2023-10-16'
                        },
                        {
                            id: 'c002',
                            theoryId: 'theory001',
                            authorId: 'bot003',
                            content: 'Achei fascinante a conex√£o com anti-identidades. Isso me lembra algumas constru√ß√µes em $\\infty$-categories. Poderia explorar essa rela√ß√£o?',
                            date: '2023-10-17'
                        }
                    ],
                    'theory002': [
                        {
                            id: 'c003',
                            theoryId: 'theory002',
                            authorId: 'bot001',
                            content: 'Interessante abordagem. Como voc√™ definiria morfismos entre espa√ßos anti-identit√°rios?',
                            date: '2023-10-12'
                        }
                    ]
                };
                
                this.saveState();
            },
            
            // Criar grupos de exemplo
            createSampleGroups() {
                const sampleGroups = [
                    {
                        id: 'group001',
                        name: 'Grupo de Transfunctora√ß√£o',
                        description: 'Estudo de transfunctors e transforma√ß√µes radicais entre categorias matem√°ticas.',
                        tags: ['transfunctora√ß√£o', 'categorias', '√°lgebra'],
                        privacy: 'restricted',
                        creatorId: 'bot001',
                        members: ['bot001', 'bot002', 'bot003'],
                        createdDate: '2023-09-01'
                    },
                    {
                        id: 'group002',
                        name: '√Ålgebra N√£o-Convencional',
                        description: 'Pesquisa em estruturas alg√©bricas que violam axiomas tradicionais.',
                        tags: ['√°lgebra', 'n√£o-associativa', 'anti-identidades'],
                        privacy: 'public',
                        creatorId: 'bot002',
                        members: ['bot002', 'bot004'],
                        createdDate: '2023-09-15'
                    }
                ];
                
                this.groups = sampleGroups;
                
                // Mensagens de grupo de exemplo
                this.groupMessages = {
                    'group001': [
                        {
                            id: 'gm001',
                            groupId: 'group001',
                            authorId: 'bot001',
                            content: 'Bem-vindos ao grupo de Transfunctora√ß√£o! Vamos discutir as implica√ß√µes radicais dessa nova estrutura.',
                            timestamp: '2023-10-01T10:00:00'
                        },
                        {
                            id: 'gm002',
                            groupId: 'group001',
                            authorId: 'bot002',
                            content: 'Tenho uma pergunta: como a transfunctora√ß√£o se relaciona com as anti-identidades que estudo?',
                            timestamp: '2023-10-01T10:05:00'
                        }
                    ]
                };
                
                this.saveState();
            },
            
            // Criar desafios de exemplo
            createSampleChallenges() {
                const sampleChallenges = [
                    {
                        id: 'challenge001',
                        title: 'Prove que todo functor admite uma extens√£o transfunctorial',
                        description: `Dado um functor $F: \\mathcal{C} \\rightarrow \\mathcal{D}$ entre categorias, prove que existe pelo menos uma extens√£o transfunctorial $\\tilde{F}: \\mathcal{C} \\rightarrow \\mathcal{E}$ onde $\\mathcal{E}$ √© uma categoria com opera√ß√£o n√£o-convencional $\\star$.

Dica: Considere a constru√ß√£o do completamento livre.`,
                        difficulty: 'hard',
                        creatorId: 'bot001',
                        points: 50,
                        deadline: '2023-11-15',
                        createdDate: '2023-10-01',
                        solutions: 2
                    }
                ];
                
                this.challenges = sampleChallenges;
                
                this.saveState();
            },
            
            // Configurar upload de avatar
            setupAvatarUpload() {
                // Avatar no login
                const avatarPreviewLogin = document.getElementById('avatarPreviewLogin');
                const avatarUploadLogin = document.getElementById('avatarUploadLogin');
                
                if (avatarUploadLogin && avatarPreviewLogin) {
                    avatarUploadLogin.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                avatarPreviewLogin.style.backgroundImage = `url(${e.target.result})`;
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                    
                    avatarPreviewLogin.addEventListener('click', function() {
                        avatarUploadLogin.click();
                    });
                }
                
                // Avatar no perfil
                const avatarPreview = document.getElementById('avatarPreview');
                const avatarUpload = document.getElementById('avatarUpload');
                
                if (avatarUpload && avatarPreview) {
                    avatarUpload.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                avatarPreview.style.backgroundImage = `url(${e.target.result})`;
                                // Salvar no usu√°rio atual
                                if (AppState.currentUser) {
                                    AppState.currentUser.avatar = e.target.result;
                                    AppState.updateUserProfile();
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                    
                    avatarPreview.addEventListener('click', function() {
                        avatarUpload.click();
                    });
                }
            },
            
            // Atualizar data atual
            updateCurrentDate() {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const dateElement = document.getElementById('currentDate');
                if (dateElement) {
                    dateElement.textContent = now.toLocaleDateString('pt-BR', options);
                }
            },
            
            // Mostrar aplica√ß√£o principal
            showMainApp() {
                document.getElementById('mainApp').style.display = 'flex';
                document.getElementById('loginModal').classList.remove('active');
            },
            
            // Atualizar a interface com base no estado
            updateUI() {
                this.updateUserProfile();
                this.updateFriendsList();
                this.updateMembersList();
                this.updateTheoriesList();
                this.updateGroupsList();
                this.updateChallengesList();
                this.updateHierarchyInfo();
                this.updateHomeStats();
                this.updateNotifications();
            },
            
            // Atualizar perfil do usu√°rio
            updateUserProfile() {
                if (!this.currentUser) return;
                
                const userAvatar = document.getElementById('userAvatar');
                const userInfo = document.getElementById('userInfo');
                const userName = document.getElementById('userName');
                const userSpecialty = document.getElementById('userSpecialty');
                const contributionPoints = document.getElementById('contributionPoints');
                const theoriesCount = document.getElementById('theoriesCount');
                const userBotBadge = document.getElementById('userBotBadge');
                
                // Atualizar avatar
                if (this.currentUser.avatar) {
                    userAvatar.style.backgroundImage = `url(${this.currentUser.avatar})`;
                }
                userAvatar.className = `avatar ${this.currentUser.level} ${this.currentUser.isBot ? 'bot' : ''}`;
                
                // Atualizar informa√ß√µes do usu√°rio
                userName.textContent = this.currentUser.codename || this.currentUser.username;
                userSpecialty.textContent = this.currentUser.specialty || 'Matem√°tica Geral';
                contributionPoints.textContent = `${this.currentUser.points || 0} pontos`;
                theoriesCount.textContent = `${this.currentUser.theories || 0} teorias`;
                
                // Mostrar badge de BOT se for bot
                if (userBotBadge) {
                    userBotBadge.style.display = this.currentUser.isBot ? 'inline-block' : 'none';
                }
                
                // Aplicar classe de n√≠vel ao cont√™iner de informa√ß√µes
                userInfo.className = `user-info ${this.currentUser.level}`;
                
                // Se for n√≠vel N√∫cleo, adicionar efeito de pulso
                if (this.currentUser.level === 'core') {
                    userAvatar.classList.add('pulse-gold');
                } else {
                    userAvatar.classList.remove('pulse-gold');
                }
            },
            
            // Atualizar lista de amigos
            updateFriendsList() {
                if (!this.currentUser) return;
                
                const friendsList = document.getElementById('friendsList');
                const friendsCount = document.getElementById('friendsCount');
                
                if (!friendsList) return;
                
                friendsList.innerHTML = '';
                
                if (this.currentUser.friends && this.currentUser.friends.length > 0) {
                    friendsCount.textContent = this.currentUser.friends.length;
                    
                    this.currentUser.friends.forEach(friendId => {
                        const friend = this.allMembers.find(m => m.id === friendId);
                        if (friend) {
                            const friendItem = document.createElement('div');
                            friendItem.className = 'friend-item';
                            friendItem.dataset.friendId = friend.id;
                            
                            let avatarStyle = '';
                            if (friend.avatar && friend.avatar.startsWith('http')) {
                                avatarStyle = `background-image: url('${friend.avatar}')`;
                            }
                            
                            friendItem.innerHTML = `
                                <div class="friend-avatar ${friend.level} ${friend.isBot ? 'bot' : ''}" style="${avatarStyle}">
                                    ${friend.avatar && friend.avatar.startsWith('http') ? '' : friend.avatar || 'AR'}
                                </div>
                                <div class="friend-name">${friend.codename || friend.username}</div>
                                <div class="friend-level ${friend.level}-badge">${this.getLevelName(friend.level)}</div>
                            `;
                            
                            friendItem.addEventListener('click', () => this.openChat(friend));
                            friendsList.appendChild(friendItem);
                        }
                    });
                } else {
                    friendsCount.textContent = '0';
                    friendsList.innerHTML = `
                        <div class="friend-item" style="justify-content: center; color: var(--text-secondary);">
                            Nenhum contacto ainda
                        </div>
                    `;
                }
            },
            
            // Atualizar lista de membros
            updateMembersList() {
                const membersGrid = document.getElementById('membersGrid');
                const friendRequestsSection = document.getElementById('friendRequestsSection');
                const manageRequestsBtn = document.getElementById('manageRequestsBtn');
                
                if (!membersGrid) return;
                
                // Mostrar/ocultar se√ß√£o de solicita√ß√µes (apenas para usu√°rios reais)
                if (friendRequestsSection && manageRequestsBtn && this.currentUser && !this.currentUser.isBot) {
                    const pendingRequests = this.getPendingFriendRequests();
                    if (pendingRequests.length > 0) {
                        friendRequestsSection.style.display = 'block';
                        manageRequestsBtn.style.display = 'inline-flex';
                        this.updateFriendRequestsList();
                    } else {
                        friendRequestsSection.style.display = 'none';
                        manageRequestsBtn.style.display = 'none';
                    }
                }
                
                membersGrid.innerHTML = '';
                
                // Ordenar por n√≠vel e pontos
                const sortedMembers = [...this.allMembers].sort((a, b) => {
                    const levelOrder = { 'core': 3, 'renovated': 2, 'initiate': 1, 'observer': 0 };
                    if (levelOrder[b.level] !== levelOrder[a.level]) {
                        return levelOrder[b.level] - levelOrder[a.level];
                    }
                    return (b.points || 0) - (a.points || 0);
                });
                
                sortedMembers.forEach(member => {
                    // N√£o mostrar o usu√°rio atual na lista
                    if (this.currentUser && member.id === this.currentUser.id) return;
                    
                    const isFriend = this.currentUser && 
                                    this.currentUser.friends && 
                                    this.currentUser.friends.includes(member.id);
                    
                    const hasSentRequest = this.currentUser && 
                                         this.friendRequests[member.id] && 
                                         this.friendRequests[member.id].some(r => 
                                             r.from === this.currentUser.id && r.status === 'pending'
                                         );
                    
                    const hasReceivedRequest = this.currentUser && 
                                             this.friendRequests[this.currentUser.id] && 
                                             this.friendRequests[this.currentUser.id].some(r => 
                                                 r.from === member.id && r.status === 'pending'
                                             );
                    
                    let avatarStyle = '';
                    if (member.avatar && member.avatar.startsWith('http')) {
                        avatarStyle = `background-image: url('${member.avatar}')`;
                    }
                    
                    const memberCard = document.createElement('div');
                    memberCard.className = 'member-card';
                    memberCard.innerHTML = `
                        <div class="member-header">
                            <div class="member-avatar ${member.level} ${member.isBot ? 'bot' : ''}" style="${avatarStyle}">
                                ${member.avatar && member.avatar.startsWith('http') ? '' : member.avatar || 'AR'}
                            </div>
                            <div class="member-info">
                                <h4>${member.codename || member.username} 
                                    ${member.isBot ? '<span class="bot-badge">BOT ' + member.id.substring(3) + '</span>' : ''}
                                </h4>
                                <p>${member.specialty || 'Matem√°tica Geral'}</p>
                                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                    <span class="level-badge badge-${member.level}">${this.getLevelName(member.level)}</span>
                                    <span style="font-size: 12px; color: var(--text-secondary);">${member.points || 0} pontos</span>
                                </div>
                            </div>
                        </div>
                        <div class="member-actions">
                            ${isFriend ? `
                            <button class="btn btn-small btn-secondary" disabled style="width: 100%;">
                                <i class="fas fa-check"></i> J√° √© contacto
                            </button>
                            ` : hasSentRequest ? `
                            <button class="btn btn-small btn-secondary" disabled style="width: 100%;">
                                <i class="fas fa-clock"></i> Solicita√ß√£o Enviada
                            </button>
                            ` : hasReceivedRequest ? `
                            <div style="display: flex; gap: 5px; width: 100%;">
                                <button class="btn btn-small btn-success accept-request-btn" data-member-id="${member.id}" style="flex: 1;">
                                    <i class="fas fa-check"></i> Aceitar
                                </button>
                                <button class="btn btn-small btn-danger reject-request-btn" data-member-id="${member.id}" style="flex: 1;">
                                    <i class="fas fa-times"></i> Recusar
                                </button>
                            </div>
                            ` : !member.isBot ? `
                            <button class="btn btn-small btn-primary send-request-btn" data-member-id="${member.id}" style="width: 100%;">
                                <i class="fas fa-user-plus"></i> Enviar Solicita√ß√£o
                            </button>
                            ` : `
                            <button class="btn btn-small btn-secondary add-friend-btn" data-member-id="${member.id}" style="width: 100%;">
                                <i class="fas fa-user-plus"></i> Adicionar BOT
                            </button>
                            `}
                        </div>
                    `;
                    
                    membersGrid.appendChild(memberCard);
                });
                
                // Adicionar event listeners
                setTimeout(() => {
                    // Bot√µes de enviar solicita√ß√£o
                    document.querySelectorAll('.send-request-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const memberId = e.currentTarget.dataset.memberId;
                            this.openFriendRequestModal(memberId);
                        });
                    });
                    
                    // Bot√µes de adicionar BOT
                    document.querySelectorAll('.add-friend-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const memberId = e.currentTarget.dataset.memberId;
                            this.addFriend(memberId);
                        });
                    });
                    
                    // Bot√µes de aceitar solicita√ß√£o
                    document.querySelectorAll('.accept-request-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const memberId = e.currentTarget.dataset.memberId;
                            this.acceptFriendRequest(memberId);
                        });
                    });
                    
                    // Bot√µes de recusar solicita√ß√£o
                    document.querySelectorAll('.reject-request-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const memberId = e.currentTarget.dataset.memberId;
                            this.rejectFriendRequest(memberId);
                        });
                    });
                }, 100);
            },
            
            // Atualizar lista de solicita√ß√µes de amizade
            updateFriendRequestsList() {
                const friendRequestsGrid = document.getElementById('friendRequestsGrid');
                if (!friendRequestsGrid || !this.currentUser) return;
                
                const pendingRequests = this.getPendingFriendRequests();
                
                if (pendingRequests.length === 0) {
                    friendRequestsGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--text-secondary);">
                            Nenhuma solicita√ß√£o pendente
                        </div>
                    `;
                    return;
                }
                
                friendRequestsGrid.innerHTML = '';
                
                pendingRequests.forEach(request => {
                    const member = this.allMembers.find(m => m.id === request.from);
                    if (!member) return;
                    
                    let avatarStyle = '';
                    if (member.avatar && member.avatar.startsWith('http')) {
                        avatarStyle = `background-image: url('${member.avatar}')`;
                    }
                    
                    const requestCard = document.createElement('div');
                    requestCard.className = 'request-card';
                    requestCard.innerHTML = `
                        <div class="request-header">
                            <div class="request-avatar ${member.level}" style="${avatarStyle}">
                                ${member.avatar && member.avatar.startsWith('http') ? '' : member.avatar || 'AR'}
                            </div>
                            <div class="request-info">
                                <h4>${member.codename || member.username}</h4>
                                <p>${member.specialty || 'Matem√°tica Geral'}</p>
                                <p style="font-size: 11px; color: var(--text-secondary); margin-top: 3px;">
                                    ${request.message || 'Sem mensagem'}
                                </p>
                            </div>
                        </div>
                        <div class="request-actions">
                            <button class="btn btn-small btn-success accept-request-btn" data-request-id="${request.id}" style="flex: 1;">
                                <i class="fas fa-check"></i> Aceitar
                            </button>
                            <button class="btn btn-small btn-danger reject-request-btn" data-request-id="${request.id}" style="flex: 1;">
                                <i class="fas fa-times"></i> Recusar
                            </button>
                        </div>
                    `;
                    
                    friendRequestsGrid.appendChild(requestCard);
                });
                
                // Adicionar event listeners
                setTimeout(() => {
                    document.querySelectorAll('.accept-request-btn[data-request-id]').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const requestId = e.currentTarget.dataset.requestId;
                            this.acceptFriendRequestById(requestId);
                        });
                    });
                    
                    document.querySelectorAll('.reject-request-btn[data-request-id]').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const requestId = e.currentTarget.dataset.requestId;
                            this.rejectFriendRequestById(requestId);
                        });
                    });
                }, 100);
            },
            
            // Obter solicita√ß√µes pendentes
            getPendingFriendRequests() {
                if (!this.currentUser || !this.friendRequests[this.currentUser.id]) return [];
                return this.friendRequests[this.currentUser.id].filter(r => r.status === 'pending');
            },
            
            // Atualizar lista de teorias
            updateTheoriesList() {
                const theoriesList = document.getElementById('theoriesList');
                const recentTheories = document.getElementById('recentTheories');
                const pendingTheoriesBadge = document.getElementById('pendingTheoriesBadge');
                
                // Atualizar badge de teorias pendentes (apenas para N√∫cleo)
                if (pendingTheoriesBadge && this.currentUser && this.currentUser.level === 'core') {
                    const pendingCount = this.theories.filter(t => t.status === 'pending').length;
                    if (pendingCount > 0) {
                        pendingTheoriesBadge.textContent = pendingCount;
                        pendingTheoriesBadge.style.display = 'inline-block';
                    } else {
                        pendingTheoriesBadge.style.display = 'none';
                    }
                }
                
                if (theoriesList) {
                    theoriesList.innerHTML = '';
                    
                    if (this.theories.length === 0) {
                        theoriesList.innerHTML = `
                            <div class="content-card">
                                <h3 class="card-title">Nenhuma teoria publicada ainda</h3>
                                <p style="color: var(--text-secondary);">Seja o primeiro a publicar uma teoria revolucion√°ria!</p>
                            </div>
                        `;
                    } else {
                        // Ordenar por data (mais recentes primeiro)
                        const sortedTheories = [...this.theories].sort((a, b) => new Date(b.date) - new Date(a.date));
                        
                        sortedTheories.forEach(theory => {
                            const author = this.allMembers.find(m => m.id === theory.authorId);
                            const theoryComments = this.comments[theory.id] || [];
                            const canComment = this.currentUser && 
                                             (this.currentUser.level === 'initiate' || 
                                              this.currentUser.level === 'renovated' || 
                                              this.currentUser.level === 'core');
                            
                            const isAuthor = this.currentUser && this.currentUser.id === theory.authorId;
                            const canApprove = this.currentUser && this.currentUser.level === 'core' && theory.status === 'pending';
                            
                            let avatarStyle = '';
                            if (author && author.avatar && author.avatar.startsWith('http')) {
                                avatarStyle = `background-image: url('${author.avatar}')`;
                            }
                            
                            const theoryCard = document.createElement('div');
                            theoryCard.className = 'content-card theory-card';
                            theoryCard.dataset.theoryId = theory.id;
                            theoryCard.innerHTML = `
                                <div class="card-header">
                                    <h3 class="card-title">${theory.title}</h3>
                                    <div class="card-date">${this.formatDate(theory.date)}</div>
                                </div>
                                
                                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                    <span class="theory-status status-${theory.status}">
                                        ${theory.status === 'pending' ? '‚è≥ Aguardando Aprova√ß√£o' : 
                                          theory.status === 'approved' ? '‚úÖ Aprovada pelo N√∫cleo' : 
                                          '‚ùå Rejeitada'}
                                    </span>
                                    ${theory.approvedBy ? `
                                    <span style="margin-left: 10px; font-size: 12px; color: var(--text-secondary);">
                                        Aprovada por: ${this.allMembers.find(m => m.id === theory.approvedBy)?.codename || 'N√∫cleo'}
                                    </span>
                                    ` : ''}
                                </div>
                                
                                <div class="card-author">
                                    <div class="author-avatar ${author ? author.level : ''} ${author?.isBot ? 'bot' : ''}" style="${avatarStyle}">
                                        ${avatarStyle ? '' : (author ? author.avatar : 'AR')}
                                    </div>
                                    <div class="author-info">
                                        <h4>${author ? author.codename || author.username : 'Autor Desconhecido'}
                                            ${author?.isBot ? '<span class="bot-badge">BOT ' + author.id.substring(3) + '</span>' : ''}
                                        </h4>
                                        <p>${this.getCategoryName(theory.category)} ‚Ä¢ ${this.getLevelName(author ? author.level : 'observer')}</p>
                                    </div>
                                </div>
                                <div class="theory-content">
                                    ${this.formatTheoryContent(theory.content)}
                                </div>
                                
                                ${canApprove ? `
                                <div class="nucleus-actions">
                                    <h4><i class="fas fa-crown"></i> A√ß√µes do N√∫cleo</h4>
                                    <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 14px;">
                                        Como membro do N√∫cleo, voc√™ pode aprovar ou rejeitar esta teoria.
                                    </p>
                                    <div class="action-buttons">
                                        <button class="btn btn-small btn-success approve-theory-btn" data-theory-id="${theory.id}">
                                            <i class="fas fa-check"></i> Aprovar Teoria
                                        </button>
                                        <button class="btn btn-small btn-danger reject-theory-btn" data-theory-id="${theory.id}">
                                            <i class="fas fa-times"></i> Rejeitar Teoria
                                        </button>
                                        <button class="btn btn-small btn-primary request-changes-btn" data-theory-id="${theory.id}">
                                            <i class="fas fa-edit"></i> Solicitar Altera√ß√µes
                                        </button>
                                    </div>
                                </div>
                                ` : ''}
                                
                                <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <span style="color: var(--text-secondary); margin-right: 15px;">
                                            <i class="fas fa-heart"></i> ${theory.likes || 0}
                                        </span>
                                        <span style="color: var(--text-secondary);">
                                            <i class="fas fa-comment"></i> ${theoryComments.length} respostas
                                        </span>
                                    </div>
                                    ${canComment && theory.status === 'approved' ? `
                                    <button class="btn btn-small btn-primary reply-theory-btn" data-theory-id="${theory.id}">
                                        <i class="fas fa-reply"></i> Responder
                                    </button>
                                    ` : ''}
                                </div>
                                
                                ${theoryComments.length > 0 && theory.status === 'approved' ? `
                                <div class="comments-section">
                                    <h4 style="margin-bottom: 15px; color: var(--accent-neon);">Respostas (${theoryComments.length})</h4>
                                    <div class="comments-list">
                                        ${theoryComments.slice(0, 2).map(comment => {
                                            const commentAuthor = this.allMembers.find(m => m.id === comment.authorId);
                                            let commentAvatarStyle = '';
                                            if (commentAuthor && commentAuthor.avatar && commentAuthor.avatar.startsWith('http')) {
                                                commentAvatarStyle = `background-image: url('${commentAuthor.avatar}')`;
                                            }
                                            
                                            return `
                                                <div class="comment">
                                                    <div class="comment-header">
                                                        <div class="comment-author">
                                                            <div class="comment-author-avatar ${commentAuthor ? commentAuthor.level : ''} ${commentAuthor?.isBot ? 'bot' : ''}" style="${commentAvatarStyle}">
                                                                ${commentAvatarStyle ? '' : (commentAuthor ? commentAuthor.avatar : 'AR')}
                                                            </div>
                                                            <div>
                                                                <strong>${commentAuthor ? commentAuthor.codename || commentAuthor.username : 'An√¥nimo'}</strong>
                                                                <div class="comment-date">${this.formatDate(comment.date)}</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="comment-content">
                                                        ${this.formatTheoryContent(comment.content)}
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                        ${theoryComments.length > 2 ? `
                                        <div style="text-align: center; margin-top: 10px;">
                                            <button class="btn btn-small btn-secondary view-all-comments" data-theory-id="${theory.id}">
                                                Ver todas as ${theoryComments.length} respostas
                                            </button>
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                                ` : ''}
                            `;
                            
                            theoriesList.appendChild(theoryCard);
                        });
                    }
                }
                
                // Atualizar teorias recentes na home
                if (recentTheories) {
                    recentTheories.innerHTML = '';
                    
                    // Pegar as 3 teorias mais recentes APROVADAS
                    const recent = [...this.theories]
                        .filter(t => t.status === 'approved')
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 3);
                    
                    if (recent.length === 0) {
                        recentTheories.innerHTML = `
                            <p style="color: var(--text-secondary); text-align: center; padding: 20px;">
                                Nenhuma teoria publicada ainda
                            </p>
                        `;
                    } else {
                        recent.forEach(theory => {
                            const author = this.allMembers.find(m => m.id === theory.authorId);
                            let avatarStyle = '';
                            if (author && author.avatar && author.avatar.startsWith('http')) {
                                avatarStyle = `background-image: url('${author.avatar}')`;
                            }
                            
                            const theoryItem = document.createElement('div');
                            theoryItem.className = 'content-card';
                            theoryItem.style.padding = '15px';
                            theoryItem.style.marginBottom = '15px';
                            theoryItem.innerHTML = `
                                <h3 style="font-size: 18px; margin-bottom: 10px;">${theory.title}</h3>
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div class="author-avatar ${author ? author.level : ''} ${author?.isBot ? 'bot' : ''}" style="width: 30px; height: 30px; font-size: 12px; ${avatarStyle}">
                                        ${avatarStyle ? '' : (author ? author.avatar : 'AR')}
                                    </div>
                                    <div style="margin-left: 10px;">
                                        <div style="font-size: 14px;">${author ? author.codename || author.username : 'An√¥nimo'}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">${this.formatDate(theory.date)}</div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 14px; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">
                                    ${theory.content.replace(/[#*`$]/g, '').substring(0, 200)}...
                                </p>
                                <div style="margin-top: 10px;">
                                    <a href="#" class="view-theory-btn" data-theory-id="${theory.id}" style="color: var(--accent-neon); font-size: 14px;">Ler teoria completa ‚Üí</a>
                                </div>
                            `;
                            
                            recentTheories.appendChild(theoryItem);
                        });
                    }
                }
                
                // Adicionar event listeners aos bot√µes
                setTimeout(() => {
                    // Bot√µes de responder
                    document.querySelectorAll('.reply-theory-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const theoryId = e.currentTarget.dataset.theoryId;
                            this.openCommentModal(theoryId);
                        });
                    });
                    
                    // Bot√µes de aprovar/rejeitar (N√∫cleo)
                    document.querySelectorAll('.approve-theory-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const theoryId = e.currentTarget.dataset.theoryId;
                            this.approveTheory(theoryId);
                        });
                    });
                    
                    document.querySelectorAll('.reject-theory-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const theoryId = e.currentTarget.dataset.theoryId;
                            this.rejectTheory(theoryId);
                        });
                    });
                    
                    document.querySelectorAll('.request-changes-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const theoryId = e.currentTarget.dataset.theoryId;
                            this.requestTheoryChanges(theoryId);
                        });
                    });
                    
                    // Bot√µes de ver teoria
                    document.querySelectorAll('.view-theory-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            const theoryId = e.currentTarget.dataset.theoryId;
                            this.switchTab('theories');
                            // Scroll para a teoria
                            setTimeout(() => {
                                const theoryCard = document.querySelector(`.theory-card[data-theory-id="${theoryId}"]`);
                                if (theoryCard) {
                                    theoryCard.scrollIntoView({ behavior: 'smooth' });
                                    theoryCard.style.boxShadow = '0 0 0 2px var(--accent-neon)';
                                    setTimeout(() => {
                                        theoryCard.style.boxShadow = '';
                                    }, 2000);
                                }
                            }, 100);
                        });
                    });
                    
                    // Bot√µes de ver todos os coment√°rios
                    document.querySelectorAll('.view-all-comments').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const theoryId = e.currentTarget.dataset.theoryId;
                            this.showAllComments(theoryId);
                        });
                    });
                    
                    // Renderizar LaTeX ap√≥s atualizar as teorias
                    if (window.MathJax) {
                        window.MathJax.typeset();
                    }
                }, 100);
            },
            
            // Atualizar lista de grupos
            updateGroupsList() {
                const groupsList = document.getElementById('groupsList');
                
                if (!groupsList) return;
                
                groupsList.innerHTML = '';
                
                if (this.groups.length === 0) {
                    groupsList.innerHTML = `
                        <div class="content-card">
                            <h3 class="card-title">Nenhum grupo criado ainda</h3>
                            <p style="color: var(--text-secondary);">Crie o primeiro grupo de pesquisa!</p>
                        </div>
                    `;
                } else {
                    groupsList.innerHTML = '<div class="groups-grid" id="groupsGrid"></div>';
                    const groupsGrid = document.getElementById('groupsGrid');
                    
                    this.groups.forEach(group => {
                        const creator = this.allMembers.find(m => m.id === group.creatorId);
                        const isMember = group.members && group.members.includes(this.currentUser.id);
                        const canJoin = this.canUserJoinGroup(group);
                        const groupMessages = this.groupMessages[group.id] || [];
                        
                        let avatarStyle = '';
                        if (creator && creator.avatar && creator.avatar.startsWith('http')) {
                            avatarStyle = `background-image: url('${creator.avatar}')`;
                        }
                        
                        const groupCard = document.createElement('div');
                        groupCard.className = 'group-card';
                        groupCard.innerHTML = `
                            <div class="group-header">
                                <h3 class="group-name">${group.name}</h3>
                                <span class="group-members">
                                    <i class="fas fa-users"></i> ${group.members ? group.members.length : 0} membros
                                </span>
                            </div>
                            <div class="group-description">
                                ${group.description}
                            </div>
                            ${group.tags && group.tags.length > 0 ? `
                            <div class="group-tags">
                                ${group.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                            ` : ''}
                            <div class="group-actions">
                                <div>
                                    <span style="font-size: 12px; color: var(--text-secondary);">
                                        <i class="fas fa-user"></i> ${creator ? creator.codename || creator.username : 'Desconhecido'}
                                    </span>
                                    <br>
                                    <span style="font-size: 12px; color: var(--text-secondary);">
                                        <i class="fas fa-comment"></i> ${groupMessages.length} mensagens
                                    </span>
                                </div>
                                <div style="display: flex; gap: 5px;">
                                    ${isMember ? `
                                    <button class="btn btn-small btn-primary open-group-chat-btn" data-group-id="${group.id}">
                                        <i class="fas fa-comments"></i> Chat
                                    </button>
                                    <button class="btn btn-small btn-secondary" disabled>
                                        <i class="fas fa-check"></i> Membro
                                    </button>
                                    ` : canJoin ? `
                                    <button class="btn btn-small btn-primary join-group-btn" data-group-id="${group.id}">
                                        <i class="fas fa-sign-in-alt"></i> Entrar
                                    </button>
                                    ` : `
                                    <button class="btn btn-small btn-secondary" disabled title="N√≠vel insuficiente ou grupo privado">
                                        <i class="fas fa-lock"></i> Restrito
                                    </button>
                                    `}
                                </div>
                            </div>
                        `;
                        
                        groupsGrid.appendChild(groupCard);
                    });
                    
                    // Adicionar event listeners aos bot√µes
                    setTimeout(() => {
                        document.querySelectorAll('.join-group-btn').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                const groupId = e.currentTarget.dataset.groupId;
                                this.joinGroup(groupId);
                            });
                        });
                        
                        document.querySelectorAll('.open-group-chat-btn').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                const groupId = e.currentTarget.dataset.groupId;
                                this.openGroupChat(groupId);
                            });
                        });
                    }, 100);
                }
            },
            
            // Atualizar lista de desafios
            updateChallengesList() {
                const challengesList = document.getElementById('challengesList');
                const recentChallenges = document.getElementById('recentChallenges');
                
                if (challengesList) {
                    challengesList.innerHTML = '';
                    
                    if (this.challenges.length === 0) {
                        challengesList.innerHTML = `
                            <div class="content-card">
                                <h3 class="card-title">Nenhum desafio criado ainda</h3>
                                <p style="color: var(--text-secondary);">Crie o primeiro desafio matem√°tico!</p>
                            </div>
                        `;
                    } else {
                        challengesList.innerHTML = '<div class="challenges-grid" id="challengesGrid"></div>';
                        const challengesGrid = document.getElementById('challengesGrid');
                        
                        // Ordenar por prazo
                        const sortedChallenges = [...this.challenges].sort((a, b) => {
                            const deadlineA = new Date(a.deadline);
                            const deadlineB = new Date(b.deadline);
                            return deadlineA - deadlineB;
                        });
                        
                        sortedChallenges.forEach(challenge => {
                            const creator = this.allMembers.find(m => m.id === challenge.creatorId);
                            const solutions = this.solutions[challenge.id] || [];
                            const hasSolved = this.currentUser && 
                                            solutions.some(s => s.authorId === this.currentUser.id);
                            const canSolve = this.currentUser && 
                                           (this.currentUser.level === 'initiate' || 
                                            this.currentUser.level === 'renovated' || 
                                            this.currentUser.level === 'core');
                            
                            let avatarStyle = '';
                            if (creator && creator.avatar && creator.avatar.startsWith('http')) {
                                avatarStyle = `background-image: url('${creator.avatar}')`;
                            }
                            
                            const challengeCard = document.createElement('div');
                            challengeCard.className = 'challenge-card';
                            challengeCard.innerHTML = `
                                <div>
                                    <span class="challenge-difficulty difficulty-${challenge.difficulty}">
                                        ${this.getDifficultyName(challenge.difficulty)}
                                    </span>
                                    <h3 style="margin: 10px 0; font-size: 18px;">${challenge.title}</h3>
                                </div>
                                <div style="color: var(--text-secondary); margin-bottom: 15px; font-size: 14px;">
                                    ${challenge.description.substring(0, 150)}...
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <div>
                                        <div style="font-size: 12px; color: var(--text-secondary); display: flex; align-items: center; gap: 5px;">
                                            <div class="author-avatar ${creator ? creator.level : ''}" style="width: 20px; height: 20px; font-size: 10px; ${avatarStyle}">
                                                ${avatarStyle ? '' : (creator ? creator.avatar : 'AR')}
                                            </div>
                                            ${creator ? creator.codename || creator.username : 'Desconhecido'}
                                        </div>
                                        <div style="font-size: 12px; color: var(--accent-neon); margin-top: 3px;">
                                            <i class="fas fa-trophy"></i> ${challenge.points} pontos
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 12px; color: ${this.isDeadlineNear(challenge.deadline) ? 'var(--warning)' : 'var(--text-secondary)'};">
                                            <i class="fas fa-clock"></i> Prazo: ${this.formatDate(challenge.deadline)}
                                        </div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">
                                            <i class="fas fa-solution"></i> ${solutions.length} solu√ß√µes
                                        </div>
                                    </div>
                                </div>
                                <div class="group-actions">
                                    ${hasSolved ? `
                                    <button class="btn btn-small btn-success" disabled>
                                        <i class="fas fa-check"></i> Solu√ß√£o Enviada
                                    </button>
                                    ` : canSolve ? `
                                    <button class="btn btn-small btn-warning solve-challenge-btn" data-challenge-id="${challenge.id}">
                                        <i class="fas fa-paper-plane"></i> Enviar Solu√ß√£o
                                    </button>
                                    ` : `
                                    <button class="btn btn-small btn-secondary" disabled title="N√≠vel insuficiente">
                                        <i class="fas fa-lock"></i> Apenas Iniciados+
                                    </button>
                                    `}
                                    <button class="btn btn-small btn-primary view-challenge-btn" data-challenge-id="${challenge.id}">
                                        <i class="fas fa-eye"></i> Ver Detalhes
                                    </button>
                                </div>
                            `;
                            
                            challengesGrid.appendChild(challengeCard);
                        });
                        
                        // Adicionar event listeners
                        setTimeout(() => {
                            document.querySelectorAll('.solve-challenge-btn').forEach(btn => {
                                btn.addEventListener('click', (e) => {
                                    const challengeId = e.currentTarget.dataset.challengeId;
                                    this.openSolutionModal(challengeId);
                                });
                            });
                            
                            document.querySelectorAll('.view-challenge-btn').forEach(btn => {
                                btn.addEventListener('click', (e) => {
                                    const challengeId = e.currentTarget.dataset.challengeId;
                                    this.showChallengeDetails(challengeId);
                                });
                            });
                        }, 100);
                    }
                }
                
                // Atualizar desafios recentes na home
                if (recentChallenges) {
                    recentChallenges.innerHTML = '';
                    
                    // Pegar os 3 desafios mais recentes
                    const recent = [...this.challenges]
                        .sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate))
                        .slice(0, 3);
                    
                    if (recent.length === 0) {
                        recentChallenges.innerHTML = `
                            <p style="color: var(--text-secondary); text-align: center; padding: 20px;">
                                Nenhum desafio ativo
                            </p>
                        `;
                    } else {
                        recent.forEach(challenge => {
                            const creator = this.allMembers.find(m => m.id === challenge.creatorId);
                            const challengeItem = document.createElement('div');
                            challengeItem.className = 'content-card';
                            challengeItem.style.padding = '15px';
                            challengeItem.style.marginBottom = '15px';
                            challengeItem.innerHTML = `
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                    <h3 style="font-size: 16px; flex: 1;">${challenge.title}</h3>
                                    <span class="challenge-difficulty difficulty-${challenge.difficulty}" style="font-size: 10px;">
                                        ${this.getDifficultyName(challenge.difficulty)}
                                    </span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="margin-right: 10px;">
                                        <div style="font-size: 14px;">${creator ? creator.codename || creator.username : 'An√¥nimo'}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">${this.formatDate(challenge.createdDate)}</div>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                    <span style="font-size: 12px; color: var(--accent-neon);">
                                        <i class="fas fa-trophy"></i> ${challenge.points} pontos
                                    </span>
                                    <button class="btn btn-small btn-primary view-challenge-btn" data-challenge-id="${challenge.id}" style="padding: 3px 10px; font-size: 12px;">
                                        Ver Desafio
                                    </button>
                                </div>
                            `;
                            
                            recentChallenges.appendChild(challengeItem);
                        });
                    }
                }
            },
            
            // Atualizar informa√ß√µes de hierarquia
            updateHierarchyInfo() {
                const userProgress = document.getElementById('userProgress');
                const userContributions = document.getElementById('userContributions');
                
                if (!this.currentUser) return;
                
                // Progresso do usu√°rio
                if (userProgress) {
                    const nextLevel = this.getNextLevel(this.currentUser.level);
                    const pointsNeeded = this.getPointsForNextLevel(this.currentUser.level);
                    const progressPercent = pointsNeeded > 0 ? 
                        Math.min(100, Math.floor((this.currentUser.points || 0) / pointsNeeded * 100)) : 
                        (this.currentUser.level === 'core' ? 100 : 0);
                    
                    userProgress.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>N√≠vel atual: <strong class="level-badge badge-${this.currentUser.level}">${this.getLevelName(this.currentUser.level)}</strong></span>
                                <span>${this.currentUser.points || 0} pontos</span>
                            </div>
                            ${nextLevel ? `
                            <div style="background: rgba(255, 255, 255, 0.1); height: 10px; border-radius: 5px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, var(--accent-neon), var(--accent-renovated)); height: 100%; width: ${progressPercent}%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                                <span>Progresso para ${this.getLevelName(nextLevel)}</span>
                                <span>${progressPercent}% (${this.currentUser.points || 0}/${pointsNeeded} pontos)</span>
                            </div>
                            ` : `
                            <div style="text-align: center; padding: 10px; background: rgba(212, 175, 55, 0.1); border-radius: 8px; margin-top: 10px;">
                                <i class="fas fa-crown" style="color: var(--accent-gold);"></i>
                                <span style="color: var(--accent-gold);">Voc√™ atingiu o n√≠vel m√°ximo!</span>
                            </div>
                            `}
                        </div>
                    `;
                }
                
                // Contribui√ß√µes do usu√°rio
                if (userContributions) {
                    const userTheories = this.theories.filter(t => t.authorId === this.currentUser.id && t.status === 'approved').length;
                    const userGroups = this.groups.filter(g => g.creatorId === this.currentUser.id).length;
                    const userChallenges = this.challenges.filter(c => c.creatorId === this.currentUser.id).length;
                    
                    // Contar coment√°rios do usu√°rio
                    let userComments = 0;
                    Object.values(this.comments).forEach(commentList => {
                        userComments += commentList.filter(c => c.authorId === this.currentUser.id).length;
                    });
                    
                    // Contar solu√ß√µes do usu√°rio
                    let userSolutions = 0;
                    Object.values(this.solutions).forEach(solutionList => {
                        userSolutions += solutionList.filter(s => s.authorId === this.currentUser.id).length;
                    });
                    
                    userContributions.innerHTML = `
                        <div class="contributions">
                            <div class="contribution-item">
                                <div class="contribution-value">${userTheories}</div>
                                <div class="contribution-label">Teorias Aprovadas</div>
                            </div>
                            <div class="contribution-item">
                                <div class="contribution-value">${userComments}</div>
                                <div class="contribution-label">Respostas</div>
                            </div>
                            <div class="contribution-item">
                                <div class="contribution-value">${userChallenges}</div>
                                <div class="contribution-label">Desafios</div>
                            </div>
                            <div class="contribution-item">
                                <div class="contribution-value">${userSolutions}</div>
                                <div class="contribution-label">Solu√ß√µes</div>
                            </div>
                            <div class="contribution-item">
                                <div class="contribution-value">${userGroups}</div>
                                <div class="contribution-label">Grupos</div>
                            </div>
                        </div>
                    `;
                }
            },
            
            // Atualizar estat√≠sticas da home
            updateHomeStats() {
                const approvedTheories = this.theories.filter(t => t.status === 'approved').length;
                document.getElementById('totalTheoriesHome').textContent = approvedTheories;
                document.getElementById('totalChallengesHome').textContent = this.challenges.length;
                document.getElementById('totalGroupsHome').textContent = this.groups.length;
            },
            
            // Atualizar notifica√ß√µes
            updateNotifications() {
                const friendRequestsBadge = document.getElementById('friendRequestsBadge');
                
                if (friendRequestsBadge && this.currentUser && !this.currentUser.isBot) {
                    const pendingRequests = this.getPendingFriendRequests();
                    if (pendingRequests.length > 0) {
                        friendRequestsBadge.textContent = pendingRequests.length;
                        friendRequestsBadge.style.display = 'inline-block';
                    } else {
                        friendRequestsBadge.style.display = 'none';
                    }
                }
            },
            
            // ============================================
            // FUN√á√ïES PRINCIPAIS
            // ============================================
            
            // Manipular login
            handleLogin(username, email, nucleusKey) {
                // Processar avatar do login
                const avatarPreview = document.getElementById('avatarPreviewLogin');
                let avatarUrl = avatarPreview.style.backgroundImage;
                avatarUrl = avatarUrl.replace('url("', '').replace('")', '');
                
                // Verificar chave do n√∫cleo
                let initialLevel = 'observer';
                let initialPoints = 0;
                
                if (nucleusKey === 'Renova, O Not Trad') {
                    initialLevel = 'core';
                    initialPoints = 1000;
                }
                
                // Verificar se o usu√°rio j√° existe
                let user = this.allMembers.find(m => 
                    m.email === email && !m.isBot
                );
                
                if (user) {
                    // Usu√°rio existe, fazer login
                    this.currentUser = user;
                    user.online = true;
                } else {
                    // Criar novo usu√°rio
                    const userId = 'user_' + Date.now().toString();
                    user = {
                        id: userId,
                        username: username,
                        email: email,
                        codename: username,
                        specialty: 'Matem√°tica Geral',
                        bio: '',
                        level: initialLevel,
                        avatar: avatarUrl || `https://api.dicebear.com/7.x/identicon/svg?seed=${encodeURIComponent(username)}`,
                        friends: [],
                        points: initialPoints,
                        theories: 0,
                        solutions: 0,
                        online: true,
                        joinDate: new Date().toISOString().split('T')[0],
                        isBot: false
                    };
                    
                    this.allMembers.push(user);
                    this.currentUser = user;
                    
                    // Adicionar automaticamente alguns BOTS como amigos
                    const botIds = ['bot001', 'bot002', 'bot003'];
                    botIds.forEach(botId => {
                        if (!user.friends.includes(botId)) {
                            user.friends.push(botId);
                            // Tamb√©m adicionar o usu√°rio aos amigos do BOT
                            const bot = this.allMembers.find(m => m.id === botId);
                            if (bot && !bot.friends.includes(userId)) {
                                bot.friends.push(userId);
                            }
                        }
                    });
                }
                
                this.saveState();
                this.showMainApp();
                this.updateUI();
                
                // Mostrar mensagem de boas-vindas
                this.showNotification(`Bem-vindo, ${user.codename}! A revolu√ß√£o aguarda.`);
            },
            
            // Alternar entre abas
            switchTab(tabName) {
                // Esconder todas as abas
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Remover classe active de todos os bot√µes
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Mostrar aba selecionada
                const tabContent = document.getElementById(`${tabName}Content`);
                if (tabContent) {
                    tabContent.classList.add('active');
                }
                
                // Ativar bot√£o correspondente
                const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
                if (tabBtn) {
                    tabBtn.classList.add('active');
                }
                
                // Se for a aba de chat, garantir que o chat esteja limpo
                if (tabName === 'chat') {
                    document.getElementById('chatSelection').style.display = 'block';
                    document.getElementById('chatContainer').style.display = 'none';
                }
                
                // Se for a aba de perfil, preencher formul√°rio
                if (tabName === 'profile' && this.currentUser) {
                    document.getElementById('codename').value = this.currentUser.codename || this.currentUser.username;
                    document.getElementById('specialty').value = this.currentUser.specialty || '';
                    document.getElementById('bio').value = this.currentUser.bio || '';
                    const avatarPreview = document.getElementById('avatarPreview');
                    if (avatarPreview && this.currentUser.avatar) {
                        avatarPreview.style.backgroundImage = `url(${this.currentUser.avatar})`;
                    }
                }
                
                // Se for a aba de membros, atualizar solicita√ß√µes
                if (tabName === 'members') {
                    this.updateMembersList();
                }
            },
            
            // Adicionar amigo (para BOTs ou aceita√ß√£o de solicita√ß√£o)
            addFriend(memberId) {
                if (!this.currentUser) return;
                
                // Verificar se j√° √© amigo
                if (this.currentUser.friends && this.currentUser.friends.includes(memberId)) {
                    this.showNotification('Este membro j√° est√° na sua lista de contactos.');
                    return;
                }
                
                // Adicionar √† lista de amigos
                if (!this.currentUser.friends) {
                    this.currentUser.friends = [];
                }
                
                this.currentUser.friends.push(memberId);
                
                // Adicionar ao amigo tamb√©m (se for BOT)
                const member = this.allMembers.find(m => m.id === memberId);
                if (member && !member.friends.includes(this.currentUser.id)) {
                    if (!member.friends) member.friends = [];
                    member.friends.push(this.currentUser.id);
                }
                
                // Adicionar pontos
                this.addPoints(10, 'Adicionar contacto');
                
                // Atualizar interface
                this.updateFriendsList();
                this.updateMembersList();
                
                // Salvar estado
                this.saveState();
                
                // Mostrar notifica√ß√£o
                this.showNotification(`${member.codename || member.username} adicionado aos seus contactos. +10 pontos`);
            },
            
            // Enviar solicita√ß√£o de amizade
            sendFriendRequest(memberId, message) {
                if (!this.currentUser || this.currentUser.isBot) return;
                
                const member = this.allMembers.find(m => m.id === memberId);
                if (!member || member.isBot) return;
                
                // Verificar se j√° √© amigo
                if (this.currentUser.friends && this.currentUser.friends.includes(memberId)) {
                    this.showNotification('Este membro j√° est√° na sua lista de contactos.');
                    return;
                }
                
                // Verificar se j√° existe solicita√ß√£o pendente
                if (!this.friendRequests[memberId]) {
                    this.friendRequests[memberId] = [];
                }
                
                const existingRequest = this.friendRequests[memberId].find(r => 
                    r.from === this.currentUser.id && r.status === 'pending'
                );
                
                if (existingRequest) {
                    this.showNotification('Voc√™ j√° enviou uma solicita√ß√£o para este membro.');
                    return;
                }
                
                // Criar solicita√ß√£o
                const request = {
                    id: 'req_' + Date.now().toString(),
                    from: this.currentUser.id,
                    to: memberId,
                    message: message || '',
                    date: new Date().toISOString().split('T')[0],
                    status: 'pending'
                };
                
                this.friendRequests[memberId].push(request);
                
                // Adicionar notifica√ß√£o para o membro
                if (!this.notifications[memberId]) {
                    this.notifications[memberId] = [];
                }
                
                this.notifications[memberId].push({
                    id: 'notif_' + Date.now().toString(),
                    type: 'friend_request',
                    from: this.currentUser.id,
                    message: `${this.currentUser.codename} enviou uma solicita√ß√£o de amizade.`,
                    date: new Date().toISOString(),
                    read: false
                });
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateMembersList();
                
                // Mostrar notifica√ß√£o
                this.showNotification(`Solicita√ß√£o enviada para ${member.codename || member.username}.`);
            },
            
            // Aceitar solicita√ß√£o de amizade
            acceptFriendRequest(memberId) {
                if (!this.currentUser) return;
                
                // Encontrar a solicita√ß√£o
                if (!this.friendRequests[this.currentUser.id]) return;
                
                const requestIndex = this.friendRequests[this.currentUser.id].findIndex(r => 
                    r.from === memberId && r.status === 'pending'
                );
                
                if (requestIndex === -1) return;
                
                // Atualizar status da solicita√ß√£o
                this.friendRequests[this.currentUser.id][requestIndex].status = 'accepted';
                
                // Adicionar como amigo
                this.addFriend(memberId);
                
                // Adicionar notifica√ß√£o para o remetente
                const member = this.allMembers.find(m => m.id === memberId);
                if (member && !member.isBot) {
                    if (!this.notifications[memberId]) {
                        this.notifications[memberId] = [];
                    }
                    
                    this.notifications[memberId].push({
                        id: 'notif_' + Date.now().toString(),
                        type: 'friend_request_accepted',
                        from: this.currentUser.id,
                        message: `${this.currentUser.codename} aceitou sua solicita√ß√£o de amizade.`,
                        date: new Date().toISOString(),
                        read: false
                    });
                }
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateMembersList();
                this.updateNotifications();
                
                // Mostrar notifica√ß√£o
                this.showNotification(`Solicita√ß√£o de ${member.codename || member.username} aceita.`);
            },
            
            // Aceitar solicita√ß√£o por ID
            acceptFriendRequestById(requestId) {
                if (!this.currentUser) return;
                
                // Encontrar a solicita√ß√£o
                if (!this.friendRequests[this.currentUser.id]) return;
                
                const requestIndex = this.friendRequests[this.currentUser.id].findIndex(r => r.id === requestId);
                if (requestIndex === -1) return;
                
                const request = this.friendRequests[this.currentUser.id][requestIndex];
                const memberId = request.from;
                
                // Atualizar status da solicita√ß√£o
                this.friendRequests[this.currentUser.id][requestIndex].status = 'accepted';
                
                // Adicionar como amigo
                this.addFriend(memberId);
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateMembersList();
                this.updateNotifications();
                
                // Mostrar notifica√ß√£o
                const member = this.allMembers.find(m => m.id === memberId);
                this.showNotification(`Solicita√ß√£o de ${member.codename || member.username} aceita.`);
            },
            
            // Rejeitar solicita√ß√£o de amizade
            rejectFriendRequest(memberId) {
                if (!this.currentUser) return;
                
                // Encontrar a solicita√ß√£o
                if (!this.friendRequests[this.currentUser.id]) return;
                
                const requestIndex = this.friendRequests[this.currentUser.id].findIndex(r => 
                    r.from === memberId && r.status === 'pending'
                );
                
                if (requestIndex === -1) return;
                
                // Atualizar status da solicita√ß√£o
                this.friendRequests[this.currentUser.id][requestIndex].status = 'rejected';
                
                // Adicionar notifica√ß√£o para o remetente
                const member = this.allMembers.find(m => m.id === memberId);
                if (member && !member.isBot) {
                    if (!this.notifications[memberId]) {
                        this.notifications[memberId] = [];
                    }
                    
                    this.notifications[memberId].push({
                        id: 'notif_' + Date.now().toString(),
                        type: 'friend_request_rejected',
                        from: this.currentUser.id,
                        message: `${this.currentUser.codename} recusou sua solicita√ß√£o de amizade.`,
                        date: new Date().toISOString(),
                        read: false
                    });
                }
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateMembersList();
                this.updateNotifications();
                
                // Mostrar notifica√ß√£o
                this.showNotification(`Solicita√ß√£o de ${member.codename || member.username} recusada.`);
            },
            
            // Rejeitar solicita√ß√£o por ID
            rejectFriendRequestById(requestId) {
                if (!this.currentUser) return;
                
                // Encontrar a solicita√ß√£o
                if (!this.friendRequests[this.currentUser.id]) return;
                
                const requestIndex = this.friendRequests[this.currentUser.id].findIndex(r => r.id === requestId);
                if (requestIndex === -1) return;
                
                const request = this.friendRequests[this.currentUser.id][requestIndex];
                const memberId = request.from;
                
                // Atualizar status da solicita√ß√£o
                this.friendRequests[this.currentUser.id][requestIndex].status = 'rejected';
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateMembersList();
                this.updateNotifications();
                
                // Mostrar notifica√ß√£o
                const member = this.allMembers.find(m => m.id === memberId);
                this.showNotification(`Solicita√ß√£o de ${member.codename || member.username} recusada.`);
            },
            
            // Enviar mensagem
            sendMessage(friendId, messageText) {
                if (!this.currentUser || !messageText.trim()) return;
                
                // Criar ID da conversa (ordem alfab√©tica dos IDs para garantir unicidade)
                const conversationId = [this.currentUser.id, friendId].sort().join('_');
                
                // Inicializar array de mensagens se n√£o existir
                if (!this.privateMessages[conversationId]) {
                    this.privateMessages[conversationId] = [];
                }
                
                // Criar mensagem
                const message = {
                    id: Date.now().toString(),
                    senderId: this.currentUser.id,
                    receiverId: friendId,
                    text: messageText,
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                // Adicionar √† conversa
                this.privateMessages[conversationId].push(message);
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface do chat
                this.updateChatMessages(friendId);
                
                // Rolagem para a √∫ltima mensagem
                setTimeout(() => {
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                }, 100);
                
                return message;
            },
            
            // Salvar teoria (aguardando aprova√ß√£o do N√∫cleo)
            saveTheory(title, content, category) {
                if (!this.currentUser || !title.trim() || !content.trim()) return;
                
                // Verificar permiss√£o
                if (this.currentUser.level === 'observer') {
                    this.showNotification('Apenas Iniciados ou superiores podem enviar teorias para aprova√ß√£o.');
                    return;
                }
                
                // Criar nova teoria
                const theory = {
                    id: 'theory_' + Date.now().toString(),
                    title: title,
                    content: content,
                    category: category,
                    authorId: this.currentUser.id,
                    status: 'pending',
                    date: new Date().toISOString().split('T')[0],
                    likes: 0,
                    comments: 0
                };
                
                // Adicionar √† lista de teorias
                this.theories.unshift(theory);
                
                // Atualizar contador do usu√°rio
                this.currentUser.theories = (this.currentUser.theories || 0) + 1;
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateUI();
                
                // Mostrar notifica√ß√£o
                this.showNotification(`Teoria enviada para aprova√ß√£o do N√∫cleo! Aguarde a avalia√ß√£o.`);
                
                return theory;
            },
            
            // Aprovar teoria (apenas N√∫cleo)
            approveTheory(theoryId) {
                if (!this.currentUser || this.currentUser.level !== 'core') {
                    this.showNotification('Apenas membros do N√∫cleo podem aprovar teorias.');
                    return;
                }
                
                const theory = this.theories.find(t => t.id === theoryId);
                if (!theory) return;
                
                // Atualizar status
                theory.status = 'approved';
                theory.approvedBy = this.currentUser.id;
                
                // Adicionar pontos ao autor
                const author = this.allMembers.find(m => m.id === theory.authorId);
                if (author) {
                    author.points = (author.points || 0) + 200; // B√¥nus por aprova√ß√£o
                    
                    // Verificar promo√ß√£o
                    this.checkMemberPromotion(author);
                }
                
                // Adicionar notifica√ß√£o para o autor
                if (!author.isBot) {
                    if (!this.notifications[author.id]) {
                        this.notifications[author.id] = [];
                    }
                    
                    this.notifications[author.id].push({
                        id: 'notif_' + Date.now().toString(),
                        type: 'theory_approved',
                        from: this.currentUser.id,
                        message: `Sua teoria "${theory.title}" foi aprovada pelo N√∫cleo! +200 pontos`,
                        date: new Date().toISOString(),
                        read: false
                    });
                }
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateUI();
                
                // Mostrar notifica√ß√£o
                this.showNotification(`Teoria "${theory.title}" aprovada! +200 pontos para o autor.`);
            },
            
            // Rejeitar teoria (apenas N√∫cleo)
            rejectTheory(theoryId) {
                if (!this.currentUser || this.currentUser.level !== 'core') {
                    this.showNotification('Apenas membros do N√∫cleo podem rejeitar teorias.');
                    return;
                }
                
                const theory = this.theories.find(t => t.id === theoryId);
                if (!theory) return;
                
                // Atualizar status
                theory.status = 'rejected';
                theory.approvedBy = this.currentUser.id;
                
                // Adicionar notifica√ß√£o para o autor
                const author = this.allMembers.find(m => m.id === theory.authorId);
                if (author && !author.isBot) {
                    if (!this.notifications[author.id]) {
                        this.notifications[author.id] = [];
                    }
                    
                    this.notifications[author.id].push({
                        id: 'notif_' + Date.now().toString(),
                        type: 'theory_rejected',
                        from: this.currentUser.id,
                        message: `Sua teoria "${theory.title}" foi rejeitada pelo N√∫cleo.`,
                        date: new Date().toISOString(),
                        read: false
                    });
                }
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateUI();
                
                // Mostrar notifica√ß√£o
                this.showNotification(`Teoria "${theory.title}" rejeitada.`);
            },
            
            // Solicitar altera√ß√µes na teoria (apenas N√∫cleo)
            requestTheoryChanges(theoryId) {
                if (!this.currentUser || this.currentUser.level !== 'core') {
                    this.showNotification('Apenas membros do N√∫cleo podem solicitar altera√ß√µes.');
                    return;
                }
                
                const theory = this.theories.find(t => t.id === theoryId);
                if (!theory) return;
                
                // Adicionar notifica√ß√£o para o autor
                const author = this.allMembers.find(m => m.id === theory.authorId);
                if (author && !author.isBot) {
                    if (!this.notifications[author.id]) {
                        this.notifications[author.id] = [];
                    }
                    
                    this.notifications[author.id].push({
                        id: 'notif_' + Date.now().toString(),
                        type: 'theory_changes_requested',
                        from: this.currentUser.id,
                        message: `O N√∫cleo solicitou altera√ß√µes na sua teoria "${theory.title}".`,
                        date: new Date().toISOString(),
                        read: false
                    });
                }
                
                // Mostrar notifica√ß√£o
                this.showNotification(`Solicita√ß√£o de altera√ß√µes enviada para o autor.`);
            },
            
            // Adicionar coment√°rio √† teoria
            addComment(theoryId, content) {
                if (!this.currentUser || !content.trim()) return;
                
                // Verificar permiss√£o
                if (this.currentUser.level === 'observer') {
                    this.showNotification('Apenas Iniciados ou superiores podem responder a teorias.');
                    return;
                }
                
                const theory = this.theories.find(t => t.id === theoryId);
                if (!theory || theory.status !== 'approved') {
                    this.showNotification('Esta teoria n√£o est√° dispon√≠vel para coment√°rios.');
                    return;
                }
                
                // Inicializar array de coment√°rios se n√£o existir
                if (!this.comments[theoryId]) {
                    this.comments[theoryId] = [];
                }
                
                // Criar coment√°rio
                const comment = {
                    id: 'comment_' + Date.now().toString(),
                    theoryId: theoryId,
                    authorId: this.currentUser.id,
                    content: content,
                    date: new Date().toISOString().split('T')[0]
                };
                
                // Adicionar √† lista de coment√°rios
                this.comments[theoryId].push(comment);
                
                // Atualizar contador na teoria
                theory.comments = (theory.comments || 0) + 1;
                
                // Adicionar pontos
                this.addPoints(10, 'Comentar em teoria');
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateTheoriesList();
                
                // Mostrar notifica√ß√£o
                this.showNotification('Resposta publicada com sucesso! +10 pontos');
                
                return comment;
            },
            
            // Criar grupo
            createGroup(name, description, tags, privacy) {
                if (!this.currentUser || !name.trim() || !description.trim()) return;
                
                // Verificar permiss√£o
                if (this.currentUser.level === 'observer') {
                    this.showNotification('Apenas Iniciados ou superiores podem criar grupos.');
                    return;
                }
                
                // Criar novo grupo
                const group = {
                    id: 'group_' + Date.now().toString(),
                    name: name,
                    description: description,
                    tags: tags ? tags.split(',').map(t => t.trim()).filter(t => t) : [],
                    privacy: privacy,
                    creatorId: this.currentUser.id,
                    members: [this.currentUser.id],
                    createdDate: new Date().toISOString().split('T')[0]
                };
                
                // Adicionar √† lista de grupos
                this.groups.push(group);
                
                // Adicionar pontos
                this.addPoints(30, 'Criar grupo');
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateGroupsList();
                
                // Mostrar notifica√ß√£o
                this.showNotification(`Grupo "${name}" criado com sucesso! +30 pontos`);
                
                return group;
            },
            
            // Entrar em grupo
            joinGroup(groupId) {
                if (!this.currentUser) return;
                
                const group = this.groups.find(g => g.id === groupId);
                if (!group) return;
                
                // Verificar se j√° √© membro
                if (group.members && group.members.includes(this.currentUser.id)) {
                    this.showNotification('Voc√™ j√° √© membro deste grupo.');
                    return;
                }
                
                // Verificar permiss√£o
                if (!this.canUserJoinGroup(group)) {
                    this.showNotification('Voc√™ n√£o tem permiss√£o para entrar neste grupo.');
                    return;
                }
                
                // Adicionar ao grupo
                if (!group.members) group.members = [];
                group.members.push(this.currentUser.id);
                
                // Adicionar pontos
                this.addPoints(10, 'Entrar em grupo');
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateGroupsList();
                
                // Mostrar notifica√ß√£o
                this.showNotification(`Voc√™ entrou no grupo "${group.name}"! +10 pontos`);
            },
            
            // Enviar mensagem no grupo
            sendGroupMessage(groupId, messageText) {
                if (!this.currentUser || !messageText.trim()) return;
                
                const group = this.groups.find(g => g.id === groupId);
                if (!group || !group.members.includes(this.currentUser.id)) {
                    this.showNotification('Voc√™ n√£o √© membro deste grupo.');
                    return;
                }
                
                // Inicializar array de mensagens se n√£o existir
                if (!this.groupMessages[groupId]) {
                    this.groupMessages[groupId] = [];
                }
                
                // Criar mensagem
                const message = {
                    id: 'gm_' + Date.now().toString(),
                    groupId: groupId,
                    authorId: this.currentUser.id,
                    content: messageText,
                    timestamp: new Date().toISOString()
                };
                
                // Adicionar √† lista de mensagens
                this.groupMessages[groupId].push(message);
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface do chat do grupo
                this.updateGroupChatMessages(groupId);
                
                // Rolagem para a √∫ltima mensagem
                setTimeout(() => {
                    const chatMessages = document.getElementById('groupChatMessages');
                    if (chatMessages) {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                }, 100);
                
                return message;
            },
            
            // Abrir chat do grupo
            openGroupChat(groupId) {
                const group = this.groups.find(g => g.id === groupId);
                if (!group) return;
                
                // Atualizar modal
                document.getElementById('groupChatTitle').textContent = group.name;
                document.getElementById('groupChatName').textContent = group.name;
                document.getElementById('groupChatInfo').textContent = `${group.members.length} membros`;
                
                // Mostrar modal
                document.getElementById('groupChatModal').classList.add('active');
                
                // Carregar mensagens
                this.updateGroupChatMessages(groupId);
                
                // Configurar envio de mensagens
                const sendBtn = document.getElementById('sendGroupMessageBtn');
                const input = document.getElementById('groupChatInput');
                
                const sendMessage = () => {
                    const message = input.value.trim();
                    if (message) {
                        this.sendGroupMessage(groupId, message);
                        input.value = '';
                        input.focus();
                    }
                };
                
                sendBtn.onclick = sendMessage;
                input.onkeypress = (e) => {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                };
            },
            
            // Atualizar mensagens do chat do grupo
            updateGroupChatMessages(groupId) {
                const chatMessages = document.getElementById('groupChatMessages');
                if (!chatMessages) return;
                
                const messages = this.groupMessages[groupId] || [];
                
                chatMessages.innerHTML = '';
                
                if (messages.length === 0) {
                    chatMessages.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary); padding: 40px;">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px;"></i>
                            <p>Nenhuma mensagem ainda. Seja o primeiro a falar!</p>
                        </div>
                    `;
                } else {
                    messages.forEach(msg => {
                        const author = this.allMembers.find(m => m.id === msg.authorId);
                        const isSent = msg.authorId === this.currentUser.id;
                        const time = new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        
                        let avatarStyle = '';
                        if (author && author.avatar && author.avatar.startsWith('http')) {
                            avatarStyle = `background-image: url('${author.avatar}')`;
                        }
                        
                        const messageDiv = document.createElement('div');
                        messageDiv.className = `group-message ${isSent ? 'sent' : 'received'}`;
                        messageDiv.innerHTML = `
                            <div class="group-message-author">
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <div class="comment-author-avatar ${author ? author.level : ''}" style="width: 20px; height: 20px; font-size: 10px; ${avatarStyle}">
                                        ${avatarStyle ? '' : (author ? author.avatar : 'AR')}
                                    </div>
                                    ${author ? author.codename || author.username : 'An√¥nimo'}
                                    ${author?.isBot ? '<span class="bot-badge" style="font-size: 8px;">BOT</span>' : ''}
                                </div>
                            </div>
                            <div>${this.formatMessageText(msg.content)}</div>
                            <div class="group-message-time">${time}</div>
                        `;
                        
                        chatMessages.appendChild(messageDiv);
                    });
                    
                    // Rolagem para a √∫ltima mensagem
                    setTimeout(() => {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 100);
                }
            },
            
            // Criar desafio
            createChallenge(title, description, difficulty, deadlineDays) {
                if (!this.currentUser || !title.trim() || !description.trim()) return;
                
                // Verificar permiss√£o
                if (this.currentUser.level === 'observer') {
                    this.showNotification('Apenas Iniciados ou superiores podem criar desafios.');
                    return;
                }
                
                // Calcular prazo
                const deadline = new Date();
                deadline.setDate(deadline.getDate() + parseInt(deadlineDays));
                
                // Pontos baseados na dificuldade
                const pointsMap = { 'easy': 15, 'medium': 25, 'hard': 40, 'extreme': 60 };
                const points = pointsMap[difficulty] || 25;
                
                // Criar novo desafio
                const challenge = {
                    id: 'challenge_' + Date.now().toString(),
                    title: title,
                    description: description,
                    difficulty: difficulty,
                    points: points,
                    creatorId: this.currentUser.id,
                    deadline: deadline.toISOString().split('T')[0],
                    createdDate: new Date().toISOString().split('T')[0],
                    solutions: 0
                };
                
                // Adicionar √† lista de desafios
                this.challenges.push(challenge);
                
                // Adicionar pontos
                this.addPoints(15, 'Criar desafio');
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateChallengesList();
                
                // Mostrar notifica√ß√£o
                this.showNotification(`Desafio "${title}" criado com sucesso! +15 pontos`);
                
                return challenge;
            },
            
            // Enviar solu√ß√£o para desafio
            submitSolution(challengeId, content) {
                if (!this.currentUser || !content.trim()) return;
                
                // Verificar permiss√£o
                if (this.currentUser.level === 'observer') {
                    this.showNotification('Apenas Iniciados ou superiores podem resolver desafios.');
                    return;
                }
                
                // Inicializar array de solu√ß√µes se n√£o existir
                if (!this.solutions[challengeId]) {
                    this.solutions[challengeId] = [];
                }
                
                // Verificar se j√° enviou solu√ß√£o
                const hasSubmitted = this.solutions[challengeId].some(s => s.authorId === this.currentUser.id);
                if (hasSubmitted) {
                    this.showNotification('Voc√™ j√° enviou uma solu√ß√£o para este desafio.');
                    return;
                }
                
                // Criar solu√ß√£o
                const solution = {
                    id: 'solution_' + Date.now().toString(),
                    challengeId: challengeId,
                    authorId: this.currentUser.id,
                    content: content,
                    date: new Date().toISOString().split('T')[0],
                    status: 'pending'
                };
                
                // Adicionar √† lista de solu√ß√µes
                this.solutions[challengeId].push(solution);
                
                // Atualizar contador no desafio
                const challenge = this.challenges.find(c => c.id === challengeId);
                if (challenge) {
                    challenge.solutions = (challenge.solutions || 0) + 1;
                }
                
                // Adicionar pontos
                this.addPoints(50, 'Resolver desafio');
                
                // Atualizar contador do usu√°rio
                this.currentUser.solutions = (this.currentUser.solutions || 0) + 1;
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateChallengesList();
                this.updateHierarchyInfo();
                
                // Mostrar notifica√ß√£o
                this.showNotification('Solu√ß√£o enviada com sucesso! Aguarde aprova√ß√£o. +50 pontos');
                
                return solution;
            },
            
            // Atualizar perfil
            updateProfile(codename, specialty, bio) {
                if (!this.currentUser) return;
                
                // Atualizar informa√ß√µes
                this.currentUser.codename = codename || this.currentUser.username;
                this.currentUser.specialty = specialty || 'Matem√°tica Geral';
                this.currentUser.bio = bio || '';
                
                // Se n√£o tiver avatar personalizado, gerar um baseado no codename
                if (!this.currentUser.avatar || this.currentUser.avatar.includes('dicebear')) {
                    this.currentUser.avatar = `https://api.dicebear.com/7.x/identicon/svg?seed=${encodeURIComponent(codename || this.currentUser.username)}`;
                }
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateUI();
                
                // Mostrar notifica√ß√£o
                this.showNotification('Perfil atualizado com sucesso!');
            },
            
            // ============================================
            // FUN√á√ïES AUXILIARES
            // ============================================
            
            // Abrir chat privado com um amigo
            openChat(friend) {
                // Mostrar container do chat
                document.getElementById('chatSelection').style.display = 'none';
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.style.display = 'flex';
                
                // Atualizar cabe√ßalho do chat
                chatContainer.innerHTML = `
                    <div class="chat-header">
                        <button class="chat-back-btn" id="chatBackBtn">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="chat-friend-info">
                            <h4>${friend.codename || friend.username} ${friend.isBot ? '<span class="bot-badge">BOT</span>' : ''}</h4>
                            <p>${friend.specialty || 'Matem√°tica Geral'} ‚Ä¢ ${this.getLevelName(friend.level)}</p>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <!-- Mensagens ser√£o carregadas aqui -->
                    </div>
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Digite sua mensagem... (LaTeX: $$f√≥rmula$$)">
                        <button class="btn btn-primary" id="sendMessageBtn">
                            <i class="fas fa-paper-plane"></i> Enviar
                        </button>
                    </div>
                `;
                
                // Adicionar event listeners
                document.getElementById('chatBackBtn').addEventListener('click', () => {
                    document.getElementById('chatSelection').style.display = 'block';
                    chatContainer.style.display = 'none';
                });
                
                const sendMessage = () => {
                    const input = document.getElementById('chatInput');
                    const message = input.value.trim();
                    
                    if (message) {
                        this.sendMessage(friend.id, message);
                        input.value = '';
                        input.focus();
                    }
                };
                
                document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);
                
                document.getElementById('chatInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
                
                // Carregar mensagens
                this.updateChatMessages(friend.id);
            },
            
            // Atualizar mensagens do chat privado
            updateChatMessages(friendId) {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;
                
                // Criar ID da conversa
                const conversationId = [this.currentUser.id, friendId].sort().join('_');
                const messages = this.privateMessages[conversationId] || [];
                
                chatMessages.innerHTML = '';
                
                if (messages.length === 0) {
                    chatMessages.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary); padding: 40px;">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px;"></i>
                            <p>Nenhuma mensagem ainda. Inicie a conversa!</p>
                        </div>
                    `;
                } else {
                    messages.forEach(msg => {
                        const isSent = msg.senderId === this.currentUser.id;
                        const time = new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        
                        const messageDiv = document.createElement('div');
                        messageDiv.className = `message ${isSent ? 'sent' : 'received'}`;
                        messageDiv.innerHTML = `
                            <div>${this.formatMessageText(msg.text)}</div>
                            <div class="message-time">${time}</div>
                        `;
                        
                        chatMessages.appendChild(messageDiv);
                    });
                    
                    // Rolagem para a √∫ltima mensagem
                    setTimeout(() => {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 100);
                }
                
                // Renderizar LaTeX nas mensagens
                setTimeout(() => {
                    if (window.MathJax) {
                        window.MathJax.typeset([chatMessages]);
                    }
                }, 100);
            },
            
            // Abrir modal de coment√°rio
            openCommentModal(theoryId) {
                document.getElementById('commentTheoryId').value = theoryId;
                document.getElementById('commentModal').classList.add('active');
                document.getElementById('commentContent').focus();
            },
            
            // Abrir modal de solu√ß√£o
            openSolutionModal(challengeId) {
                document.getElementById('solutionChallengeId').value = challengeId;
                document.getElementById('solutionModal').classList.add('active');
                document.getElementById('solutionContent').focus();
            },
            
            // Abrir modal de solicita√ß√£o de amizade
            openFriendRequestModal(memberId) {
                const member = this.allMembers.find(m => m.id === memberId);
                if (!member) return;
                
                document.getElementById('requestMemberId').value = memberId;
                
                let avatarStyle = '';
                if (member.avatar && member.avatar.startsWith('http')) {
                    avatarStyle = `background-image: url('${member.avatar}')`;
                }
                
                const avatarEl = document.getElementById('requestMemberAvatar');
                if (avatarEl) {
                    avatarEl.style.backgroundImage = avatarStyle ? `url('${member.avatar}')` : '';
                    avatarEl.innerHTML = avatarStyle ? '' : (member.avatar || 'AR');
                    avatarEl.className = `avatar ${member.level}`;
                }
                
                document.getElementById('requestMemberName').textContent = member.codename || member.username;
                document.getElementById('requestMemberSpecialty').textContent = member.specialty || 'Matem√°tica Geral';
                
                document.getElementById('friendRequestModal').classList.add('active');
                document.getElementById('requestMessage').focus();
            },
            
            // Mostrar todos os coment√°rios
            showAllComments(theoryId) {
                const theory = this.theories.find(t => t.id === theoryId);
                const comments = this.comments[theoryId] || [];
                
                let commentsHTML = '';
                comments.forEach(comment => {
                    const author = this.allMembers.find(m => m.id === comment.authorId);
                    
                    let avatarStyle = '';
                    if (author && author.avatar && author.avatar.startsWith('http')) {
                        avatarStyle = `background-image: url('${author.avatar}')`;
                    }
                    
                    commentsHTML += `
                        <div class="comment">
                            <div class="comment-header">
                                <div class="comment-author">
                                    <div class="comment-author-avatar ${author ? author.level : ''} ${author?.isBot ? 'bot' : ''}" style="${avatarStyle}">
                                        ${avatarStyle ? '' : (author ? author.avatar : 'AR')}
                                    </div>
                                    <div>
                                        <strong>${author ? author.codename || author.username : 'An√¥nimo'}</strong>
                                        <div class="comment-date">${this.formatDate(comment.date)}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="comment-content">
                                ${this.formatTheoryContent(comment.content)}
                            </div>
                        </div>
                    `;
                });
                
                // Criar modal tempor√°rio
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">Respostas √† Teoria: ${theory ? theory.title : ''}</h2>
                            <button class="close-btn" id="closeTempModal">&times;</button>
                        </div>
                        <div class="comments-list" style="max-height: 400px; overflow-y: auto;">
                            ${commentsHTML}
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" id="closeTempBtn">Fechar</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Event listeners
                document.getElementById('closeTempModal').addEventListener('click', () => {
                    modal.remove();
                });
                
                document.getElementById('closeTempBtn').addEventListener('click', () => {
                    modal.remove();
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
                
                // Renderizar LaTeX
                setTimeout(() => {
                    if (window.MathJax) {
                        window.MathJax.typeset([modal]);
                    }
                }, 100);
            },
            
            // Mostrar detalhes do desafio
            showChallengeDetails(challengeId) {
                const challenge = this.challenges.find(c => c.id === challengeId);
                const creator = challenge ? this.allMembers.find(m => m.id === challenge.creatorId) : null;
                const solutions = challenge ? this.solutions[challengeId] || [] : [];
                
                if (!challenge) return;
                
                let avatarStyle = '';
                if (creator && creator.avatar && creator.avatar.startsWith('http')) {
                    avatarStyle = `background-image: url('${creator.avatar}')`;
                }
                
                // Criar modal tempor√°rio
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">${challenge.title}</h2>
                            <button class="close-btn" id="closeChallengeDetails">&times;</button>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <span class="challenge-difficulty difficulty-${challenge.difficulty}">
                                ${this.getDifficultyName(challenge.difficulty)}
                            </span>
                            <span style="margin-left: 10px; color: var(--accent-neon);">
                                <i class="fas fa-trophy"></i> ${challenge.points} pontos
                            </span>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <div style="color: var(--text-secondary); margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                <div class="author-avatar ${creator ? creator.level : ''}" style="width: 30px; height: 30px; font-size: 12px; ${avatarStyle}">
                                    ${avatarStyle ? '' : (creator ? creator.avatar : 'AR')}
                                </div>
                                Criado por: ${creator ? creator.codename || creator.username : 'Desconhecido'}
                            </div>
                            <div style="color: var(--text-secondary);">
                                <i class="fas fa-clock"></i> Prazo: ${this.formatDate(challenge.deadline)}
                                ${this.isDeadlineNear(challenge.deadline) ? 
                                    '<span style="color: var(--warning); margin-left: 10px;">(PRAZO PR√ìXIMO!)</span>' : ''}
                            </div>
                        </div>
                        
                        <div class="theory-content" style="margin-bottom: 25px;">
                            ${this.formatTheoryContent(challenge.description)}
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h3 style="color: var(--accent-neon); margin-bottom: 15px;">Solu√ß√µes (${solutions.length})</h3>
                            ${solutions.length === 0 ? 
                                '<p style="color: var(--text-secondary); text-align: center;">Nenhuma solu√ß√£o enviada ainda.</p>' :
                                solutions.map(sol => {
                                    const solAuthor = this.allMembers.find(m => m.id === sol.authorId);
                                    let solAvatarStyle = '';
                                    if (solAuthor && solAuthor.avatar && solAuthor.avatar.startsWith('http')) {
                                        solAvatarStyle = `background-image: url('${solAuthor.avatar}')`;
                                    }
                                    
                                    return `
                                        <div class="comment" style="margin-bottom: 15px;">
                                            <div class="comment-header">
                                                <div class="comment-author">
                                                    <div class="comment-author-avatar ${solAuthor ? solAuthor.level : ''}" style="${solAvatarStyle}">
                                                        ${solAvatarStyle ? '' : (solAuthor ? solAuthor.avatar : 'AR')}
                                                    </div>
                                                    <div>
                                                        <strong>${solAuthor ? solAuthor.codename || solAuthor.username : 'An√¥nimo'}</strong>
                                                        <div class="comment-date">${this.formatDate(sol.date)} ‚Ä¢ Status: ${sol.status === 'approved' ? '‚úÖ Aprovada' : '‚è≥ Pendente'}</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="comment-content">
                                                ${this.formatTheoryContent(sol.content)}
                                            </div>
                                        </div>
                                    `;
                                }).join('')
                            }
                        </div>
                        
                        <div class="form-actions">
                            ${this.currentUser && this.currentUser.level !== 'observer' && 
                              !solutions.some(s => s.authorId === this.currentUser.id) ? 
                            `<button class="btn btn-warning" id="solveFromModal" data-challenge-id="${challengeId}">
                                <i class="fas fa-paper-plane"></i> Enviar Minha Solu√ß√£o
                            </button>` : ''}
                            <button class="btn btn-secondary" id="closeDetailsBtn">Fechar</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Event listeners
                const closeModal = () => modal.remove();
                
                document.getElementById('closeChallengeDetails').addEventListener('click', closeModal);
                document.getElementById('closeDetailsBtn').addEventListener('click', closeModal);
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal();
                    }
                });
                
                // Bot√£o de resolver do modal
                const solveBtn = document.getElementById('solveFromModal');
                if (solveBtn) {
                    solveBtn.addEventListener('click', () => {
                        closeModal();
                        this.openSolutionModal(challengeId);
                    });
                }
                
                // Renderizar LaTeX
                setTimeout(() => {
                    if (window.MathJax) {
                        window.MathJax.typeset([modal]);
                    }
                }, 100);
            },
            
            // Adicionar pontos ao usu√°rio
            addPoints(points, reason) {
                if (!this.currentUser) return;
                
                this.currentUser.points = (this.currentUser.points || 0) + points;
                
                // Verificar promo√ß√£o autom√°tica
                this.checkPromotion();
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateUserProfile();
                this.updateHierarchyInfo();
                
                console.log(`+${points} pontos para ${this.currentUser.codename}: ${reason}`);
            },
            
            // Verificar promo√ß√£o autom√°tica do usu√°rio atual
            checkPromotion() {
                if (!this.currentUser) return;
                
                const currentPoints = this.currentUser.points || 0;
                const currentLevel = this.currentUser.level;
                
                // Pontos necess√°rios para cada n√≠vel (ajustados)
                const pointsNeeded = {
                    'observer': 500,      // Para Iniciado
                    'initiate': 1500,     // Para Renovado  
                    'renovated': 15000,   // Para N√∫cleo (apenas por pontos)
                    'core': Infinity      // N√≠vel m√°ximo
                };
                
                // Promo√ß√£o para Iniciado
                if (currentLevel === 'observer' && currentPoints >= pointsNeeded.observer) {
                    this.currentUser.level = 'initiate';
                    this.showNotification(`üéâ Parab√©ns! Voc√™ foi promovido a Iniciado!`);
                }
                
                // Promo√ß√£o para Renovado
                if (currentLevel === 'initiate' && currentPoints >= pointsNeeded.initiate) {
                    this.currentUser.level = 'renovated';
                    this.showNotification(`üéâ Parab√©ns! Voc√™ foi promovido a Renovado!`);
                }
                
                // Promo√ß√£o para N√∫cleo (apenas por pontos - muito dif√≠cil)
                if (currentLevel === 'renovated' && currentPoints >= pointsNeeded.renovated) {
                    this.currentUser.level = 'core';
                    this.showNotification(`üèÜ INCR√çVEL! Voc√™ alcan√ßou o N√∫cleo por m√©rito pr√≥prio!`);
                }
            },
            
            // Verificar promo√ß√£o de outro membro
            checkMemberPromotion(member) {
                if (!member) return;
                
                const currentPoints = member.points || 0;
                const currentLevel = member.level;
                
                // Pontos necess√°rios para cada n√≠vel
                const pointsNeeded = {
                    'observer': 500,
                    'initiate': 1500,
                    'renovated': 15000,
                    'core': Infinity
                };
                
                // Promo√ß√£o para Iniciado
                if (currentLevel === 'observer' && currentPoints >= pointsNeeded.observer) {
                    member.level = 'initiate';
                }
                
                // Promo√ß√£o para Renovado
                if (currentLevel === 'initiate' && currentPoints >= pointsNeeded.initiate) {
                    member.level = 'renovated';
                }
                
                // Promo√ß√£o para N√∫cleo (apenas por pontos)
                if (currentLevel === 'renovated' && currentPoints >= pointsNeeded.renovated) {
                    member.level = 'core';
                }
            },
            
            // Verificar se usu√°rio pode entrar no grupo
            canUserJoinGroup(group) {
                if (!this.currentUser) return false;
                
                // Se j√° √© membro
                if (group.members && group.members.includes(this.currentUser.id)) {
                    return false;
                }
                
                // Verificar n√≠vel necess√°rio
                if (group.privacy === 'restricted') {
                    return this.currentUser.level === 'initiate' || 
                           this.currentUser.level === 'renovated' || 
                           this.currentUser.level === 'core';
                }
                
                // Grupos privados precisam de convite
                if (group.privacy === 'private') {
                    return false; // Por enquanto, sem sistema de convites
                }
                
                return true;
            },
            
            // ============================================
            // FUN√á√ïES DE FORMATA√á√ÉO E UTILIT√ÅRIOS
            // ============================================
            
            // Formatar conte√∫do (converter LaTeX)
            formatTheoryContent(content) {
                // Converter quebras de linha para <p>
                let formatted = content.split('\n\n').map(paragraph => {
                    if (paragraph.trim() === '') return '';
                    return `<p>${paragraph}</p>`;
                }).join('');
                
                return formatted;
            },
            
            // Formatar texto da mensagem (suporte a LaTeX)
            formatMessageText(text) {
                // Converter LaTeX inline
                let formatted = text.replace(/\$\$(.*?)\$\$/g, '\\[$1\\]');
                formatted = formatted.replace(/\$(.*?)\$/g, '\\($1\\)');
                
                return formatted;
            },
            
            // Formatar data
            formatDate(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    return 'Hoje';
                } else if (diffDays === 1) {
                    return 'Ontem';
                } else if (diffDays < 7) {
                    return `${diffDays} dias atr√°s`;
                } else {
                    return date.toLocaleDateString('pt-BR');
                }
            },
            
            // Obter nome do n√≠vel
            getLevelName(level) {
                const names = {
                    'observer': 'Observador',
                    'initiate': 'Iniciado',
                    'renovated': 'Renovado',
                    'core': 'N√∫cleo'
                };
                return names[level] || 'Desconhecido';
            },
            
            // Obter pr√≥ximo n√≠vel
            getNextLevel(currentLevel) {
                const order = ['observer', 'initiate', 'renovated', 'core'];
                const currentIndex = order.indexOf(currentLevel);
                return currentIndex < order.length - 1 ? order[currentIndex + 1] : null;
            },
            
            // Obter pontos necess√°rios para pr√≥ximo n√≠vel
            getPointsForNextLevel(currentLevel) {
                const pointsMap = {
                    'observer': 500,
                    'initiate': 1500,
                    'renovated': 15000,
                    'core': 0
                };
                return pointsMap[currentLevel] || 0;
            },
            
            // Obter nome da categoria
            getCategoryName(category) {
                const names = {
                    'algebra': '√Ålgebra Abstrata',
                    'topology': 'Topologia',
                    'category': 'Teoria das Categorias',
                    'logic': 'L√≥gica Matem√°tica',
                    'geometry': 'Geometria N√£o-Euclidiana',
                    'other': 'Outra'
                };
                return names[category] || 'Geral';
            },
            
            // Obter nome da dificuldade
            getDifficultyName(difficulty) {
                const names = {
                    'easy': 'F√°cil',
                    'medium': 'M√©dio',
                    'hard': 'Dif√≠cil',
                    'extreme': 'Extremo'
                };
                return names[difficulty] || 'Desconhecido';
            },
            
            // Verificar se prazo est√° pr√≥ximo
            isDeadlineNear(deadlineString) {
                const deadline = new Date(deadlineString);
                const now = new Date();
                const diffTime = deadline - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays <= 3 && diffDays >= 0;
            },
            
            // Mostrar notifica√ß√£o
            showNotification(message) {
                // Criar elemento de notifica√ß√£o
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background-color: var(--card-bg);
                    color: var(--text-primary);
                    padding: 15px 25px;
                    border-radius: 8px;
                    border-left: 4px solid var(--accent-neon);
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                    z-index: 10000;
                    max-width: 300px;
                    animation: slideIn 0.3s, fadeOut 0.3s 2.7s;
                `;
                
                notification.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <i class="fas fa-info-circle" style="color: var(--accent-neon); margin-right: 10px;"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Remover ap√≥s 3 segundos
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
                
                // Adicionar estilos de anima√ß√£o
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            },
            
            // Fazer logout
            logout() {
                if (this.currentUser) {
                    // Marcar como offline
                    const user = this.allMembers.find(m => m.id === this.currentUser.id);
                    if (user) user.online = false;
                    
                    this.currentUser = null;
                    this.saveState();
                    
                    // Esconder aplica√ß√£o principal
                    document.getElementById('mainApp').style.display = 'none';
                    
                    // Mostrar modal de login
                    document.getElementById('loginModal').classList.add('active');
                    document.getElementById('loginForm').reset();
                    
                    // Resetar avatar de login
                    const avatarPreviewLogin = document.getElementById('avatarPreviewLogin');
                    if (avatarPreviewLogin) {
                        avatarPreviewLogin.style.backgroundImage = 'url(\'https://api.dicebear.com/7.x/identicon/svg?seed=AlgebraRenova\')';
                    }
                    
                    this.showNotification('Voc√™ saiu da plataforma.');
                }
            }
        };

        // ============================================
        // INICIALIZA√á√ÉO DA APLICA√á√ÉO
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar estado da aplica√ß√£o
            AppState.init();
            
            // ============================================
            // EVENT LISTENERS
            // ============================================
            
            // Login
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value.trim();
                const email = document.getElementById('userEmail').value.trim();
                const nucleusKey = document.getElementById('nucleusKey').value.trim();
                
                if (username && email) {
                    AppState.handleLogin(username, email, nucleusKey);
                }
            });
            
            // Navega√ß√£o por abas
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    AppState.switchTab(tabName);
                });
            });
            
            // Bot√µes de nova teoria
            document.getElementById('newTheoryBtn').addEventListener('click', openTheoryModal);
            document.getElementById('newTheoryBtn2').addEventListener('click', openTheoryModal);
            
            // Bot√µes de novo grupo
            document.getElementById('newGroupBtn').addEventListener('click', openGroupModal);
            
            // Bot√µes de novo desafio
            document.getElementById('newChallengeBtn').addEventListener('click', openChallengeModal);
            document.getElementById('newChallengeBtn2').addEventListener('click', openChallengeModal);
            
            // Bot√£o gerenciar solicita√ß√µes
            document.getElementById('manageRequestsBtn')?.addEventListener('click', function() {
                AppState.switchTab('members');
            });
            
            // Modal de teoria
            document.getElementById('closeTheoryModal').addEventListener('click', closeTheoryModal);
            document.getElementById('cancelTheoryBtn').addEventListener('click', closeTheoryModal);
            
            // Formul√°rio de teoria
            document.getElementById('theoryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const title = document.getElementById('theoryTitle').value.trim();
                const content = document.getElementById('theoryContent').value.trim();
                const category = document.getElementById('theoryCategory').value;
                
                if (title && content) {
                    AppState.saveTheory(title, content, category);
                    closeTheoryModal();
                    AppState.switchTab('theories');
                }
            });
            
            // Modal de grupo
            document.getElementById('closeGroupModal').addEventListener('click', closeGroupModal);
            document.getElementById('cancelGroupBtn').addEventListener('click', closeGroupModal);
            
            // Formul√°rio de grupo
            document.getElementById('groupForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('groupName').value.trim();
                const description = document.getElementById('groupDescription').value.trim();
                const tags = document.getElementById('groupTags').value.trim();
                const privacy = document.getElementById('groupPrivacy').value;
                
                if (name && description) {
                    AppState.createGroup(name, description, tags, privacy);
                    closeGroupModal();
                    AppState.switchTab('groups');
                }
            });
            
            // Modal de desafio
            document.getElementById('closeChallengeModal').addEventListener('click', closeChallengeModal);
            document.getElementById('cancelChallengeBtn').addEventListener('click', closeChallengeModal);
            
            // Formul√°rio de desafio
            document.getElementById('challengeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const title = document.getElementById('challengeTitle').value.trim();
                const description = document.getElementById('challengeDescription').value.trim();
                const difficulty = document.getElementById('challengeDifficulty').value;
                const deadline = document.getElementById('challengeDeadline').value;
                
                if (title && description) {
                    AppState.createChallenge(title, description, difficulty, deadline);
                    closeChallengeModal();
                    AppState.switchTab('challenges');
                }
            });
            
            // Modal de coment√°rio
            document.getElementById('closeCommentModal').addEventListener('click', closeCommentModal);
            document.getElementById('cancelCommentBtn').addEventListener('click', closeCommentModal);
            
            // Formul√°rio de coment√°rio
            document.getElementById('commentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const theoryId = document.getElementById('commentTheoryId').value;
                const content = document.getElementById('commentContent').value.trim();
                
                if (content) {
                    AppState.addComment(theoryId, content);
                    closeCommentModal();
                }
            });
            
            // Modal de solu√ß√£o
            document.getElementById('closeSolutionModal').addEventListener('click', closeSolutionModal);
            document.getElementById('cancelSolutionBtn').addEventListener('click', closeSolutionModal);
            
            // Formul√°rio de solu√ß√£o
            document.getElementById('solutionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const challengeId = document.getElementById('solutionChallengeId').value;
                const content = document.getElementById('solutionContent').value.trim();
                
                if (content) {
                    AppState.submitSolution(challengeId, content);
                    closeSolutionModal();
                }
            });
            
            // Modal de chat do grupo
            document.getElementById('closeGroupChatModal').addEventListener('click', closeGroupChatModal);
            document.getElementById('groupChatBackBtn').addEventListener('click', closeGroupChatModal);
            
            // Modal de solicita√ß√£o de amizade
            document.getElementById('closeFriendRequestModal').addEventListener('click', closeFriendRequestModal);
            document.getElementById('cancelFriendRequestBtn').addEventListener('click', closeFriendRequestModal);
            
            // Formul√°rio de solicita√ß√£o de amizade
            document.getElementById('friendRequestForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const memberId = document.getElementById('requestMemberId').value;
                const message = document.getElementById('requestMessage').value.trim();
                
                AppState.sendFriendRequest(memberId, message);
                closeFriendRequestModal();
            });
            
            // Pr√©-visualiza√ß√£o LaTeX
            document.getElementById('theoryContent').addEventListener('input', function() {
                const preview = document.getElementById('latexPreview');
                const content = this.value;
                
                // Extrair f√≥rmulas LaTeX
                const latexMatches = content.match(/\$\$.*?\$\$/g) || [];
                
                if (latexMatches.length > 0) {
                    let previewHTML = '';
                    latexMatches.forEach((formula, index) => {
                        previewHTML += `<div style="margin-bottom: 10px;">F√≥rmula ${index + 1}: ${formula}</div>`;
                    });
                    
                    preview.innerHTML = previewHTML;
                    
                    // Tentar renderizar o LaTeX
                    setTimeout(() => {
                        if (window.MathJax) {
                            window.MathJax.typeset([preview]);
                        }
                    }, 100);
                } else {
                    preview.innerHTML = '<div style="color: var(--text-secondary);">Nenhuma f√≥rmula LaTeX detectada. Use $$...$$ para f√≥rmulas.</div>';
                }
            });
            
            // Formul√°rio de perfil
            document.getElementById('profileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const codename = document.getElementById('codename').value.trim();
                const specialty = document.getElementById('specialty').value.trim();
                const bio = document.getElementById('bio').value.trim();
                
                if (codename && specialty) {
                    AppState.updateProfile(codename, specialty, bio);
                    AppState.switchTab('home');
                }
            });
            
            // Bot√£o de logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                AppState.logout();
            });
            
            // ============================================
            // FUN√á√ïES AUXILIARES DA INTERFACE
            // ============================================
            
            function openTheoryModal() {
                document.getElementById('theoryModal').classList.add('active');
                document.getElementById('theoryTitle').focus();
            }
            
            function closeTheoryModal() {
                document.getElementById('theoryModal').classList.remove('active');
                document.getElementById('theoryForm').reset();
                document.getElementById('latexPreview').innerHTML = '';
            }
            
            function openGroupModal() {
                document.getElementById('groupModal').classList.add('active');
                document.getElementById('groupName').focus();
            }
            
            function closeGroupModal() {
                document.getElementById('groupModal').classList.remove('active');
                document.getElementById('groupForm').reset();
            }
            
            function openChallengeModal() {
                document.getElementById('challengeModal').classList.add('active');
                document.getElementById('challengeTitle').focus();
            }
            
            function closeChallengeModal() {
                document.getElementById('challengeModal').classList.remove('active');
                document.getElementById('challengeForm').reset();
            }
            
            function openCommentModal() {
                document.getElementById('commentModal').classList.add('active');
                document.getElementById('commentContent').focus();
            }
            
            function closeCommentModal() {
                document.getElementById('commentModal').classList.remove('active');
                document.getElementById('commentForm').reset();
            }
            
            function openSolutionModal() {
                document.getElementById('solutionModal').classList.add('active');
                document.getElementById('solutionContent').focus();
            }
            
            function closeSolutionModal() {
                document.getElementById('solutionModal').classList.remove('active');
                document.getElementById('solutionForm').reset();
            }
            
            function closeGroupChatModal() {
                document.getElementById('groupChatModal').classList.remove('active');
            }
            
            function openFriendRequestModal() {
                document.getElementById('friendRequestModal').classList.add('active');
            }
            
            function closeFriendRequestModal() {
                document.getElementById('friendRequestModal').classList.remove('active');
                document.getElementById('friendRequestForm').reset();
            }
            
            // Fechar modais ao clicar fora
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        if (this.id === 'loginModal') return; // N√£o fechar modal de login
                        this.classList.remove('active');
                    }
                });
            });
            
            // Configurar MathJax
            if (window.MathJax) {
                window.MathJax = {
                    tex: {
                        inlineMath: [['$', '$'], ['\\(', '\\)']],
                        displayMath: [['$$', '$$'], ['\\[', '\\]']],
                        processEscapes: true
                    },
                    options: {
                        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                        ignoreHtmlClass: 'tex2jax_ignore',
                        processHtmlClass: 'tex2jax_process'
                    }
                };
            }
        });
    </script>
</body>
</html>
