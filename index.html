<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Renova - Rede Cient√≠fica</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- MathJax para LaTeX -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  
  <style>
    /* ===== RESET & BASE ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }

    :root {
      --bg-main: #0b0b10;
      --bg-panel: #111118;
      --bg-card: #1b1b2e;
      --bg-input: #0a0a15;
      --accent: #4a6fa5;
      --accent-hover: #5a80b5;
      --accent-secondary: #9b59b6;
      --text-main: #eaeaea;
      --text-soft: #a0a0a0;
      --border: #333;
      --border-light: #444;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --info: #3498db;
      --online: #2ecc71;
      --offline: #95a5a6;
    }

    body {
      background: var(--bg-main);
      color: var(--text-main);
      min-height: 100vh;
    }

    .hidden { display: none !important; }

    /* ===== NOTIFICA√á√ïES TOAST ===== */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      padding: 15px 20px;
      background: var(--bg-card);
      border-left: 4px solid var(--accent);
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease;
      max-width: 350px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .toast.success { border-left-color: var(--success); }
    .toast.error { border-left-color: var(--danger); }
    .toast.warning { border-left-color: var(--warning); }
    .toast.info { border-left-color: var(--info); }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* ===== LAYOUT CONTAINERS ===== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* ===== AUTH SCREEN ===== */
    .auth-container {
      width: 100%;
      max-width: 420px;
      padding: 40px;
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .auth-container h1 {
      text-align: center;
      margin-bottom: 30px;
      color: var(--accent);
      font-size: 32px;
      font-weight: 300;
    }

    .auth-input {
      width: 100%;
      padding: 14px;
      margin-bottom: 15px;
      background: var(--bg-input);
      color: var(--text-main);
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 15px;
      transition: all 0.3s;
    }

    .auth-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
    }

    .auth-button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 10px;
    }

    .auth-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .auth-button.secondary {
      background: var(--bg-card);
      color: var(--text-main);
    }

    .auth-button.secondary:hover {
      background: #26264a;
    }

    .auth-info {
      text-align: center;
      font-size: 12px;
      color: var(--text-soft);
      margin-top: 20px;
      line-height: 1.5;
    }

    /* ===== DASHBOARD LAYOUT ===== */
    #dashboard {
      min-height: 100vh;
      display: grid;
      grid-template-columns: 250px 1fr;
    }

    /* SIDEBAR */
    #sidebar {
      background: var(--bg-panel);
      border-right: 1px solid var(--border);
      padding: 20px;
      display: flex;
      flex-direction: column;
      position: sticky;
      top: 0;
      height: 100vh;
    }

    .sidebar-header {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-header h2 {
      color: var(--accent);
      font-size: 24px;
      font-weight: 300;
      margin-bottom: 5px;
    }

    .user-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-soft);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--online);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .sidebar-menu {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
    }

    .menu-item {
      padding: 14px 16px;
      color: var(--text-main);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 15px;
    }

    .menu-item:hover {
      background: var(--bg-card);
      transform: translateX(5px);
    }

    .menu-item.active {
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      box-shadow: 0 4px 12px rgba(74, 111, 165, 0.3);
    }

    .menu-item i {
      width: 20px;
      text-align: center;
      font-size: 18px;
    }

    .notification-badge {
      background: var(--danger);
      color: white;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 10px;
      margin-left: auto;
    }

    /* MAIN CONTENT */
    #mainContent {
      padding: 30px;
      overflow-y: auto;
      background: var(--bg-main);
    }

    .content-header {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .content-header h1 {
      font-size: 32px;
      margin-bottom: 10px;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 300;
    }

    .content-header p {
      color: var(--text-soft);
      font-size: 16px;
    }

    /* ===== DASHBOARD CARDS ===== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--bg-panel), var(--bg-card));
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 25px;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--accent-secondary));
    }

    .stat-card h3 {
      color: var(--text-soft);
      font-size: 14px;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 5px;
    }

    .stat-trend {
      font-size: 12px;
      color: var(--success);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* ===== MODULES STYLES ===== */
    .module-container {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      transition: all 0.3s;
    }

    .module-container:hover {
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .module-header {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .module-header h2 {
      color: var(--text-main);
      font-size: 24px;
      font-weight: 400;
    }

    .module-actions {
      display: flex;
      gap: 12px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .module-button {
      padding: 12px 24px;
      background: var(--bg-card);
      color: var(--text-main);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      font-weight: 500;
    }

    .module-button:hover {
      background: var(--accent);
      color: white;
      transform: translateY(-2px);
    }

    .module-button.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      border: none;
    }

    .module-button.danger {
      background: var(--danger);
      color: white;
      border: none;
    }

    /* ===== THEORIES MODULE ===== */
    .theories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .theory-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
    }

    .theory-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      border-color: var(--accent);
    }

    .theory-card h4 {
      color: var(--text-main);
      margin-bottom: 12px;
      font-size: 18px;
      font-weight: 500;
      line-height: 1.4;
    }

    .theory-meta {
      display: flex;
      gap: 15px;
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .theory-status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-draft { background: rgba(155, 89, 182, 0.2); color: var(--accent-secondary); }
    .status-pending { background: rgba(243, 156, 18, 0.2); color: var(--warning); }
    .status-approved { background: rgba(39, 174, 96, 0.2); color: var(--success); }
    .status-rejected { background: rgba(231, 76, 60, 0.2); color: var(--danger); }

    .theory-preview {
      color: var(--text-soft);
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 20px;
      flex: 1;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
    }

    .theory-actions {
      display: flex;
      gap: 10px;
      margin-top: auto;
    }

    /* ===== FORUM MODULE ===== */
    .forum-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    .forum-table th {
      text-align: left;
      padding: 16px;
      border-bottom: 2px solid var(--border);
      color: var(--text-soft);
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .forum-table td {
      padding: 18px 16px;
      border-bottom: 1px solid var(--border);
      transition: background 0.3s;
    }

    .forum-table tr:hover {
      background: var(--bg-card);
    }

    .forum-table tr:last-child td {
      border-bottom: none;
    }

    .topic-title {
      font-weight: 500;
      color: var(--text-main);
      margin-bottom: 5px;
    }

    .topic-excerpt {
      font-size: 13px;
      color: var(--text-soft);
      line-height: 1.4;
    }

    .pinned-topic {
      background: rgba(155, 89, 182, 0.1);
      border-left: 3px solid var(--accent-secondary);
    }

    /* ===== CHAT MODULE ===== */
    .chat-container {
      display: grid;
      grid-template-columns: 220px 1fr;
      gap: 20px;
      height: 600px;
    }

    .chat-channels {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .channel-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .channel-header h3 {
      color: var(--text-main);
      font-size: 18px;
      font-weight: 500;
    }

    .channels-list {
      flex: 1;
      overflow-y: auto;
    }

    .channel-item {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .channel-item:hover {
      background: var(--bg-panel);
    }

    .channel-item.active {
      background: linear-gradient(135deg, rgba(74, 111, 165, 0.2), rgba(155, 89, 182, 0.2));
      border-left: 3px solid var(--accent);
    }

    .channel-icon {
      font-size: 20px;
    }

    .channel-name {
      flex: 1;
      font-weight: 500;
    }

    .unread-count {
      background: var(--danger);
      color: white;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
      min-width: 20px;
      text-align: center;
    }

    .online-count {
      font-size: 12px;
      color: var(--online);
    }

    .chat-window {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .messages-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .message {
      max-width: 70%;
      padding: 15px;
      border-radius: 15px;
      position: relative;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.own {
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 5px;
    }

    .message.other {
      background: var(--bg-panel);
      align-self: flex-start;
      border-bottom-left-radius: 5px;
    }

    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .message-author {
      font-weight: 600;
      font-size: 14px;
    }

    .message-time {
      font-size: 12px;
      opacity: 0.8;
    }

    .message-content {
      font-size: 14px;
      line-height: 1.5;
      word-wrap: break-word;
    }

    .message-content .math {
      display: inline-block;
      margin: 2px 0;
    }

    .typing-indicator {
      font-size: 12px;
      color: var(--text-soft);
      padding: 10px 20px;
      font-style: italic;
    }

    .chat-input-container {
      padding: 20px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 12px;
      background: var(--bg-panel);
    }

    .chat-input {
      flex: 1;
      padding: 15px;
      background: var(--bg-input);
      color: var(--text-main);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      resize: none;
      min-height: 50px;
      max-height: 120px;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .latex-toolbar {
      display: flex;
      gap: 8px;
      padding: 10px;
      border-bottom: 1px solid var(--border);
      background: var(--bg-panel);
    }

    .latex-btn {
      padding: 6px 12px;
      background: var(--bg-card);
      color: var(--text-main);
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s;
    }

    .latex-btn:hover {
      background: var(--accent);
      color: white;
    }

    /* ===== CHAT PRIVADO ===== */
    .private-chat-container {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 20px;
      height: 600px;
    }

    .contacts-list {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .contact-item {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .contact-item:hover {
      background: var(--bg-panel);
    }

    .contact-item.active {
      background: linear-gradient(135deg, rgba(74, 111, 165, 0.2), rgba(155, 89, 182, 0.2));
      border-left: 3px solid var(--accent);
    }

    .contact-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
    }

    .contact-info {
      flex: 1;
    }

    .contact-name {
      font-weight: 500;
      color: var(--text-main);
    }

    .contact-status {
      font-size: 12px;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .status-online { background: var(--online); }
    .status-offline { background: var(--offline); }
    .status-away { background: var(--warning); }

    .last-message {
      font-size: 13px;
      color: var(--text-soft);
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      max-width: 180px;
    }

    .unread-badge {
      background: var(--danger);
      color: white;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
      min-width: 20px;
      text-align: center;
    }

    /* ===== UPLOAD DE ARQUIVOS ===== */
    .upload-container {
      border: 2px dashed var(--border);
      border-radius: 10px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 20px;
    }

    .upload-container:hover {
      border-color: var(--accent);
      background: rgba(74, 111, 165, 0.1);
    }

    .upload-icon {
      font-size: 48px;
      color: var(--accent);
      margin-bottom: 15px;
    }

    .file-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .file-item {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .file-icon {
      font-size: 24px;
      color: var(--accent);
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-weight: 500;
      color: var(--text-main);
      margin-bottom: 5px;
    }

    .file-meta {
      font-size: 12px;
      color: var(--text-soft);
      display: flex;
      gap: 15px;
    }

    .file-actions {
      display: flex;
      gap: 10px;
    }

    /* ===== FORMS AVAN√áADOS ===== */
    .form-group {
      margin-bottom: 25px;
    }

    .form-label {
      display: block;
      margin-bottom: 10px;
      color: var(--text-main);
      font-weight: 500;
      font-size: 15px;
    }

    .form-control {
      width: 100%;
      padding: 15px;
      background: var(--bg-input);
      color: var(--text-main);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
    }

    textarea.form-control {
      min-height: 150px;
      resize: vertical;
      line-height: 1.5;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    /* ===== TEMAS ===== */
    .theme-selector {
      display: flex;
      gap: 10px;
      padding: 10px;
      background: var(--bg-card);
      border-radius: 8px;
      margin-top: 20px;
    }

    .theme-option {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
    }

    .theme-option:hover {
      transform: scale(1.1);
    }

    .theme-option.active {
      border-color: var(--accent);
      transform: scale(1.1);
    }

    .theme-dark { background: #0b0b10; }
    .theme-blue { background: #1a237e; }
    .theme-green { background: #1b5e20; }
    .theme-purple { background: #4a148c; }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px) {
      #dashboard {
        grid-template-columns: 1fr;
      }
      
      #sidebar {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        width: 280px;
        height: 100vh;
        z-index: 1000;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      }
      
      #sidebar.active {
        display: flex;
      }
      
      .mobile-menu-toggle {
        display: block;
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1001;
        background: var(--accent);
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
      
      .chat-container,
      .private-chat-container {
        grid-template-columns: 1fr;
        height: 500px;
      }
      
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
      
      .theories-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .auth-container {
        position: relative;
        top: 0;
        left: 0;
        transform: none;
        margin: 20px auto;
        max-width: 90%;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .module-actions {
        flex-direction: column;
      }
      
      .module-button {
        width: 100%;
      }
    }

    /* ===== ANIMA√á√ïES ===== */
    .fade-in {
      animation: fadeIn 0.5s ease;
    }

    .slide-up {
      animation: slideUp 0.5s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* ===== SCROLLBAR PERSONALIZADA ===== */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-input);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent-secondary);
    }
  </style>
</head>

<body>
  <!-- ===== TOAST NOTIFICATIONS ===== -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- ===== MOBILE MENU TOGGLE ===== -->
  <div class="mobile-menu-toggle" id="mobileMenuToggle">‚ò∞</div>

  <!-- ===== AUTH SCREEN ===== -->
  <div id="authScreen" class="auth-container fade-in">
    <h1>Renova</h1>
    
    <div id="authError" class="alert alert-error hidden"></div>
    
    <input type="text" id="username" class="auth-input" placeholder="Usu√°rio" required>
    <input type="password" id="password" class="auth-input" placeholder="Senha" required>
    <input type="text" id="masterKey" class="auth-input" placeholder="MASTER_KEY (opcional)">
    
    <button onclick="login()" class="auth-button">Entrar</button>
    <button onclick="register()" class="auth-button secondary">Criar Conta</button>
    
    <div class="theme-selector">
      <div class="theme-option theme-dark active" onclick="setTheme('dark')"></div>
      <div class="theme-option theme-blue" onclick="setTheme('blue')"></div>
      <div class="theme-option theme-green" onclick="setTheme('green')"></div>
      <div class="theme-option theme-purple" onclick="setTheme('purple')"></div>
    </div>
    
    <div class="auth-info">
      Sistema Cient√≠fico ¬∑ LaTeX Support ¬∑ Tempo Real ¬∑ v2.0
    </div>
  </div>

  <!-- ===== DASHBOARD ===== -->
  <div id="dashboard" class="hidden">
    <!-- SIDEBAR -->
    <div id="sidebar">
      <div class="sidebar-header">
        <h2>Renova</h2>
        <div class="user-status">
          <span class="status-dot"></span>
          <span id="userRole">Online</span>
        </div>
      </div>
      
      <div class="sidebar-menu">
        <div class="menu-item active" onclick="loadSection('dashboard')">
          <i>üìä</i> Dashboard
        </div>
        <div class="menu-item" onclick="loadSection('theories')">
          <i>üìö</i> Teorias
          <span class="notification-badge" id="theoryBadge" style="display: none;">0</span>
        </div>
        <div class="menu-item" onclick="loadSection('forum')">
          <i>üí¨</i> F√≥rum
          <span class="notification-badge" id="forumBadge" style="display: none;">0</span>
        </div>
        <div class="menu-item" onclick="loadSection('chat')">
          <i>üí≠</i> Chat Geral
          <span class="notification-badge" id="chatBadge" style="display: none;">0</span>
        </div>
        <div class="menu-item" onclick="loadSection('private')">
          <i>üîí</i> Chat Privado
          <span class="notification-badge" id="privateBadge" style="display: none;">0</span>
        </div>
        <div class="menu-item" onclick="loadSection('groups')">
          <i>üë•</i> Grupos
        </div>
        <div class="menu-item" onclick="loadSection('files')">
          <i>üìÅ</i> Arquivos
        </div>
        <div class="menu-item" onclick="loadSection('profile')">
          <i>üë§</i> Perfil
        </div>
        <div id="adminMenuItem" class="menu-item hidden" onclick="loadSection('admin')">
          <i>‚öôÔ∏è</i> Administra√ß√£o
        </div>
      </div>
      
      <div class="user-info">
        <div id="currentUser" style="font-weight: 500; margin-bottom: 5px;"></div>
        <div id="userLevel" style="font-size: 12px; color: var(--text-soft);"></div>
        <button onclick="logout()" style="margin-top: 15px; width: 100%;" class="module-button danger">Sair</button>
      </div>
    </div>
    
    <!-- MAIN CONTENT -->
    <div id="mainContent">
      <!-- Content will be loaded here -->
    </div>
  </div>

  <script>
    // ============================================
    // 1. SISTEMA COMPLETO
    // ============================================
    const MASTER_KEY = "Renova, O Non Trad";
    const APP_VERSION = "2.0";
    
    // Estado global completo
    let appState = {
      currentUser: null,
      isNucleo: false,
      onlineUsers: new Set(),
      notifications: [],
      theme: 'dark',
      
      users: JSON.parse(localStorage.getItem('renova_users')) || {},
      theories: JSON.parse(localStorage.getItem('renova_theories')) || [],
      forumTopics: JSON.parse(localStorage.getItem('renova_forum')) || [],
      chatMessages: JSON.parse(localStorage.getItem('renova_chat')) || {},
      privateMessages: JSON.parse(localStorage.getItem('renova_private')) || {},
      groups: JSON.parse(localStorage.getItem('renova_groups')) || [],
      files: JSON.parse(localStorage.getItem('renova_files')) || [],
      contacts: JSON.parse(localStorage.getItem('renova_contacts')) || {},
      notifications: JSON.parse(localStorage.getItem('renova_notifications')) || [],
      
      unreadCounts: {
        theories: 0,
        forum: 0,
        chat: 0,
        private: 0
      }
    };
    
    // ============================================
    // 2. SISTEMA DE NOTIFICA√á√ïES
    // ============================================
    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <span>${message}</span>
      `;
      
      container.appendChild(toast);
      
      // Auto-remove ap√≥s 5 segundos
      setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
      }, 5000);
    }
    
    function addNotification(title, message, type = 'info', link = null) {
      const notification = {
        id: 'n' + Date.now(),
        title,
        message,
        type,
        link,
        timestamp: new Date().toISOString(),
        read: false
      };
      
      appState.notifications.unshift(notification);
      saveState();
      updateNotificationBadges();
      
      // Mostrar toast
      showToast(message, type);
    }
    
    function updateNotificationBadges() {
      const unread = appState.notifications.filter(n => !n.read).length;
      
      // Atualizar badges na sidebar
      ['theoryBadge', 'forumBadge', 'chatBadge', 'privateBadge'].forEach(id => {
        const badge = document.getElementById(id);
        if (badge) {
          badge.textContent = unread;
          badge.style.display = unread > 0 ? 'block' : 'none';
        }
      });
    }
    
    // ============================================
    // 3. PERSIST√äNCIA E BACKUP
    // ============================================
    function saveState() {
      localStorage.setItem('renova_users', JSON.stringify(appState.users));
      localStorage.setItem('renova_theories', JSON.stringify(appState.theories));
      localStorage.setItem('renova_forum', JSON.stringify(appState.forumTopics));
      localStorage.setItem('renova_chat', JSON.stringify(appState.chatMessages));
      localStorage.setItem('renova_private', JSON.stringify(appState.privateMessages));
      localStorage.setItem('renova_groups', JSON.stringify(appState.groups));
      localStorage.setItem('renova_files', JSON.stringify(appState.files));
      localStorage.setItem('renova_contacts', JSON.stringify(appState.contacts));
      localStorage.setItem('renova_notifications', JSON.stringify(appState.notifications));
      localStorage.setItem('renova_theme', appState.theme);
    }
    
    function exportData() {
      const data = {
        version: APP_VERSION,
        exportedAt: new Date().toISOString(),
        users: appState.users,
        theories: appState.theories,
        forumTopics: appState.forumTopics,
        chatMessages: appState.chatMessages,
        privateMessages: appState.privateMessages,
        groups: appState.groups,
        files: appState.files,
        contacts: appState.contacts
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `renova_backup_${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('Backup exportado com sucesso!', 'success');
    }
    
    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          // Validar dados
          if (data.version && data.users) {
            if (confirm('Importar dados? Isso substituir√° os dados atuais.')) {
              appState.users = data.users || {};
              appState.theories = data.theories || [];
              appState.forumTopics = data.forumTopics || [];
              appState.chatMessages = data.chatMessages || {};
              appState.privateMessages = data.privateMessages || {};
              appState.groups = data.groups || [];
              appState.files = data.files || [];
              appState.contacts = data.contacts || {};
              
              saveState();
              showToast('Dados importados com sucesso!', 'success');
              
              if (appState.currentUser) {
                loadSection('dashboard');
              }
            }
          } else {
            showToast('Arquivo de backup inv√°lido!', 'error');
          }
        } catch (err) {
          showToast('Erro ao importar dados!', 'error');
        }
      };
      reader.readAsText(file);
    }
    
    // ============================================
    // 4. SISTEMA DE AUTENTICA√á√ÉO
    // ============================================
    function checkAuth() {
      const storedUser = localStorage.getItem('renova_currentUser');
      if (storedUser && appState.users[storedUser]) {
        appState.currentUser = storedUser;
        appState.isNucleo = appState.users[storedUser].nucleo || false;
        appState.theme = localStorage.getItem('renova_theme') || 'dark';
        setTheme(appState.theme);
        
        // Marcar como online
        if (!appState.onlineUsers.has(storedUser)) {
          appState.onlineUsers.add(storedUser);
          broadcastOnlineStatus();
        }
        
        showDashboard();
      }
    }
    
    function login() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const masterKey = document.getElementById('masterKey').value;
      
      if (!username || !password) {
        showToast('Preencha usu√°rio e senha!', 'error');
        return;
      }
      
      const user = appState.users[username];
      
      if (!user) {
        showToast('Usu√°rio n√£o encontrado!', 'error');
        return;
      }
      
      if (user.password !== password) {
        showToast('Senha incorreta!', 'error');
        return;
      }
      
      // Verificar se √© n√∫cleo
      const isNucleo = masterKey === MASTER_KEY;
      if (isNucleo) {
        user.nucleo = true;
        saveState();
        showToast('Acesso N√∫cleo concedido!', 'success');
      }
      
      appState.currentUser = username;
      appState.isNucleo = user.nucleo || false;
      
      // Marcar como online
      appState.onlineUsers.add(username);
      
      localStorage.setItem('renova_currentUser', username);
      
      // Notifica√ß√£o de login
      addNotification(
        'Login realizado',
        `Bem-vindo(a) de volta, ${username}!`,
        'success'
      );
      
      showDashboard();
    }
    
    function register() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const masterKey = document.getElementById('masterKey').value;
      
      if (!username || !password) {
        showToast('Preencha usu√°rio e senha!', 'error');
        return;
      }
      
      if (appState.users[username]) {
        showToast('Usu√°rio j√° existe!', 'error');
        return;
      }
      
      const isNucleo = masterKey === MASTER_KEY;
      
      appState.users[username] = {
        password: password,
        nucleo: isNucleo,
        createdAt: new Date().toISOString(),
        lastSeen: new Date().toISOString(),
        profile: {
          bio: '',
          area: '',
          links: '',
          avatar: generateAvatar(username)
        },
        stats: {
          theories: 0,
          forumPosts: 0,
          chatMessages: 0,
          files: 0,
          groups: 0
        },
        settings: {
          theme: 'dark',
          notifications: true,
          privacy: 'public'
        }
      };
      
      // Adicionar como contato de si mesmo
      appState.contacts[username] = appState.contacts[username] || [];
      
      saveState();
      
      if (isNucleo) {
        showToast('Conta N√∫cleo criada com sucesso!', 'success');
      } else {
        showToast('Conta criada com sucesso! Fa√ßa login.', 'success');
      }
    }
    
    function generateAvatar(username) {
      // Gera uma cor baseada no nome de usu√°rio
      const colors = ['#4a6fa5', '#9b59b6', '#e74c3c', '#27ae60', '#f39c12', '#3498db'];
      const colorIndex = username.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0) % colors.length;
      return {
        color: colors[colorIndex],
        initials: username.substring(0, 2).toUpperCase()
      };
    }
    
    function logout() {
      // Marcar como offline
      if (appState.currentUser) {
        appState.onlineUsers.delete(appState.currentUser);
        broadcastOnlineStatus();
        
        appState.users[appState.currentUser].lastSeen = new Date().toISOString();
        saveState();
      }
      
      appState.currentUser = null;
      appState.isNucleo = false;
      localStorage.removeItem('renova_currentUser');
      
      showAuthScreen();
      showToast('Logout realizado com sucesso!', 'info');
    }
    
    // ============================================
    // 5. TEMAS
    // ============================================
    function setTheme(themeName) {
      appState.theme = themeName;
      localStorage.setItem('renova_theme', themeName);
      
      const themes = {
        dark: {
          '--bg-main': '#0b0b10',
          '--bg-panel': '#111118',
          '--bg-card': '#1b1b2e',
          '--bg-input': '#0a0a15'
        },
        blue: {
          '--bg-main': '#0d1b2a',
          '--bg-panel': '#1b263b',
          '--bg-card': '#415a77',
          '--bg-input': '#0a1422'
        },
        green: {
          '--bg-main': '#0d1f12',
          '--bg-panel': '#1a2c1d',
          '--bg-card': '#2d4d31',
          '--bg-input': '#0a180d'
        },
        purple: {
          '--bg-main': '#1a0d2a',
          '--bg-panel': '#2a1b3b',
          '--bg-card': '#4a2d77',
          '--bg-input': '#140a22'
        }
      };
      
      const theme = themes[themeName] || themes.dark;
      Object.entries(theme).forEach(([property, value]) => {
        document.documentElement.style.setProperty(property, value);
      });
      
      // Atualizar tema ativo
      document.querySelectorAll('.theme-option').forEach(opt => {
        opt.classList.remove('active');
      });
      document.querySelector(`.theme-${themeName}`)?.classList.add('active');
    }
    
    // ============================================
    // 6. SISTEMA DE NAVEGA√á√ÉO
    // ============================================
    function loadSection(section) {
      const menuItems = document.querySelectorAll('.menu-item');
      menuItems.forEach(item => item.classList.remove('active'));
      
      // Ativar item do menu
      event?.target.closest('.menu-item')?.classList.add('active');
      
      // Fechar menu mobile se aberto
      document.getElementById('sidebar').classList.remove('active');
      
      switch(section) {
        case 'dashboard':
          renderDashboard();
          break;
        case 'theories':
          renderTheories();
          break;
        case 'forum':
          renderForum();
          break;
        case 'chat':
          renderChat();
          break;
        case 'private':
          renderPrivateChat();
          break;
        case 'groups':
          renderGroups();
          break;
        case 'files':
          renderFiles();
          break;
        case 'profile':
          renderProfile();
          break;
        case 'admin':
          renderAdmin();
          break;
      }
    }
    
    // ============================================
    // 7. DASHBOARD PRINCIPAL
    // ============================================
    function renderDashboard() {
      const user = appState.users[appState.currentUser];
      const userTheories = appState.theories.filter(t => t.author === appState.currentUser);
      const approvedTheories = userTheories.filter(t => t.status === 'approved');
      const pendingTheories = appState.theories.filter(t => t.status === 'pending');
      const userGroups = appState.groups.filter(g => g.members.includes(appState.currentUser));
      const forumPosts = appState.forumTopics.filter(t => t.author === appState.currentUser);
      const unreadNotifications = appState.notifications.filter(n => !n.read).length;
      
      // Atualizar estat√≠sticas em tempo real
      const onlineCount = appState.onlineUsers.size;
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <h1>Dashboard</h1>
          <p>Bem-vindo(a) ao Renova, ${appState.currentUser}!</p>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Minhas Teorias</h3>
            <div class="stat-value">${userTheories.length}</div>
            <div class="stat-trend">
              <span>${approvedTheories.length} aprovadas</span>
            </div>
          </div>
          
          <div class="stat-card">
            <h3>Online Agora</h3>
            <div class="stat-value">${onlineCount}</div>
            <div class="stat-trend">
              <span>usu√°rios ativos</span>
            </div>
          </div>
          
          <div class="stat-card">
            <h3>Notifica√ß√µes</h3>
            <div class="stat-value">${unreadNotifications}</div>
            <div class="stat-trend">
              <span>n√£o lidas</span>
            </div>
          </div>
          
          <div class="stat-card">
            <h3>Meus Grupos</h3>
            <div class="stat-value">${userGroups.length}</div>
            <div class="stat-trend">
              <span>participa√ß√µes</span>
            </div>
          </div>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>A√ß√µes R√°pidas</h2>
          </div>
          
          <div class="module-actions">
            <button class="module-button primary" onclick="loadSection('theories')">
              <i>üìù</i> Nova Teoria
            </button>
            <button class="module-button" onclick="loadSection('forum')">
              <i>üí¨</i> Criar T√≥pico
            </button>
            <button class="module-button" onclick="loadSection('private')">
              <i>üîí</i> Mensagem Privada
            </button>
            <button class="module-button" onclick="loadSection('files')">
              <i>üìÅ</i> Upload de Arquivo
            </button>
          </div>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Teorias Pendentes de Aprova√ß√£o</h2>
          </div>
          
          <div class="theories-grid">
            ${renderPendingTheoriesDashboard()}
          </div>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Atividade Recente</h2>
          </div>
          
          <div id="recentActivity">
            ${renderRecentActivity()}
          </div>
        </div>
      `;
      
      // Atualizar UI do usu√°rio
      document.getElementById('currentUser').textContent = appState.currentUser;
      document.getElementById('userLevel').textContent = appState.isNucleo ? 'N√≠vel: N√∫cleo' : 'N√≠vel: Usu√°rio';
      document.getElementById('userRole').textContent = 'Online';
      
      // Mostrar/ocultar menu admin
      const adminItem = document.getElementById('adminMenuItem');
      adminItem.classList.toggle('hidden', !appState.isNucleo);
      
      // Atualizar MathJax
      setTimeout(() => {
        if (window.MathJax) {
          MathJax.typesetPromise();
        }
      }, 100);
    }
    
    function renderPendingTheoriesDashboard() {
      const pending = appState.theories.filter(t => t.status === 'pending').slice(0, 3);
      
      if (pending.length === 0) {
        return '<p style="text-align: center; color: var(--text-soft); padding: 30px;">Nenhuma teoria pendente.</p>';
      }
      
      return pending.map(theory => `
        <div class="theory-card">
          <h4>${theory.title}</h4>
          <div class="theory-meta">
            <span>Por: ${theory.author}</span>
            <span class="theory-status status-pending">Pendente</span>
          </div>
          <div class="theory-preview">${theory.content.substring(0, 100)}...</div>
          <div class="theory-actions">
            <button class="module-button" onclick="viewTheory('${theory.id}')">Ver</button>
            ${appState.isNucleo ? `
              <button class="module-button primary" onclick="approveTheory('${theory.id}')">Aprovar</button>
            ` : ''}
          </div>
        </div>
      `).join('');
    }
    
    function renderRecentActivity() {
      const activities = [];
      
      // Teorias recentes
      appState.theories.slice(-5).reverse().forEach(theory => {
        activities.push({
          type: 'theory',
          user: theory.author,
          title: theory.title,
          time: theory.createdAt,
          status: theory.status
        });
      });
      
      // T√≥picos recentes do f√≥rum
      appState.forumTopics.slice(-5).reverse().forEach(topic => {
        activities.push({
          type: 'forum',
          user: topic.author,
          title: topic.title,
          time: topic.createdAt
        });
      });
      
      // Ordenar por tempo
      activities.sort((a, b) => new Date(b.time) - new Date(a.time));
      
      if (activities.length === 0) {
        return '<p style="text-align: center; color: var(--text-soft); padding: 20px;">Nenhuma atividade recente.</p>';
      }
      
      return activities.slice(0, 10).map(act => `
        <div style="padding: 15px; border-bottom: 1px solid var(--border);">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
            <span style="background: ${act.type === 'theory' ? 'var(--accent)' : 'var(--accent-secondary)'}; 
                  color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">
              ${act.type === 'theory' ? 'üìö' : 'üí¨'}
            </span>
            <span style="font-weight: 500;">${act.user}</span>
          </div>
          <div style="font-size: 14px; color: var(--text-main); margin-bottom: 5px;">
            ${act.title}
          </div>
          <div style="font-size: 12px; color: var(--text-soft);">
            ${new Date(act.time).toLocaleString()}
            ${act.status ? ` ¬∑ ${act.status}` : ''}
          </div>
        </div>
      `).join('');
    }
    
    // ============================================
    // 8. SISTEMA DE TEORIAS AVAN√áADO
    // ============================================
    function renderTheories() {
      const userTheories = appState.theories.filter(t => t.author === appState.currentUser);
      const pendingTheories = appState.theories.filter(t => t.status === 'pending');
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <h1>Teorias Cient√≠ficas</h1>
          <p>Cria√ß√£o, edi√ß√£o e aprova√ß√£o de teorias</p>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Nova Teoria</h2>
          </div>
          
          <div class="form-group">
            <label class="form-label">T√≠tulo</label>
            <input type="text" id="theoryTitle" class="form-control" placeholder="T√≠tulo da teoria">
          </div>
          
          <div class="form-group">
            <label class="form-label">Resumo</label>
            <textarea id="theoryAbstract" class="form-control" 
                      placeholder="Breve resumo da teoria..." rows="2"></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Conte√∫do (LaTeX suportado)</label>
            <div class="latex-toolbar">
              <button class="latex-btn" onclick="insertLatex('equation')">$$ Equa√ß√£o $$</button>
              <button class="latex-btn" onclick="insertLatex('fraction')">\\frac{}{}</button>
              <button class="latex-btn" onclick="insertLatex('sqrt')">\\sqrt{}</button>
              <button class="latex-btn" onclick="insertLatex('sum')">\\sum_{}^{}</button>
              <button class="latex-btn" onclick="insertLatex('integral')">\\int_{}^{}</button>
            </div>
            <textarea id="theoryContent" class="form-control" 
                      placeholder="Descreva sua teoria aqui... Use LaTeX para f√≥rmulas matem√°ticas." 
                      rows="8"></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Tags (separadas por v√≠rgula)</label>
            <input type="text" id="theoryTags" class="form-control" placeholder="matem√°tica, f√≠sica, teoria">
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Visibilidade</label>
              <select id="theoryVisibility" class="form-control">
                <option value="public">P√∫blica</option>
                <option value="private">Privada</option>
                <option value="group">Grupo</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Status Inicial</label>
              <select id="theoryStatus" class="form-control">
                <option value="draft">Rascunho</option>
                <option value="pending">Enviar para Aprova√ß√£o</option>
              </select>
            </div>
          </div>
          
          <div class="module-actions">
            <button class="module-button" onclick="saveTheoryDraft()">
              <i>üíæ</i> Salvar Rascunho
            </button>
            <button class="module-button primary" onclick="createTheory()">
              <i>üì§</i> Publicar Teoria
            </button>
          </div>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Minhas Teorias (${userTheories.length})</h2>
          </div>
          
          <div class="theories-grid">
            ${renderUserTheories()}
          </div>
        </div>
        
        ${appState.isNucleo ? `
        <div class="module-container">
          <div class="module-header">
            <h2>Aprova√ß√µes Pendentes (${pendingTheories.length})</h2>
          </div>
          
          <div class="theories-grid">
            ${renderPendingApprovals()}
          </div>
        </div>
        ` : ''}
      `;
    }
    
    function insertLatex(type) {
      const textarea = document.getElementById('theoryContent');
      const cursorPos = textarea.selectionStart;
      const text = textarea.value;
      
      const latexSnippets = {
        equation: '$$\\displaystyle{}$$',
        fraction: '\\frac{numerator}{denominator}',
        sqrt: '\\sqrt{}',
        sum: '\\sum_{n=1}^{\\infty}',
        integral: '\\int_{a}^{b}',
        matrix: '\\begin{bmatrix}\n  a & b \\\\\n  c & d\n\\end{bmatrix}'
      };
      
      const snippet = latexSnippets[type] || '$$\\displaystyle{}$$';
      const newText = text.substring(0, cursorPos) + snippet + text.substring(cursorPos);
      textarea.value = newText;
      textarea.focus();
      textarea.setSelectionRange(cursorPos + snippet.length - 2, cursorPos + snippet.length - 2);
    }
    
    function createTheory() {
      const title = document.getElementById('theoryTitle').value.trim();
      const abstract = document.getElementById('theoryAbstract').value.trim();
      const content = document.getElementById('theoryContent').value.trim();
      const tags = document.getElementById('theoryTags').value.trim();
      const visibility = document.getElementById('theoryVisibility').value;
      const status = document.getElementById('theoryStatus').value;
      
      if (!title || !content) {
        showToast('Preencha t√≠tulo e conte√∫do!', 'error');
        return;
      }
      
      const theory = {
        id: 't' + Date.now(),
        title,
        abstract,
        content,
        tags: tags ? tags.split(',').map(t => t.trim()) : [],
        author: appState.currentUser,
        status: status,
        visibility,
        version: 1,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
        history: [{
          content,
          version: 1,
          timestamp: new Date().toISOString()
        }]
      };
      
      appState.theories.push(theory);
      
      // Atualizar estat√≠sticas do usu√°rio
      if (appState.users[appState.currentUser]) {
        appState.users[appState.currentUser].stats.theories++;
      }
      
      saveState();
      
      // Notifica√ß√£o para o N√∫cleo se for para aprova√ß√£o
      if (status === 'pending') {
        Object.keys(appState.users).forEach(username => {
          if (appState.users[username].nucleo) {
            addNotification(
              'Nova teoria para aprova√ß√£o',
              `${appState.currentUser} publicou: "${title}"`,
              'info',
              'theories'
            );
          }
        });
      }
      
      showToast('Teoria publicada com sucesso!', 'success');
      loadSection('theories');
    }
    
    function renderUserTheories() {
      const userTheories = appState.theories.filter(t => t.author === appState.currentUser);
      
      if (userTheories.length === 0) {
        return `
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
            <div style="font-size: 48px; color: var(--text-soft); margin-bottom: 20px;">üìö</div>
            <p style="color: var(--text-soft);">Voc√™ ainda n√£o criou nenhuma teoria.</p>
          </div>
        `;
      }
      
      return userTheories.reverse().map(theory => `
        <div class="theory-card">
          <h4>${theory.title}</h4>
          <div class="theory-meta">
            <span>v${theory.version}</span>
            <span>${new Date(theory.createdAt).toLocaleDateString()}</span>
            <span class="theory-status status-${theory.status}">${theory.status}</span>
          </div>
          <div class="theory-preview">${theory.abstract || theory.content.substring(0, 150)}...</div>
          <div class="theory-actions">
            <button class="module-button" onclick="viewTheory('${theory.id}')">Ver</button>
            <button class="module-button" onclick="editTheory('${theory.id}')">Editar</button>
            ${theory.status === 'pending' ? `
              <button class="module-button" onclick="cancelApproval('${theory.id}')">Cancelar</button>
            ` : ''}
          </div>
        </div>
      `).join('');
    }
    
    function renderPendingApprovals() {
      const pending = appState.theories.filter(t => t.status === 'pending');
      
      if (pending.length === 0) {
        return `
          <div style="grid-column: 1 / -1; text-align: center; padding: 30px;">
            <p style="color: var(--text-soft);">Nenhuma teoria pendente de aprova√ß√£o.</p>
          </div>
        `;
      }
      
      return pending.map(theory => `
        <div class="theory-card">
          <h4>${theory.title}</h4>
          <div class="theory-meta">
            <span>Por: ${theory.author}</span>
            <span>${new Date(theory.createdAt).toLocaleDateString()}</span>
            <span class="theory-status status-pending">Pendente</span>
          </div>
          <div class="theory-preview">${theory.abstract || theory.content.substring(0, 150)}...</div>
          <div class="theory-actions">
            <button class="module-button" onclick="viewTheory('${theory.id}')">Ver</button>
            <button class="module-button primary" onclick="approveTheory('${theory.id}')">Aprovar</button>
            <button class="module-button danger" onclick="rejectTheory('${theory.id}')">Rejeitar</button>
          </div>
        </div>
      `).join('');
    }
    
    function approveTheory(id) {
      const theory = appState.theories.find(t => t.id === id);
      if (theory) {
        theory.status = 'approved';
        theory.updatedAt = new Date().toISOString();
        saveState();
        
        // Notificar o autor
        addNotification(
          'Teoria aprovada!',
          `Sua teoria "${theory.title}" foi aprovada pelo N√∫cleo.`,
          'success',
          'theories'
        );
        
        showToast('Teoria aprovada com sucesso!', 'success');
        loadSection('theories');
      }
    }
    
    function rejectTheory(id) {
      const theory = appState.theories.find(t => t.id === id);
      if (theory) {
        theory.status = 'rejected';
        theory.updatedAt = new Date().toISOString();
        saveState();
        
        // Notificar o autor
        addNotification(
          'Teoria rejeitada',
          `Sua teoria "${theory.title}" foi rejeitada pelo N√∫cleo.`,
          'warning',
          'theories'
        );
        
        showToast('Teoria rejeitada.', 'warning');
        loadSection('theories');
      }
    }
    
    function viewTheory(id) {
      const theory = appState.theories.find(t => t.id === id);
      if (!theory) return;
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <h1>${theory.title}</h1>
          <p>Teoria cient√≠fica</p>
        </div>
        
        <div class="module-container">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
              <span class="theory-status status-${theory.status}">${theory.status}</span>
              <span style="margin-left: 15px; color: var(--text-soft);">
                Por: ${theory.author} ‚Ä¢ ${new Date(theory.createdAt).toLocaleString()}
              </span>
            </div>
            <div>
              <button class="module-button" onclick="loadSection('theories')">Voltar</button>
            </div>
          </div>
          
          ${theory.abstract ? `
          <div style="background: rgba(74, 111, 165, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 25px;">
            <h3 style="margin-bottom: 10px; color: var(--accent);">Resumo</h3>
            <p style="line-height: 1.6;">${theory.abstract}</p>
          </div>
          ` : ''}
          
          <div style="line-height: 1.8; font-size: 16px;">
            ${theory.content}
          </div>
          
          ${theory.tags.length > 0 ? `
          <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border);">
            <h3 style="margin-bottom: 10px; color: var(--accent);">Tags</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
              ${theory.tags.map(tag => `
                <span style="background: var(--bg-card); padding: 6px 12px; border-radius: 20px; font-size: 14px;">
                  ${tag}
                </span>
              `).join('')}
            </div>
          </div>
          ` : ''}
          
          <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border);">
            <h3 style="margin-bottom: 15px; color: var(--accent);">Hist√≥rico de Vers√µes</h3>
            <div style="display: flex; flex-direction: column; gap: 10px;">
              ${theory.history.map(version => `
                <div style="background: var(--bg-card); padding: 12px; border-radius: 6px; font-size: 14px;">
                  <div style="display: flex; justify-content: space-between;">
                    <span>Vers√£o ${version.version}</span>
                    <span style="color: var(--text-soft);">
                      ${new Date(version.timestamp).toLocaleString()}
                    </span>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
      
      // Atualizar MathJax para renderizar LaTeX
      setTimeout(() => {
        if (window.MathJax) {
          MathJax.typesetPromise();
        }
      }, 100);
    }
    
    // ============================================
    // 9. SISTEMA DE F√ìRUM AVAN√áADO
    // ============================================
    function renderForum() {
      const content = document.getElementById('mainContent');
      const pinnedTopics = appState.forumTopics.filter(t => t.pinned);
      const regularTopics = appState.forumTopics.filter(t => !t.pinned);
      
      content.innerHTML = `
        <div class="content-header">
          <h1>F√≥rum Cient√≠fico</h1>
          <p>Discuss√µes e debates organizados</p>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Novo T√≥pico</h2>
          </div>
          
          <div class="form-group">
            <label class="form-label">T√≠tulo</label>
            <input type="text" id="topicTitle" class="form-control" placeholder="T√≠tulo do t√≥pico">
          </div>
          
          <div class="form-group">
            <label class="form-label">Categoria</label>
            <select id="topicCategory" class="form-control">
              <option value="matematica">Matem√°tica</option>
              <option value="fisica">F√≠sica</option>
              <option value="computacao">Computa√ß√£o</option>
              <option value="debate">Debate</option>
              <option value="duvida">D√∫vida</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Conte√∫do (LaTeX suportado)</label>
            <textarea id="topicContent" class="form-control" 
                      placeholder="Descreva seu t√≥pico..." rows="6"></textarea>
          </div>
          
          <div class="module-actions">
            <button class="module-button" onclick="saveTopicDraft()">
              <i>üíæ</i> Salvar Rascunho
            </button>
            <button class="module-button primary" onclick="createTopic()">
              <i>üì§</i> Publicar T√≥pico
            </button>
          </div>
        </div>
        
        ${pinnedTopics.length > 0 ? `
        <div class="module-container">
          <div class="module-header">
            <h2>T√≥picos Fixados</h2>
          </div>
          
          <table class="forum-table">
            <tbody>
              ${renderForumTopicsList(pinnedTopics)}
            </tbody>
          </table>
        </div>
        ` : ''}
        
        <div class="module-container">
          <div class="module-header">
            <h2>Todos os T√≥picos (${appState.forumTopics.length})</h2>
          </div>
          
          <table class="forum-table">
            <tbody>
              ${renderForumTopicsList(regularTopics)}
            </tbody>
          </table>
        </div>
      `;
    }
    
    function renderForumTopicsList(topics) {
      if (topics.length === 0) {
        return `
          <tr>
            <td colspan="4" style="text-align: center; padding: 40px; color: var(--text-soft);">
              Nenhum t√≥pico ainda. Seja o primeiro a criar um!
            </td>
          </tr>
        `;
      }
      
      return topics.slice().reverse().map(topic => {
        const replyCount = topic.replies ? topic.replies.length : 0;
        const lastReply = topic.replies && topic.replies.length > 0 
          ? topic.replies[topic.replies.length - 1]
          : null;
        
        return `
          <tr class="${topic.pinned ? 'pinned-topic' : ''}" onclick="viewTopic('${topic.id}')" 
              style="cursor: pointer;">
            <td style="width: 60%;">
              <div class="topic-title">
                ${topic.pinned ? 'üìå ' : ''}${topic.title}
              </div>
              <div class="topic-excerpt">
                ${topic.content.substring(0, 100)}...
              </div>
            </td>
            <td style="width: 15%;">
              <div style="font-weight: 500;">${topic.author}</div>
              <div style="font-size: 12px; color: var(--text-soft);">
                ${new Date(topic.createdAt).toLocaleDateString()}
              </div>
            </td>
            <td style="width: 15%;">
              <div>${replyCount} respostas</div>
              ${lastReply ? `
              <div style="font-size: 12px; color: var(--text-soft);">
                √öltima: ${new Date(lastReply.createdAt).toLocaleDateString()}
              </div>
              ` : ''}
            </td>
            <td style="width: 10%; color: var(--accent);">
              ${topic.category || 'Geral'}
            </td>
          </tr>
        `;
      }).join('');
    }
    
    function createTopic() {
      const title = document.getElementById('topicTitle').value.trim();
      const category = document.getElementById('topicCategory').value;
      const content = document.getElementById('topicContent').value.trim();
      
      if (!title || !content) {
        showToast('Preencha t√≠tulo e conte√∫do!', 'error');
        return;
      }
      
      const topic = {
        id: 'f' + Date.now(),
        title,
        content,
        category,
        author: appState.currentUser,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
        replies: [],
        views: 0,
        pinned: false,
        locked: false
      };
      
      appState.forumTopics.push(topic);
      
      // Atualizar estat√≠sticas
      if (appState.users[appState.currentUser]) {
        appState.users[appState.currentUser].stats.forumPosts++;
      }
      
      saveState();
      
      // Notificar usu√°rios interessados
      Object.keys(appState.users).forEach(username => {
        if (username !== appState.currentUser && appState.users[username].settings.notifications) {
          addNotification(
            'Novo t√≥pico no f√≥rum',
            `${appState.currentUser} criou: "${title}"`,
            'info',
            'forum'
          );
        }
      });
      
      showToast('T√≥pico criado com sucesso!', 'success');
      viewTopic(topic.id);
    }
    
    function viewTopic(id) {
      const topic = appState.forumTopics.find(t => t.id === id);
      if (!topic) return;
      
      // Incrementar views
      topic.views = (topic.views || 0) + 1;
      saveState();
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <h1>${topic.title}</h1>
              <p>${topic.category || 'Geral'} ‚Ä¢ ${topic.views || 0} visualiza√ß√µes</p>
            </div>
            <div>
              <button class="module-button" onclick="loadSection('forum')">Voltar</button>
            </div>
          </div>
        </div>
        
        <div class="module-container">
          <div style="padding: 25px; border-bottom: 1px solid var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
              <div>
                <div style="font-weight: 500; font-size: 18px; margin-bottom: 5px;">${topic.author}</div>
                <div style="color: var(--text-soft); font-size: 14px;">
                  ${new Date(topic.createdAt).toLocaleString()}
                </div>
              </div>
              ${appState.isNucleo ? `
              <div style="display: flex; gap: 10px;">
                <button class="module-button" onclick="togglePin('${topic.id}')">
                  ${topic.pinned ? 'Desafixar' : 'Fixar'}
                </button>
                <button class="module-button" onclick="toggleLock('${topic.id}')">
                  ${topic.locked ? 'Destrancar' : 'Trancar'}
                </button>
              </div>
              ` : ''}
            </div>
            
            <div style="line-height: 1.8; font-size: 16px; margin-bottom: 20px;">
              ${topic.content}
            </div>
            
            <div style="display: flex; gap: 15px; font-size: 14px; color: var(--text-soft);">
              <span>üëç ${topic.likes || 0}</span>
              <span>üí¨ ${topic.replies ? topic.replies.length : 0}</span>
              <span>üëÅÔ∏è ${topic.views || 0}</span>
            </div>
          </div>
          
          <div style="padding: 25px;">
            <h3 style="margin-bottom: 20px; color: var(--accent);">
              Respostas (${topic.replies ? topic.replies.length : 0})
            </h3>
            
            <div id="topicReplies">
              ${renderTopicReplies(topic)}
            </div>
            
            ${!topic.locked ? `
            <div style="margin-top: 30px;">
              <h4 style="margin-bottom: 15px;">Responder</h4>
              <textarea id="replyContent" class="form-control" 
                        placeholder="Escreva sua resposta..." rows="4"></textarea>
              <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="module-button" onclick="loadSection('forum')">Cancelar</button>
                <button class="module-button primary" onclick="addReply('${topic.id}')">Enviar</button>
              </div>
            </div>
            ` : `
            <div style="text-align: center; padding: 30px; color: var(--text-soft);">
              <div style="font-size: 48px; margin-bottom: 15px;">üîí</div>
              <p>Este t√≥pico est√° trancado.</p>
            </div>
            `}
          </div>
        </div>
      `;
      
      // Atualizar MathJax
      setTimeout(() => {
        if (window.MathJax) {
          MathJax.typesetPromise();
        }
      }, 100);
    }
    
    function renderTopicReplies(topic) {
      if (!topic.replies || topic.replies.length === 0) {
        return `
          <div style="text-align: center; padding: 40px; color: var(--text-soft);">
            <p>Nenhuma resposta ainda. Seja o primeiro a responder!</p>
          </div>
        `;
      }
      
      return topic.replies.map(reply => `
        <div style="padding: 20px; border-bottom: 1px solid var(--border);">
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
            <div>
              <div style="font-weight: 500; font-size: 16px;">${reply.author}</div>
              <div style="color: var(--text-soft); font-size: 14px;">
                ${new Date(reply.createdAt).toLocaleString()}
              </div>
            </div>
          </div>
          
          <div style="line-height: 1.6; font-size: 15px;">
            ${reply.content}
          </div>
          
          <div style="display: flex; gap: 15px; margin-top: 15px; font-size: 14px; color: var(--text-soft);">
            <span style="cursor: pointer;" onclick="likeReply('${topic.id}', '${reply.id}')">
              üëç ${reply.likes || 0}
            </span>
          </div>
        </div>
      `).join('');
    }
    
    function addReply(topicId) {
      const content = document.getElementById('replyContent').value.trim();
      if (!content) {
        showToast('Digite uma resposta!', 'error');
        return;
      }
      
      const topic = appState.forumTopics.find(t => t.id === topicId);
      if (!topic) return;
      
      const reply = {
        id: 'r' + Date.now(),
        content,
        author: appState.currentUser,
        createdAt: new Date().toISOString(),
        likes: 0
      };
      
      if (!topic.replies) topic.replies = [];
      topic.replies.push(reply);
      topic.updatedAt = new Date().toISOString();
      
      saveState();
      
      // Notificar o autor do t√≥pico
      if (topic.author !== appState.currentUser) {
        addNotification(
          'Nova resposta no seu t√≥pico',
          `${appState.currentUser} respondeu: "${topic.title}"`,
          'info',
          'forum'
        );
      }
      
      showToast('Resposta enviada!', 'success');
      viewTopic(topicId);
    }
    
    function togglePin(topicId) {
      const topic = appState.forumTopics.find(t => t.id === topicId);
      if (topic) {
        topic.pinned = !topic.pinned;
        saveState();
        viewTopic(topicId);
      }
    }
    
    function toggleLock(topicId) {
      const topic = appState.forumTopics.find(t => t.id === topicId);
      if (topic) {
        topic.locked = !topic.locked;
        saveState();
        viewTopic(topicId);
      }
    }
    
    // ============================================
    // 10. CHAT GERAL EM TEMPO REAL
    // ============================================
    function renderChat() {
      const channels = {
        geral: { name: 'üí¨ Geral', unread: 0 },
        matematica: { name: 'üßÆ Matem√°tica', unread: 0 },
        fisica: { name: '‚öõÔ∏è F√≠sica', unread: 0 },
        computacao: { name: 'üíª Computa√ß√£o', unread: 0 },
        offtopic: { name: 'üéÆ Off-topic', unread: 0 },
        nucleo: { name: '‚öôÔ∏è N√∫cleo', unread: 0 }
      };
      
      // Inicializar mensagens se n√£o existirem
      Object.keys(channels).forEach(channel => {
        if (!appState.chatMessages[channel]) {
          appState.chatMessages[channel] = [];
        }
      });
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <h1>Chat em Tempo Real</h1>
          <p>Comunica√ß√£o instant√¢nea com LaTeX</p>
        </div>
        
        <div class="chat-container">
          <div class="chat-channels">
            <div class="channel-header">
              <h3>Canais</h3>
            </div>
            <div class="channels-list">
              ${Object.entries(channels).map(([id, channel]) => {
                if (id === 'nucleo' && !appState.isNucleo) return '';
                return `
                  <div class="channel-item" onclick="switchChannel('${id}')">
                    <div class="channel-icon">${channel.name.charAt(0)}</div>
                    <div class="channel-name">${channel.name.substring(2)}</div>
                    ${channel.unread > 0 ? `
                      <div class="unread-count">${channel.unread}</div>
                    ` : ''}
                  </div>
                `;
              }).join('')}
            </div>
          </div>
          
          <div class="chat-window">
            <div class="chat-header">
              <div>
                <h3 id="currentChannelName">Geral</h3>
                <div class="online-count" id="onlineCount">${appState.onlineUsers.size} online</div>
              </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
              ${renderChatMessages('geral')}
            </div>
            
            <div class="chat-input-container">
              <textarea id="chatInput" class="chat-input" 
                        placeholder="Digite sua mensagem... Use LaTeX para f√≥rmulas (ex: $E=mc^2$)"
                        onkeypress="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
              <button class="module-button primary" onclick="sendMessage()">Enviar</button>
            </div>
          </div>
        </div>
      `;
      
      // Configurar canal atual
      window.currentChannel = 'geral';
      updateOnlineCount();
      scrollToBottom();
    }
    
    function renderChatMessages(channel) {
      const messages = appState.chatMessages[channel] || [];
      
      if (messages.length === 0) {
        return `
          <div style="text-align: center; padding: 40px; color: var(--text-soft);">
            <div style="font-size: 48px; margin-bottom: 15px;">üí¨</div>
            <p>Nenhuma mensagem ainda. Seja o primeiro a falar!</p>
          </div>
        `;
      }
      
      return messages.map(msg => `
        <div class="message ${msg.author === appState.currentUser ? 'own' : 'other'}">
          <div class="message-header">
            <span class="message-author">${msg.author}</span>
            <span class="message-time">${new Date(msg.timestamp).toLocaleTimeString()}</span>
          </div>
          <div class="message-content">${msg.content}</div>
        </div>
      `).join('');
    }
    
    function switchChannel(channel) {
      window.currentChannel = channel;
      
      // Atualizar UI
      document.querySelectorAll('.channel-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.closest('.channel-item').classList.add('active');
      
      document.getElementById('currentChannelName').textContent = 
        channel.charAt(0).toUpperCase() + channel.slice(1);
      
      document.getElementById('messagesContainer').innerHTML = 
        renderChatMessages(channel);
      
      updateOnlineCount();
      scrollToBottom();
    }
    
    function sendMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      const msg = {
        id: 'm' + Date.now(),
        author: appState.currentUser,
        content: message,
        timestamp: new Date().toISOString(),
        channel: window.currentChannel
      };
      
      appState.chatMessages[window.currentChannel].push(msg);
      
      // Atualizar estat√≠sticas
      if (appState.users[appState.currentUser]) {
        appState.users[appState.currentUser].stats.chatMessages++;
      }
      
      saveState();
      
      input.value = '';
      
      // Atualizar mensagens
      document.getElementById('messagesContainer').innerHTML = 
        renderChatMessages(window.currentChannel);
      
      scrollToBottom();
      
      // Notificar outros usu√°rios online
      broadcastChatMessage(msg);
    }
    
    function updateOnlineCount() {
      const count = appState.onlineUsers.size;
      const element = document.getElementById('onlineCount');
      if (element) {
        element.textContent = `${count} online`;
      }
    }
    
    function scrollToBottom() {
      setTimeout(() => {
        const container = document.getElementById('messagesContainer');
        if (container) {
          container.scrollTop = container.scrollHeight;
        }
      }, 100);
    }
    
    // ============================================
    // 11. CHAT PRIVADO E CONTATOS
    // ============================================
    function renderPrivateChat() {
      // Inicializar mensagens privadas se n√£o existirem
      if (!appState.privateMessages[appState.currentUser]) {
        appState.privateMessages[appState.currentUser] = {};
      }
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <h1>Chat Privado</h1>
          <p>Conversas 1-1 com usu√°rios</p>
        </div>
        
        <div class="private-chat-container">
          <div class="contacts-list">
            <div class="channel-header">
              <h3>Contatos</h3>
            </div>
            <div class="channels-list" id="contactsList">
              ${renderContactsList()}
            </div>
          </div>
          
          <div class="chat-window">
            <div class="chat-header">
              <div>
                <h3 id="currentContactName">Selecione um contato</h3>
                <div class="online-count" id="contactStatus"></div>
              </div>
            </div>
            
            <div class="messages-container" id="privateMessagesContainer">
              <div style="text-align: center; padding: 40px; color: var(--text-soft);">
                <div style="font-size: 48px; margin-bottom: 15px;">üîí</div>
                <p>Selecione um contato para come√ßar a conversar</p>
              </div>
            </div>
            
            <div class="chat-input-container" style="display: none;" id="privateInputContainer">
              <textarea id="privateInput" class="chat-input" 
                        placeholder="Digite sua mensagem privada..."
                        onkeypress="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendPrivateMessage(); }"></textarea>
              <button class="module-button primary" onclick="sendPrivateMessage()">Enviar</button>
            </div>
          </div>
        </div>
      `;
      
      // Inicializar conversa atual
      window.currentContact = null;
    }
    
    function renderContactsList() {
      const users = Object.keys(appState.users).filter(u => u !== appState.currentUser);
      
      if (users.length === 0) {
        return `
          <div style="text-align: center; padding: 30px; color: var(--text-soft);">
            <p>Nenhum outro usu√°rio cadastrado.</p>
          </div>
        `;
      }
      
      return users.map(username => {
        const user = appState.users[username];
        const isOnline = appState.onlineUsers.has(username);
        const messages = appState.privateMessages[appState.currentUser][username] || [];
        const unread = messages.filter(m => m.sender === username && !m.read).length;
        const lastMessage = messages.length > 0 ? messages[messages.length - 1] : null;
        
        return `
          <div class="contact-item" onclick="openPrivateChat('${username}')">
            <div class="contact-avatar" style="background: ${user.profile.avatar.color};">
              ${user.profile.avatar.initials}
            </div>
            <div class="contact-info">
              <div class="contact-name">${username}</div>
              <div class="contact-status">
                <div class="status-indicator ${isOnline ? 'status-online' : 'status-offline'}"></div>
                <span>${isOnline ? 'Online' : 'Offline'}</span>
              </div>
              ${lastMessage ? `
                <div class="last-message">${lastMessage.content.substring(0, 30)}...</div>
              ` : ''}
            </div>
            ${unread > 0 ? `
              <div class="unread-badge">${unread}</div>
            ` : ''}
          </div>
        `;
      }).join('');
    }
    
    function openPrivateChat(username) {
      window.currentContact = username;
      
      // Atualizar UI
      document.querySelectorAll('.contact-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.closest('.contact-item').classList.add('active');
      
      document.getElementById('currentContactName').textContent = username;
      
      const isOnline = appState.onlineUsers.has(username);
      document.getElementById('contactStatus').textContent = isOnline ? 'Online' : 'Offline';
      
      // Mostrar mensagens
      const messages = appState.privateMessages[appState.currentUser][username] || [];
      document.getElementById('privateMessagesContainer').innerHTML = 
        renderPrivateMessages(messages);
      
      // Mostrar input
      document.getElementById('privateInputContainer').style.display = 'flex';
      
      // Marcar mensagens como lidas
      markMessagesAsRead(username);
      
      scrollToBottomPrivate();
    }
    
    function renderPrivateMessages(messages) {
      if (messages.length === 0) {
        return `
          <div style="text-align: center; padding: 40px; color: var(--text-soft);">
            <p>Nenhuma mensagem ainda. Comece a conversa!</p>
          </div>
        `;
      }
      
      return messages.map(msg => `
        <div class="message ${msg.sender === appState.currentUser ? 'own' : 'other'}">
          <div class="message-header">
            <span class="message-author">${msg.sender}</span>
            <span class="message-time">${new Date(msg.timestamp).toLocaleTimeString()}</span>
          </div>
          <div class="message-content">${msg.content}</div>
        </div>
      `).join('');
    }
    
    function sendPrivateMessage() {
      if (!window.currentContact) return;
      
      const input = document.getElementById('privateInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      const msg = {
        id: 'pm' + Date.now(),
        sender: appState.currentUser,
        receiver: window.currentContact,
        content: message,
        timestamp: new Date().toISOString(),
        read: false
      };
      
      // Salvar para o remetente
      if (!appState.privateMessages[appState.currentUser][window.currentContact]) {
        appState.privateMessages[appState.currentUser][window.currentContact] = [];
      }
      appState.privateMessages[appState.currentUser][window.currentContact].push(msg);
      
      // Salvar para o destinat√°rio
      if (!appState.privateMessages[window.currentContact]) {
        appState.privateMessages[window.currentContact] = {};
      }
      if (!appState.privateMessages[window.currentContact][appState.currentUser]) {
        appState.privateMessages[window.currentContact][appState.currentUser] = [];
      }
      appState.privateMessages[window.currentContact][appState.currentUser].push(msg);
      
      saveState();
      
      input.value = '';
      
      // Atualizar mensagens
      const messages = appState.privateMessages[appState.currentUser][window.currentContact];
      document.getElementById('privateMessagesContainer').innerHTML = 
        renderPrivateMessages(messages);
      
      scrollToBottomPrivate();
      
      // Notificar o destinat√°rio se estiver online
      if (appState.onlineUsers.has(window.currentContact)) {
        // Em um sistema real, isso seria um WebSocket
        addNotification(
          'Nova mensagem privada',
          `${appState.currentUser}: ${message.substring(0, 50)}...`,
          'info',
          'private'
        );
      }
    }
    
    function markMessagesAsRead(username) {
      const messages = appState.privateMessages[appState.currentUser][username];
      if (messages) {
        messages.forEach(msg => {
          if (msg.sender === username) {
            msg.read = true;
          }
        });
        saveState();
      }
    }
    
    function scrollToBottomPrivate() {
      setTimeout(() => {
        const container = document.getElementById('privateMessagesContainer');
        if (container) {
          container.scrollTop = container.scrollHeight;
        }
      }, 100);
    }
    
    // ============================================
    // 12. SISTEMA DE GRUPOS
    // ============================================
    function renderGroups() {
      const userGroups = appState.groups.filter(g => g.members.includes(appState.currentUser));
      const otherGroups = appState.groups.filter(g => !g.members.includes(appState.currentUser));
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <h1>Grupos de Pesquisa</h1>
          <p>Colabora√ß√£o em projetos cient√≠ficos</p>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Criar Novo Grupo</h2>
          </div>
          
          <div class="form-group">
            <label class="form-label">Nome do Grupo</label>
            <input type="text" id="groupName" class="form-control" placeholder="Nome do grupo">
          </div>
          
          <div class="form-group">
            <label class="form-label">Descri√ß√£o</label>
            <textarea id="groupDescription" class="form-control" 
                      placeholder="Descri√ß√£o do grupo..." rows="3"></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Tipo</label>
            <select id="groupType" class="form-control">
              <option value="public">P√∫blico</option>
              <option value="private">Privado</option>
              <option value="invite">Por Convite</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Tags</label>
            <input type="text" id="groupTags" class="form-control" placeholder="matem√°tica, pesquisa, etc.">
          </div>
          
          <button class="module-button primary" onclick="createGroup()">Criar Grupo</button>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Meus Grupos (${userGroups.length})</h2>
          </div>
          
          <div class="theories-grid">
            ${renderUserGroups()}
          </div>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Outros Grupos (${otherGroups.length})</h2>
          </div>
          
          <div class="theories-grid">
            ${renderOtherGroups()}
          </div>
        </div>
      `;
    }
    
    function createGroup() {
      const name = document.getElementById('groupName').value.trim();
      const description = document.getElementById('groupDescription').value.trim();
      const type = document.getElementById('groupType').value;
      const tags = document.getElementById('groupTags').value.trim();
      
      if (!name) {
        showToast('Digite um nome para o grupo!', 'error');
        return;
      }
      
      const group = {
        id: 'g' + Date.now(),
        name,
        description,
        type,
        owner: appState.currentUser,
        members: [appState.currentUser],
        createdAt: new Date().toISOString(),
        tags: tags ? tags.split(',').map(t => t.trim()) : [],
        discussions: [],
        files: []
      };
      
      appState.groups.push(group);
      
      // Atualizar estat√≠sticas
      if (appState.users[appState.currentUser]) {
        appState.users[appState.currentUser].stats.groups++;
      }
      
      saveState();
      
      showToast('Grupo criado com sucesso!', 'success');
      loadSection('groups');
    }
    
    function renderUserGroups() {
      const userGroups = appState.groups.filter(g => g.members.includes(appState.currentUser));
      
      if (userGroups.length === 0) {
        return `
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
            <div style="font-size: 48px; color: var(--text-soft); margin-bottom: 20px;">üë•</div>
            <p style="color: var(--text-soft);">Voc√™ n√£o participa de nenhum grupo.</p>
          </div>
        `;
      }
      
      return userGroups.map(group => `
        <div class="theory-card">
          <h4>${group.name}</h4>
          <div class="theory-meta">
            <span>${group.type}</span>
            <span>${group.members.length} membros</span>
          </div>
          <div class="theory-preview">${group.description || 'Sem descri√ß√£o'}</div>
          <div class="theory-actions">
            <button class="module-button" onclick="viewGroup('${group.id}')">Abrir</button>
            ${group.owner === appState.currentUser ? `
              <button class="module-button danger" onclick="deleteGroup('${group.id}')">Excluir</button>
            ` : `
              <button class="module-button" onclick="leaveGroup('${group.id}')">Sair</button>
            `}
          </div>
        </div>
      `).join('');
    }
    
    function renderOtherGroups() {
      const otherGroups = appState.groups.filter(g => !g.members.includes(appState.currentUser));
      
      if (otherGroups.length === 0) {
        return `
          <div style="grid-column: 1 / -1; text-align: center; padding: 30px;">
            <p style="color: var(--text-soft);">Nenhum outro grupo dispon√≠vel.</p>
          </div>
        `;
      }
      
      return otherGroups.map(group => `
        <div class="theory-card">
          <h4>${group.name}</h4>
          <div class="theory-meta">
            <span>${group.type}</span>
            <span>${group.members.length} membros</span>
          </div>
          <div class="theory-preview">${group.description || 'Sem descri√ß√£o'}</div>
          <div class="theory-actions">
            <button class="module-button" onclick="viewGroup('${group.id}')">Ver</button>
            ${group.type !== 'invite' ? `
              <button class="module-button primary" onclick="joinGroup('${group.id}')">Participar</button>
            ` : ''}
          </div>
        </div>
      `).join('');
    }
    
    function viewGroup(id) {
      const group = appState.groups.find(g => g.id === id);
      if (!group) return;
      
      const isMember = group.members.includes(appState.currentUser);
      const isOwner = group.owner === appState.currentUser;
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <h1>${group.name}</h1>
              <p>${group.type} ‚Ä¢ ${group.members.length} membros</p>
            </div>
            <div>
              <button class="module-button" onclick="loadSection('groups')">Voltar</button>
            </div>
          </div>
        </div>
        
        <div class="module-container">
          <div style="margin-bottom: 25px;">
            <h3 style="margin-bottom: 15px; color: var(--accent);">Descri√ß√£o</h3>
            <p style="line-height: 1.6;">${group.description || 'Sem descri√ß√£o'}</p>
          </div>
          
          <div style="margin-bottom: 25px;">
            <h3 style="margin-bottom: 15px; color: var(--accent);">Membros</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
              ${group.members.map(member => `
                <div style="background: var(--bg-card); padding: 10px 15px; border-radius: 8px;">
                  <div style="font-weight: 500;">${member}</div>
                  <div style="font-size: 12px; color: var(--text-soft);">
                    ${member === group.owner ? 'Propriet√°rio' : 'Membro'}
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
          
          ${isMember ? `
          <div style="margin-bottom: 25px;">
            <h3 style="margin-bottom: 15px; color: var(--accent);">Discuss√µes</h3>
            ${group.discussions && group.discussions.length > 0 ? `
              <div style="display: flex; flex-direction: column; gap: 10px;">
                ${group.discussions.map(disc => `
                  <div style="background: var(--bg-card); padding: 15px; border-radius: 8px;">
                    <div style="font-weight: 500; margin-bottom: 5px;">${disc.title}</div>
                    <div style="font-size: 14px; color: var(--text-soft);">
                      Por: ${disc.author} ‚Ä¢ ${new Date(disc.createdAt).toLocaleDateString()}
                    </div>
                  </div>
                `).join('')}
              </div>
            ` : `
              <p style="color: var(--text-soft); text-align: center; padding: 20px;">
                Nenhuma discuss√£o ainda.
              </p>
            `}
          </div>
          ` : ''}
          
          <div style="display: flex; gap: 10px; margin-top: 25px;">
            ${!isMember ? `
              ${group.type !== 'invite' ? `
                <button class="module-button primary" onclick="joinGroup('${group.id}')">Participar</button>
              ` : ''}
            ` : isOwner ? `
              <button class="module-button danger" onclick="deleteGroup('${group.id}')">Excluir Grupo</button>
            ` : `
              <button class="module-button" onclick="leaveGroup('${group.id}')">Sair do Grupo</button>
            `}
          </div>
        </div>
      `;
    }
    
    function joinGroup(id) {
      const group = appState.groups.find(g => g.id === id);
      if (group && !group.members.includes(appState.currentUser)) {
        group.members.push(appState.currentUser);
        saveState();
        
        // Atualizar estat√≠sticas
        if (appState.users[appState.currentUser]) {
          appState.users[appState.currentUser].stats.groups++;
        }
        
        showToast('Voc√™ entrou no grupo!', 'success');
        viewGroup(id);
      }
    }
    
    function leaveGroup(id) {
      const group = appState.groups.find(g => g.id === id);
      if (group && group.members.includes(appState.currentUser)) {
        group.members = group.members.filter(m => m !== appState.currentUser);
        
        // Se for o propriet√°rio e n√£o houver outros membros, excluir o grupo
        if (group.owner === appState.currentUser && group.members.length === 0) {
          appState.groups = appState.groups.filter(g => g.id !== id);
        }
        
        saveState();
        
        // Atualizar estat√≠sticas
        if (appState.users[appState.currentUser]) {
          appState.users[appState.currentUser].stats.groups--;
        }
        
        showToast('Voc√™ saiu do grupo.', 'warning');
        loadSection('groups');
      }
    }
    
    function deleteGroup(id) {
      if (confirm('Tem certeza que deseja excluir este grupo? Esta a√ß√£o n√£o pode ser desfeita.')) {
        appState.groups = appState.groups.filter(g => g.id !== id);
        saveState();
        showToast('Grupo exclu√≠do!', 'success');
        loadSection('groups');
      }
    }
    
    // ============================================
    // 13. UPLOAD DE ARQUIVOS
    // ============================================
    function renderFiles() {
      const userFiles = appState.files.filter(f => f.owner === appState.currentUser);
      const sharedFiles = appState.files.filter(f => 
        f.sharedWith && f.sharedWith.includes(appState.currentUser)
      );
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <h1>Arquivos</h1>
          <p>Upload e compartilhamento de arquivos</p>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Upload de Arquivo</h2>
          </div>
          
          <div class="upload-container" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">üìÅ</div>
            <h3>Arraste e solte ou clique para upload</h3>
            <p style="color: var(--text-soft); margin-top: 10px;">
              Formatos suportados: PDF, DOC, TXT, PNG, JPG, ZIP
            </p>
          </div>
          
          <input type="file" id="fileInput" style="display: none;" onchange="handleFileUpload(event)">
          
          <div class="form-group">
            <label class="form-label">Compartilhar com</label>
            <input type="text" id="shareWith" class="form-control" 
                   placeholder="Usu√°rios (separados por v√≠rgula)">
          </div>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Meus Arquivos (${userFiles.length})</h2>
          </div>
          
          <div class="file-list">
            ${renderUserFiles()}
          </div>
        </div>
        
        ${sharedFiles.length > 0 ? `
        <div class="module-container">
          <div class="module-header">
            <h2>Arquivos Compartilhados (${sharedFiles.length})</h2>
          </div>
          
          <div class="file-list">
            ${renderSharedFiles()}
          </div>
        </div>
        ` : ''}
      `;
    }
    
    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // Validar tamanho (max 10MB)
      if (file.size > 10 * 1024 * 1024) {
        showToast('Arquivo muito grande! M√°ximo 10MB.', 'error');
        return;
      }
      
      // Validar tipo
      const validTypes = ['application/pdf', 'text/plain', 'image/png', 'image/jpeg', 
                         'application/msword', 'application/zip'];
      if (!validTypes.includes(file.type)) {
        showToast('Tipo de arquivo n√£o suportado!', 'error');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const fileData = {
          id: 'file' + Date.now(),
          name: file.name,
          type: file.type,
          size: file.size,
          data: e.target.result,
          owner: appState.currentUser,
          uploadedAt: new Date().toISOString(),
          sharedWith: []
        };
        
        // Adicionar compartilhamento se especificado
        const shareWith = document.getElementById('shareWith').value.trim();
        if (shareWith) {
          fileData.sharedWith = shareWith.split(',').map(u => u.trim());
        }
        
        appState.files.push(fileData);
        
        // Atualizar estat√≠sticas
        if (appState.users[appState.currentUser]) {
          appState.users[appState.currentUser].stats.files++;
        }
        
        saveState();
        
        // Notificar usu√°rios compartilhados
        if (fileData.sharedWith.length > 0) {
          fileData.sharedWith.forEach(username => {
            if (appState.users[username]) {
              addNotification(
                'Arquivo compartilhado',
                `${appState.currentUser} compartilhou "${file.name}" com voc√™`,
                'info',
                'files'
              );
            }
          });
        }
        
        showToast('Arquivo enviado com sucesso!', 'success');
        loadSection('files');
      };
      
      reader.readAsDataURL(file);
    }
    
    function renderUserFiles() {
      const userFiles = appState.files.filter(f => f.owner === appState.currentUser);
      
      if (userFiles.length === 0) {
        return `
          <div style="text-align: center; padding: 30px; color: var(--text-soft);">
            <p>Nenhum arquivo enviado ainda.</p>
          </div>
        `;
      }
      
      return userFiles.reverse().map(file => `
        <div class="file-item">
          <div class="file-icon">
            ${getFileIcon(file.type)}
          </div>
          <div class="file-info">
            <div class="file-name">${file.name}</div>
            <div class="file-meta">
              <span>${formatFileSize(file.size)}</span>
              <span>${new Date(file.uploadedAt).toLocaleDateString()}</span>
              ${file.sharedWith.length > 0 ? `
                <span>Compartilhado com ${file.sharedWith.length} pessoa(s)</span>
              ` : ''}
            </div>
          </div>
          <div class="file-actions">
            <button class="module-button" onclick="downloadFile('${file.id}')">Download</button>
            <button class="module-button danger" onclick="deleteFile('${file.id}')">Excluir</button>
          </div>
        </div>
      `).join('');
    }
    
    function renderSharedFiles() {
      const sharedFiles = appState.files.filter(f => 
        f.sharedWith && f.sharedWith.includes(appState.currentUser)
      );
      
      return sharedFiles.map(file => `
        <div class="file-item">
          <div class="file-icon">
            ${getFileIcon(file.type)}
          </div>
          <div class="file-info">
            <div class="file-name">${file.name}</div>
            <div class="file-meta">
              <span>${formatFileSize(file.size)}</span>
              <span>De: ${file.owner}</span>
              <span>${new Date(file.uploadedAt).toLocaleDateString()}</span>
            </div>
          </div>
          <div class="file-actions">
            <button class="module-button" onclick="downloadFile('${file.id}')">Download</button>
          </div>
        </div>
      `).join('');
    }
    
    function getFileIcon(type) {
      if (type.includes('pdf')) return 'üìï';
      if (type.includes('word')) return 'üìÑ';
      if (type.includes('text')) return 'üìù';
      if (type.includes('image')) return 'üñºÔ∏è';
      if (type.includes('zip')) return 'üì¶';
      return 'üìÅ';
    }
    
    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }
    
    function downloadFile(id) {
      const file = appState.files.find(f => f.id === id);
      if (!file) return;
      
      const a = document.createElement('a');
      a.href = file.data;
      a.download = file.name;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
    
    function deleteFile(id) {
      if (confirm('Tem certeza que deseja excluir este arquivo?')) {
        appState.files = appState.files.filter(f => f.id !== id);
        saveState();
        
        // Atualizar estat√≠sticas
        if (appState.users[appState.currentUser]) {
          appState.users[appState.currentUser].stats.files--;
        }
        
        showToast('Arquivo exclu√≠do!', 'success');
        loadSection('files');
      }
    }
    
    // ============================================
    // 14. PERFIL DO USU√ÅRIO
    // ============================================
    function renderProfile() {
      const user = appState.users[appState.currentUser];
      const theories = appState.theories.filter(t => t.author === appState.currentUser);
      const topics = appState.forumTopics.filter(t => t.author === appState.currentUser);
      const groups = appState.groups.filter(g => g.members.includes(appState.currentUser));
      const files = appState.files.filter(f => f.owner === appState.currentUser);
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <h1>Meu Perfil</h1>
          <p>Gerencie suas informa√ß√µes e configura√ß√µes</p>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Informa√ß√µes Pessoais</h2>
          </div>
          
          <div style="display: flex; gap: 20px; margin-bottom: 25px;">
            <div style="flex: 0 0 auto;">
              <div class="contact-avatar" style="width: 100px; height: 100px; font-size: 32px;">
                ${user.profile.avatar.initials}
              </div>
            </div>
            <div style="flex: 1;">
              <div style="font-size: 24px; font-weight: 500; margin-bottom: 5px;">
                ${appState.currentUser}
              </div>
              <div style="color: var(--text-soft); margin-bottom: 15px;">
                ${appState.isNucleo ? 'Membro N√∫cleo' : 'Membro'} ‚Ä¢ 
                Desde ${new Date(user.createdAt).toLocaleDateString()}
              </div>
              <div style="display: flex; gap: 10px;">
                <div style="background: var(--bg-card); padding: 8px 15px; border-radius: 6px;">
                  <div style="font-size: 12px; color: var(--text-soft);">Teorias</div>
                  <div style="font-weight: 500; font-size: 18px;">${theories.length}</div>
                </div>
                <div style="background: var(--bg-card); padding: 8px 15px; border-radius: 6px;">
                  <div style="font-size: 12px; color: var(--text-soft);">Posts</div>
                  <div style="font-weight: 500; font-size: 18px;">${topics.length}</div>
                </div>
                <div style="background: var(--bg-card); padding: 8px 15px; border-radius: 6px;">
                  <div style="font-size: 12px; color: var(--text-soft);">Grupos</div>
                  <div style="font-weight: 500; font-size: 18px;">${groups.length}</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Biografia</label>
            <textarea id="userBio" class="form-control" 
                      placeholder="Conte um pouco sobre voc√™..." 
                      rows="3">${user.profile.bio || ''}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">√Årea de Pesquisa</label>
            <input type="text" id="userArea" class="form-control" 
                   placeholder="Sua √°rea de pesquisa" 
                   value="${user.profile.area || ''}">
          </div>
          
          <div class="form-group">
            <label class="form-label">Links (separados por v√≠rgula)</label>
            <input type="text" id="userLinks" class="form-control" 
                   placeholder="GitHub, site, arXiv, etc." 
                   value="${user.profile.links || ''}">
          </div>
          
          <button class="module-button primary" onclick="updateProfile()">
            <i>üíæ</i> Salvar Perfil
          </button>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Configura√ß√µes</h2>
          </div>
          
          <div class="form-group">
            <label class="form-label" style="display: flex; align-items: center; gap: 10px;">
              <input type="checkbox" id="notificationsEnabled" 
                     ${user.settings.notifications ? 'checked' : ''}>
              Receber notifica√ß√µes
            </label>
          </div>
          
          <div class="form-group">
            <label class="form-label">Privacidade</label>
            <select id="privacyLevel" class="form-control">
              <option value="public" ${user.settings.privacy === 'public' ? 'selected' : ''}>
                P√∫blico
              </option>
              <option value="private" ${user.settings.privacy === 'private' ? 'selected' : ''}>
                Privado
              </option>
              <option value="nucleo" ${user.settings.privacy === 'nucleo' ? 'selected' : ''}>
                Somente N√∫cleo
              </option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Tema</label>
            <div class="theme-selector">
              <div class="theme-option theme-dark ${user.settings.theme === 'dark' ? 'active' : ''}" 
                   onclick="setTheme('dark'); updateUserTheme('dark')"></div>
              <div class="theme-option theme-blue ${user.settings.theme === 'blue' ? 'active' : ''}" 
                   onclick="setTheme('blue'); updateUserTheme('blue')"></div>
              <div class="theme-option theme-green ${user.settings.theme === 'green' ? 'active' : ''}" 
                   onclick="setTheme('green'); updateUserTheme('green')"></div>
              <div class="theme-option theme-purple ${user.settings.theme === 'purple' ? 'active' : ''}" 
                   onclick="setTheme('purple'); updateUserTheme('purple')"></div>
            </div>
          </div>
          
          <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border);">
            <h3 style="margin-bottom: 15px; color: var(--accent);">Exportar Dados</h3>
            <div style="display: flex; gap: 10px;">
              <button class="module-button" onclick="exportData()">Exportar Backup</button>
              <button class="module-button" onclick="document.getElementById('importInput').click()">
                Importar Backup
              </button>
              <input type="file" id="importInput" style="display: none;" onchange="importData(event)">
              <button class="module-button danger" onclick="clearUserData()">Limpar Meus Dados</button>
            </div>
          </div>
        </div>
      `;
    }
    
    function updateProfile() {
      const user = appState.users[appState.currentUser];
      
      user.profile.bio = document.getElementById('userBio').value.trim();
      user.profile.area = document.getElementById('userArea').value.trim();
      user.profile.links = document.getElementById('userLinks').value.trim();
      
      user.settings.notifications = document.getElementById('notificationsEnabled').checked;
      user.settings.privacy = document.getElementById('privacyLevel').value;
      user.settings.theme = appState.theme;
      
      saveState();
      showToast('Perfil atualizado com sucesso!', 'success');
    }
    
    function updateUserTheme(theme) {
      const user = appState.users[appState.currentUser];
      if (user) {
        user.settings.theme = theme;
        saveState();
      }
    }
    
    function clearUserData() {
      if (confirm('Tem certeza? Isso excluir√° TODOS os seus dados (teorias, posts, arquivos, etc.)')) {
        // Remover teorias do usu√°rio
        appState.theories = appState.theories.filter(t => t.author !== appState.currentUser);
        
        // Remover posts do f√≥rum do usu√°rio
        appState.forumTopics = appState.forumTopics.filter(t => t.author !== appState.currentUser);
        
        // Remover arquivos do usu√°rio
        appState.files = appState.files.filter(f => f.owner !== appState.currentUser);
        
        // Remover de grupos (mas manter os grupos)
        appState.groups.forEach(group => {
          group.members = group.members.filter(m => m !== appState.currentUser);
        });
        
        // Remover mensagens privadas
        delete appState.privateMessages[appState.currentUser];
        Object.keys(appState.privateMessages).forEach(user => {
          delete appState.privateMessages[user][appState.currentUser];
        });
        
        // Resetar estat√≠sticas
        if (appState.users[appState.currentUser]) {
          appState.users[appState.currentUser].stats = {
            theories: 0,
            forumPosts: 0,
            chatMessages: 0,
            files: 0,
            groups: 0
          };
        }
        
        saveState();
        showToast('Seus dados foram limpos!', 'success');
        loadSection('profile');
      }
    }
    
    // ============================================
    // 15. ADMINISTRA√á√ÉO (N√öCLEO)
    // ============================================
    function renderAdmin() {
      if (!appState.isNucleo) {
        showToast('Acesso negado!', 'error');
        loadSection('dashboard');
        return;
      }
      
      const users = Object.keys(appState.users);
      const pendingTheories = appState.theories.filter(t => t.status === 'pending');
      const totalFiles = appState.files.length;
      const totalMessages = Object.values(appState.chatMessages).reduce((acc, msgs) => acc + msgs.length, 0);
      const totalPrivateMessages = Object.values(appState.privateMessages).reduce((acc, userMsgs) => {
        return acc + Object.values(userMsgs).reduce((sum, msgs) => sum + msgs.length, 0);
      }, 0);
      
      const content = document.getElementById('mainContent');
      content.innerHTML = `
        <div class="content-header">
          <h1>Painel de Administra√ß√£o</h1>
          <p>Gest√£o completa do sistema</p>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Usu√°rios</h3>
            <div class="stat-value">${users.length}</div>
            <div class="stat-trend">
              <span>${users.filter(u => appState.users[u].nucleo).length} n√∫cleo</span>
            </div>
          </div>
          
          <div class="stat-card">
            <h3>Teorias</h3>
            <div class="stat-value">${appState.theories.length}</div>
            <div class="stat-trend">
              <span>${pendingTheories.length} pendentes</span>
            </div>
          </div>
          
          <div class="stat-card">
            <h3>Arquivos</h3>
            <div class="stat-value">${totalFiles}</div>
          </div>
          
          <div class="stat-card">
            <h3>Mensagens</h3>
            <div class="stat-value">${totalMessages + totalPrivateMessages}</div>
          </div>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Gerenciar Usu√°rios</h2>
          </div>
          
          <table class="forum-table">
            <thead>
              <tr>
                <th>Usu√°rio</th>
                <th>Tipo</th>
                <th>Cadastro</th>
                <th>Atividade</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              ${renderAdminUsersList()}
            </tbody>
          </table>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Manuten√ß√£o do Sistema</h2>
          </div>
          
          <div style="display: flex; flex-direction: column; gap: 15px;">
            <div>
              <button class="module-button" onclick="cleanOldData()">
                <i>üßπ</i> Limpar Dados Antigos
              </button>
              <span style="margin-left: 10px; color: var(--text-soft); font-size: 14px;">
                Remove mensagens e arquivos antigos
              </span>
            </div>
            
            <div>
              <button class="module-button" onclick="resetAllPasswords()">
                <i>üîë</i> Resetar Senhas
              </button>
              <span style="margin-left: 10px; color: var(--text-soft); font-size: 14px;">
                Define senha padr√£o para todos
              </span>
            </div>
            
            <div>
              <button class="module-button danger" onclick="clearAllSystemData()">
                <i>üí•</i> Limpar Todo o Sistema
              </button>
              <span style="margin-left: 10px; color: var(--danger); font-size: 14px;">
                Remove TODOS os dados permanentemente
              </span>
            </div>
          </div>
        </div>
        
        <div class="module-container">
          <div class="module-header">
            <h2>Logs do Sistema</h2>
          </div>
          
          <div style="background: var(--bg-card); padding: 20px; border-radius: 8px; 
                      font-family: monospace; font-size: 13px; max-height: 300px; overflow-y: auto;">
            <div>=== Sistema Renova v${APP_VERSION} ===</div>
            <div>Usu√°rios: ${users.length}</div>
            <div>Teorias: ${appState.theories.length} (${pendingTheories.length} pendentes)</div>
            <div>Arquivos: ${totalFiles}</div>
            <div>Mensagens: ${totalMessages + totalPrivateMessages}</div>
            <div>√öltima atualiza√ß√£o: ${new Date().toLocaleString()}</div>
          </div>
        </div>
      `;
    }
    
    function renderAdminUsersList() {
      const users = Object.keys(appState.users);
      
      return users.map(username => {
        const user = appState.users[username];
        const theories = appState.theories.filter(t => t.author === username);
        const topics = appState.forumTopics.filter(t => t.author === username);
        
        return `
          <tr>
            <td>
              <div style="font-weight: 500;">${username}</div>
              <div style="font-size: 12px; color: var(--text-soft);">
                ${user.stats.theories} teorias, ${user.stats.forumPosts} posts
              </div>
            </td>
            <td>
              <span class="theory-status ${user.nucleo ? 'status-approved' : 'status-pending'}">
                ${user.nucleo ? 'N√∫cleo' : 'Usu√°rio'}
              </span>
            </td>
            <td>
              ${new Date(user.createdAt).toLocaleDateString()}
            </td>
            <td>
              ${user.lastSeen ? new Date(user.lastSeen).toLocaleDateString() : 'Nunca'}
            </td>
            <td>
              ${!user.nucleo ? `
                <button class="module-button" onclick="promoteToNucleo('${username}')">Promover</button>
              ` : username !== appState.currentUser ? `
                <button class="module-button" onclick="demoteFromNucleo('${username}')">Rebaixar</button>
              ` : ''}
              <button class="module-button danger" onclick="deleteUser('${username}')">Excluir</button>
            </td>
          </tr>
        `;
      }).join('');
    }
    
    function promoteToNucleo(username) {
      if (appState.users[username]) {
        appState.users[username].nucleo = true;
        saveState();
        
        addNotification(
          'Promovido para N√∫cleo',
          'Voc√™ foi promovido para o N√∫cleo do sistema!',
          'success'
        );
        
        showToast(`${username} promovido para N√∫cleo!`, 'success');
        renderAdmin();
      }
    }
    
    function demoteFromNucleo(username) {
      if (appState.users[username] && username !== appState.currentUser) {
        appState.users[username].nucleo = false;
        saveState();
        
        addNotification(
          'Rebaixado para Usu√°rio',
          'Voc√™ foi rebaixado para usu√°rio regular.',
          'warning'
        );
        
        showToast(`${username} rebaixado para usu√°rio.`, 'warning');
        renderAdmin();
      }
    }
    
    function deleteUser(username) {
      if (username === appState.currentUser) {
        showToast('N√£o √© poss√≠vel excluir seu pr√≥prio usu√°rio!', 'error');
        return;
      }
      
      if (confirm(`Excluir usu√°rio "${username}" e TODOS os seus dados?`)) {
        // Remover usu√°rio
        delete appState.users[username];
        
        // Remover teorias do usu√°rio
        appState.theories = appState.theories.filter(t => t.author !== username);
        
        // Remover posts do f√≥rum
        appState.forumTopics = appState.forumTopics.filter(t => t.author !== username);
        
        // Remover arquivos
        appState.files = appState.files.filter(f => f.owner !== username);
        
        // Remover de grupos
        appState.groups.forEach(group => {
          group.members = group.members.filter(m => m !== username);
        });
        
        // Remover mensagens
        delete appState.privateMessages[username];
        Object.keys(appState.privateMessages).forEach(user => {
          delete appState.privateMessages[user][username];
        });
        
        saveState();
        showToast(`Usu√°rio ${username} exclu√≠do!`, 'success');
        renderAdmin();
      }
    }
    
    function cleanOldData() {
      const now = new Date();
      const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
      
      // Limpar mensagens antigas do chat
      Object.keys(appState.chatMessages).forEach(channel => {
        appState.chatMessages[channel] = appState.chatMessages[channel].filter(msg => 
          new Date(msg.timestamp) > monthAgo
        );
      });
      
      // Limpar arquivos antigos
      appState.files = appState.files.filter(file => 
        new Date(file.uploadedAt) > monthAgo
      );
      
      saveState();
      showToast('Dados antigos limpos com sucesso!', 'success');
      renderAdmin();
    }
    
    function resetAllPasswords() {
      if (confirm('Resetar todas as senhas para "senha123"?')) {
        Object.keys(appState.users).forEach(username => {
          appState.users[username].password = 'senha123';
        });
        saveState();
        showToast('Todas as senhas foram resetadas!', 'success');
        renderAdmin();
      }
    }
    
    function clearAllSystemData() {
      if (confirm('ATEN√á√ÉO: Isso excluir√° TODOS os dados do sistema. Continuar?')) {
        localStorage.clear();
        location.reload();
      }
    }
    
    // ============================================
    // 16. FUN√á√ïES AUXILIARES E INICIALIZA√á√ÉO
    // ============================================
    function showAuthScreen() {
      document.getElementById('authScreen').classList.remove('hidden');
      document.getElementById('dashboard').classList.add('hidden');
      
      // Limpar campos
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      document.getElementById('masterKey').value = '';
    }
    
    function showDashboard() {
      document.getElementById('authScreen').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      
      loadSection('dashboard');
    }
    
    // Mobile menu toggle
    document.getElementById('mobileMenuToggle').addEventListener('click', function() {
      document.getElementById('sidebar').classList.toggle('active');
    });
    
    // Simula√ß√£o de WebSocket para tempo real
    function broadcastOnlineStatus() {
      // Em um sistema real, isso seria um WebSocket
      updateOnlineCount();
    }
    
    function broadcastChatMessage(msg) {
      // Em um sistema real, isso seria um WebSocket
      console.log('Broadcasting message:', msg);
    }
    
    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      // Verificar autentica√ß√£o
      checkAuth();
      
      // Configurar tema salvo
      const savedTheme = localStorage.getItem('renova_theme');
      if (savedTheme) {
        setTheme(savedTheme);
      }
      
      // Simular atualiza√ß√µes em tempo real
      setInterval(() => {
        if (appState.currentUser) {
          updateOnlineCount();
        }
      }, 10000);
    });
  </script>
</body>
</html>
