<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Renova - Rede Social Científica</title>
    <!-- MathJax para renderização de LaTeX -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary-dark: #0a0a0f;
            --secondary-dark: #12121a;
            --accent-gold: #d4af37;
            --accent-neon: #00ffff;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #2a2a3a;
            --card-bg: #161622;
            --success: #2ecc71;
            --danger: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--primary-dark);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(100, 100, 150, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(180, 180, 220, 0.05) 0%, transparent 20%);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Barra Lateral */
        .sidebar {
            width: 280px;
            background-color: var(--secondary-dark);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
        }

        .logo-container {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: 2px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--accent-gold), var(--accent-neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }

        .logo::after {
            content: "⟁";
            position: absolute;
            right: -25px;
            top: 0;
            font-size: 20px;
            color: var(--accent-gold);
        }

        .motto {
            font-style: italic;
            color: var(--text-secondary);
            font-size: 12px;
            letter-spacing: 1px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #2a2a3a, #1a1a2a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin-right: 15px;
            position: relative;
            overflow: hidden;
        }

        .avatar.core {
            box-shadow: 0 0 20px var(--accent-gold), inset 0 0 10px rgba(212, 175, 55, 0.3);
        }

        .avatar.initiate {
            box-shadow: 0 0 20px var(--accent-neon), inset 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .user-info.core h3 {
            color: var(--accent-gold);
        }

        .user-info.initiate h3 {
            color: var(--accent-neon);
        }

        .user-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Navegação */
        .nav-tabs {
            display: flex;
            flex-direction: column;
            margin-bottom: 25px;
        }

        .tab-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            text-align: left;
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            font-size: 16px;
        }

        .tab-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .tab-btn.active {
            background-color: rgba(100, 100, 150, 0.2);
            color: var(--accent-neon);
            border-left: 3px solid var(--accent-neon);
        }

        .tab-btn i {
            margin-right: 10px;
            font-size: 18px;
        }

        /* Lista de Amigos */
        .friends-section {
            margin-top: auto;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .section-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .friends-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .friend-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .friend-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .friend-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3a3a4a, #2a2a3a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-right: 10px;
        }

        .friend-name {
            font-size: 14px;
        }

        /* Conteúdo Principal */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .page-title {
            font-size: 28px;
            background: linear-gradient(45deg, var(--accent-gold), var(--accent-neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Card de Conteúdo */
        .content-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            color: var(--text-primary);
        }

        .card-date {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .card-author {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            background: linear-gradient(45deg, #3a3a4a, #2a2a3a);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .author-info h4 {
            font-size: 16px;
        }

        .author-info p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .theory-content {
            line-height: 1.6;
            font-size: 16px;
            color: var(--text-primary);
        }

        .theory-content p {
            margin-bottom: 15px;
        }

        /* Botões */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #2a2a3a, #1a1a2a);
            color: var(--accent-neon);
            border: 1px solid var(--accent-neon);
        }

        .btn-primary:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2a2a3a, #1a1a2a);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #c0392b, #e74c3c);
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            width: 90%;
            max-width: 700px;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            color: var(--accent-neon);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: var(--accent-neon);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            resize: vertical;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-neon);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .form-textarea {
            min-height: 200px;
            font-family: monospace;
            line-height: 1.5;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 25px;
        }

        /* Lista de Membros */
        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .member-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .member-card:hover {
            border-color: var(--accent-neon);
            transform: translateY(-5px);
        }

        .member-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .member-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            background: linear-gradient(45deg, #3a3a4a, #2a2a3a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .member-info h4 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .member-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .member-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .add-friend-btn {
            padding: 8px 15px;
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .add-friend-btn:hover {
            background-color: rgba(46, 204, 113, 0.2);
        }

        .add-friend-btn.added {
            background-color: rgba(52, 152, 219, 0.1);
            color: #3498db;
            border-color: #3498db;
        }

        /* Chat */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            background-color: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.2);
        }

        .chat-back-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            margin-right: 15px;
            cursor: pointer;
        }

        .chat-friend-info h4 {
            font-size: 18px;
        }

        .chat-friend-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            max-width: 70%;
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.4;
            position: relative;
        }

        .message.sent {
            align-self: flex-end;
            background-color: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-bottom-right-radius: 5px;
        }

        .message.received {
            align-self: flex-start;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
            text-align: right;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent-neon);
        }

        .send-btn {
            padding: 12px 25px;
            background: linear-gradient(45deg, #2a2a3a, #1a1a2a);
            color: var(--accent-neon);
            border: 1px solid var(--accent-neon);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .send-btn:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        /* LaTeX Preview */
        .latex-preview {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px dashed var(--border-color);
            min-height: 80px;
        }

        .latex-preview-title {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        /* Responsividade */
        @media (max-width: 1024px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 300px;
            }
            
            .friends-section {
                margin-top: 20px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .members-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animações especiais */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }
    </style>
    <!-- Ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Barra Lateral -->
        <aside class="sidebar">
            <div class="logo-container">
                <div class="logo">ALGEBRA RENOVA</div>
                <div class="motto">Revolution. Algebra et Perseverantia.</div>
            </div>

            <!-- Perfil do Usuário -->
            <div class="user-profile">
                <div class="avatar" id="userAvatar">
                    <span>AR</span>
                </div>
                <div class="user-info" id="userInfo">
                    <h3 id="userName">Anônimo</h3>
                    <p id="userSpecialty">Não especializado</p>
                    <p id="userLevel">Nível: Desconhecido</p>
                </div>
            </div>

            <!-- Navegação -->
            <div class="nav-tabs">
                <button class="tab-btn active" data-tab="home">
                    <i class="fas fa-home"></i> Home
                </button>
                <button class="tab-btn" data-tab="theories">
                    <i class="fas fa-atom"></i> Teorias
                </button>
                <button class="tab-btn" data-tab="members">
                    <i class="fas fa-users"></i> Membros
                </button>
                <button class="tab-btn" data-tab="profile">
                    <i class="fas fa-user-edit"></i> Perfil
                </button>
                <button class="tab-btn" data-tab="chat">
                    <i class="fas fa-comments"></i> Chat
                </button>
            </div>

            <!-- Lista de Amigos -->
            <div class="friends-section">
                <div class="section-title">
                    <span>Contactos Diretos</span>
                    <span id="friendsCount">0</span>
                </div>
                <div class="friends-list" id="friendsList">
                    <!-- Lista de amigos será preenchida via JS -->
                    <div class="friend-item" style="justify-content: center; color: var(--text-secondary);">
                        Nenhum contacto ainda
                    </div>
                </div>
            </div>

            <!-- Logout -->
            <button class="btn btn-secondary" id="logoutBtn" style="margin-top: 20px;">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </aside>

        <!-- Conteúdo Principal -->
        <main class="main-content">
            <!-- Home -->
            <div class="tab-content active" id="homeContent">
                <div class="page-header">
                    <h1 class="page-title">Algebra Renova</h1>
                    <button class="btn btn-primary" id="newTheoryBtn">
                        <i class="fas fa-plus"></i> Nova Teoria
                    </button>
                </div>
                
                <div class="content-card">
                    <h2 class="card-title">Bem-vindo à Revolução</h2>
                    <div class="card-date">Sistema Online</div>
                    <div class="theory-content">
                        <p>"Algebra Renova é mais do que um grupo de pesquisa. É uma rebelião matemática. Uma revolução intelectual. Uma reconstrução dos próprios fundamentos do pensamento estrutural e algébrico."</p>
                        <p>Aqui, desenvolvemos novas teorias rigorosas e fundamos subcampos dentro da álgebra e matemática abstrata que a própria matemática não consegue tratar mesmo com áreas técnicas.</p>
                        <p>Se você sente que a matemática que conhece é apenas a casca de algo muito mais profundo, Algebra Renova te chama.</p>
                        
                        <div style="margin-top: 20px; padding: 15px; background-color: rgba(0, 0, 0, 0.3); border-radius: 8px; border-left: 3px solid var(--accent-neon);">
                            <h3 style="margin-bottom: 10px; color: var(--accent-neon);">Estatísticas da Plataforma</h3>
                            <div style="display: flex; gap: 20px;">
                                <div>
                                    <h4 id="totalMembers">0</h4>
                                    <p style="font-size: 14px; color: var(--text-secondary);">Membros</p>
                                </div>
                                <div>
                                    <h4 id="totalTheories">0</h4>
                                    <p style="font-size: 14px; color: var(--text-secondary);">Teorias</p>
                                </div>
                                <div>
                                    <h4 id="totalMessages">0</h4>
                                    <p style="font-size: 14px; color: var(--text-secondary);">Mensagens</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-card">
                    <h2 class="card-title">Últimas Teorias</h2>
                    <div id="recentTheories">
                        <!-- Teorias recentes serão carregadas aqui -->
                    </div>
                </div>
            </div>

            <!-- Teorias -->
            <div class="tab-content" id="theoriesContent">
                <div class="page-header">
                    <h1 class="page-title">Repositório de Teorias</h1>
                    <button class="btn btn-primary" id="newTheoryBtn2">
                        <i class="fas fa-plus"></i> Nova Teoria
                    </button>
                </div>
                
                <div id="theoriesList">
                    <!-- Lista de teorias será preenchida via JS -->
                </div>
            </div>

            <!-- Membros -->
            <div class="tab-content" id="membersContent">
                <div class="page-header">
                    <h1 class="page-title">Membros da Comunidade</h1>
                    <div style="color: var(--text-secondary); font-size: 14px;">
                        <span id="onlineMembers">0</span> online
                    </div>
                </div>
                
                <div class="members-grid" id="membersGrid">
                    <!-- Membros serão carregados aqui -->
                </div>
            </div>

            <!-- Perfil -->
            <div class="tab-content" id="profileContent">
                <div class="page-header">
                    <h1 class="page-title">Perfil</h1>
                </div>
                
                <div class="content-card">
                    <h2 class="card-title">Editar Perfil</h2>
                    <form id="profileForm">
                        <div class="form-group">
                            <label class="form-label" for="codename">Codinome Simbólico</label>
                            <input type="text" id="codename" class="form-input" placeholder="Ex: 'Transfunctor' ou 'Anti-Identidade'">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="specialty">Especialidade Matemática</label>
                            <input type="text" id="specialty" class="form-input" placeholder="Ex: 'Topologia Algébrica' ou 'Teoria das Categorias'">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="level">Nível na Hierarquia</label>
                            <select id="level" class="form-input">
                                <option value="initiate">Iniciado</option>
                                <option value="core">Núcleo</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelProfileBtn">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Chat -->
            <div class="tab-content" id="chatContent">
                <div class="page-header">
                    <h1 class="page-title">Chat Privado</h1>
                </div>
                
                <div id="chatSelection" class="content-card">
                    <h2 class="card-title">Selecione um contacto para conversar</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Clique em um amigo da lista à esquerda para iniciar uma conversa</p>
                    <div id="chatPlaceholder" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>Nenhuma conversa selecionada</p>
                    </div>
                </div>
                
                <div id="chatContainer" class="chat-container" style="display: none;">
                    <!-- Chat será carregado aqui -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para Nova Teoria -->
    <div class="modal" id="theoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Teoria Matemática</h2>
                <button class="close-btn" id="closeTheoryModal">&times;</button>
            </div>
            <form id="theoryForm">
                <div class="form-group">
                    <label class="form-label" for="theoryTitle">Título da Teoria</label>
                    <input type="text" id="theoryTitle" class="form-input" placeholder="Ex: 'Teoria da Transfunctoração'">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="theoryContent">Conteúdo (LaTeX suportado)</label>
                    <textarea id="theoryContent" class="form-textarea" placeholder="Escreva sua teoria aqui... Use $$...$$ para fórmulas LaTeX"></textarea>
                    
                    <div class="latex-preview">
                        <div class="latex-preview-title">Pré-visualização LaTeX:</div>
                        <div id="latexPreview"></div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelTheoryBtn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Publicar Teoria</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Login -->
    <div class="modal active" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Algebra Renova - Acesso</h2>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="username">Nome de Usuário</label>
                    <input type="text" id="username" class="form-input" placeholder="Digite seu nome de usuário" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="userEmail">Email</label>
                    <input type="email" id="userEmail" class="form-input" placeholder="seu@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="initialLevel">Nível Inicial</label>
                    <select id="initialLevel" class="form-input">
                        <option value="initiate">Iniciado</option>
                        <option value="core">Núcleo</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Entrar na Revolução</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ============================================
        // ESTADO GLOBAL DA APLICAÇÃO
        // ============================================
        const AppState = {
            currentUser: null,
            allMembers: [],
            theories: [],
            privateMessages: {},
            
            // Inicializar estado
            init() {
                this.loadState();
                
                // Se não houver usuários, criar alguns de exemplo
                if (this.allMembers.length === 0) {
                    this.createSampleData();
                }
                
                // Se não houver teorias, criar algumas de exemplo
                if (this.theories.length === 0) {
                    this.createSampleTheories();
                }
                
                this.updateUI();
            },
            
            // Carregar estado do localStorage
            loadState() {
                try {
                    const savedState = localStorage.getItem('algebraRenovaState');
                    if (savedState) {
                        const parsed = JSON.parse(savedState);
                        this.currentUser = parsed.currentUser;
                        this.allMembers = parsed.allMembers || [];
                        this.theories = parsed.theories || [];
                        this.privateMessages = parsed.privateMessages || {};
                    }
                } catch (e) {
                    console.error('Erro ao carregar estado:', e);
                }
            },
            
            // Salvar estado no localStorage
            saveState() {
                try {
                    const state = {
                        currentUser: this.currentUser,
                        allMembers: this.allMembers,
                        theories: this.theories,
                        privateMessages: this.privateMessages
                    };
                    localStorage.setItem('algebraRenovaState', JSON.stringify(state));
                } catch (e) {
                    console.error('Erro ao salvar estado:', e);
                }
            },
            
            // Criar dados de exemplo
            createSampleData() {
                const sampleMembers = [
                    {
                        id: '1',
                        username: 'Transfunctor',
                        email: 'transfunctor@algebrarenova.com',
                        codename: 'Transfunctor',
                        specialty: 'Teoria das Categorias',
                        level: 'core',
                        avatar: 'TR',
                        friends: [],
                        online: true
                    },
                    {
                        id: '2',
                        username: 'AntiIdentidade',
                        email: 'anti@algebrarenova.com',
                        codename: 'Anti-Identidade',
                        specialty: 'Álgebra Não-Associativa',
                        level: 'core',
                        avatar: 'AI',
                        friends: [],
                        online: true
                    },
                    {
                        id: '3',
                        username: 'Borboleta',
                        email: 'borboleta@algebrarenova.com',
                        codename: 'Borboleta Metamórfica',
                        specialty: 'Topologia Algébrica',
                        level: 'initiate',
                        avatar: 'BM',
                        friends: [],
                        online: false
                    },
                    {
                        id: '4',
                        username: 'EspadaOlho',
                        email: 'espada@algebrarenova.com',
                        codename: 'Espada do Olho Chorão',
                        specialty: 'Lógica Não-Clássica',
                        level: 'initiate',
                        avatar: 'EO',
                        friends: [],
                        online: true
                    }
                ];
                
                this.allMembers = sampleMembers;
                this.saveState();
            },
            
            // Criar teorias de exemplo
            createSampleTheories() {
                const sampleTheories = [
                    {
                        id: '1',
                        title: 'Teoria da Transfunctoração',
                        content: `A transfunctoração é o processo pelo qual uma estrutura algébrica emerge em outro domínio com regras totalmente novas. 

                        Seja $\\mathcal{C}$ uma categoria. Um transfunctor $\\mathcal{T}: \\mathcal{C} \\rightarrow \\mathcal{D}$ não é simplesmente um functor, mas uma transformação radical que obedece a:

                        $$
                        \\mathcal{T}(f \\circ g) = \\mathcal{T}(f) \\star \\mathcal{T}(g)
                        $$

                        onde $\\star$ é uma operação não convencional definida no contexto de $\\mathcal{D}$.

                        Esta teoria permite a construção de espaços onde identidades tradicionais como $a \\cdot a^{-1} = 1$ são substituídas por anti-identidades do tipo:
                        
                        $$
                        a \\dagger a^{\\sharp} = \\varepsilon(a)
                        $$

                        onde $\\varepsilon$ é um operador de deformação categórica.`,
                        authorId: '1',
                        authorName: 'Transfunctor',
                        date: '2023-10-15',
                        likes: 12
                    },
                    {
                        id: '2',
                        title: 'Álgebra dos Espaços Anti-Identitários',
                        content: `Exploramos estruturas onde o elemento identidade não existe, mas é substituído por uma família de pseudo-identidades que dependem do contexto operacional.

                        Definição: Um espaço anti-identitário é uma tripla $(A, \\bullet, \\Phi)$ onde:
                        - $A$ é um conjunto
                        - $\\bullet: A \\times A \\rightarrow A$ é uma operação binária
                        - $\\Phi: A \\rightarrow \\mathcal{P}(A)$ associa a cada elemento um conjunto de pseudo-identidades

                        A condição fundamental é:
                        $$
                        \\forall a \\in A, \\exists \\phi \\in \\Phi(a) : a \\bullet \\phi = \\phi \\bullet a = a
                        $$

                        Porém, $\\phi$ não é único e pode não pertencer a $\\Phi(b)$ para $b \\neq a$.

                        Esta estrutura desafia o Teorema de Cayley e exige uma reformulação completa da teoria de grupos.`,
                        authorId: '2',
                        authorName: 'Anti-Identidade',
                        date: '2023-10-10',
                        likes: 8
                    }
                ];
                
                this.theories = sampleTheories;
                this.saveState();
            },
            
            // Atualizar a interface com base no estado
            updateUI() {
                this.updateUserProfile();
                this.updateFriendsList();
                this.updateMembersList();
                this.updateTheoriesList();
                this.updateStats();
            },
            
            // Atualizar perfil do usuário
            updateUserProfile() {
                if (!this.currentUser) return;
                
                const userAvatar = document.getElementById('userAvatar');
                const userInfo = document.getElementById('userInfo');
                const userName = document.getElementById('userName');
                const userSpecialty = document.getElementById('userSpecialty');
                const userLevel = document.getElementById('userLevel');
                
                // Atualizar avatar com classe de nível
                userAvatar.className = `avatar ${this.currentUser.level}`;
                userAvatar.innerHTML = `<span>${this.currentUser.avatar}</span>`;
                
                // Atualizar informações do usuário
                userName.textContent = this.currentUser.codename || this.currentUser.username;
                userSpecialty.textContent = this.currentUser.specialty || 'Não especializado';
                userLevel.textContent = `Nível: ${this.currentUser.level === 'core' ? 'Núcleo' : 'Iniciado'}`;
                
                // Aplicar classe de nível ao contêiner de informações
                userInfo.className = `user-info ${this.currentUser.level}`;
                
                // Se for nível Núcleo, adicionar efeito de pulso
                if (this.currentUser.level === 'core') {
                    userAvatar.classList.add('pulse');
                } else {
                    userAvatar.classList.remove('pulse');
                }
            },
            
            // Atualizar lista de amigos
            updateFriendsList() {
                if (!this.currentUser) return;
                
                const friendsList = document.getElementById('friendsList');
                const friendsCount = document.getElementById('friendsCount');
                
                if (!friendsList) return;
                
                friendsList.innerHTML = '';
                
                if (this.currentUser.friends && this.currentUser.friends.length > 0) {
                    friendsCount.textContent = this.currentUser.friends.length;
                    
                    this.currentUser.friends.forEach(friendId => {
                        const friend = this.allMembers.find(m => m.id === friendId);
                        if (friend) {
                            const friendItem = document.createElement('div');
                            friendItem.className = 'friend-item';
                            friendItem.dataset.friendId = friend.id;
                            friendItem.innerHTML = `
                                <div class="friend-avatar">${friend.avatar}</div>
                                <div class="friend-name">${friend.codename || friend.username}</div>
                            `;
                            
                            friendItem.addEventListener('click', () => this.openChat(friend));
                            friendsList.appendChild(friendItem);
                        }
                    });
                } else {
                    friendsCount.textContent = '0';
                    friendsList.innerHTML = `
                        <div class="friend-item" style="justify-content: center; color: var(--text-secondary);">
                            Nenhum contacto ainda
                        </div>
                    `;
                }
            },
            
            // Atualizar lista de membros
            updateMembersList() {
                const membersGrid = document.getElementById('membersGrid');
                const onlineMembers = document.getElementById('onlineMembers');
                
                if (!membersGrid) return;
                
                membersGrid.innerHTML = '';
                
                // Contar membros online
                const onlineCount = this.allMembers.filter(m => m.online).length;
                if (onlineMembers) onlineMembers.textContent = onlineCount;
                
                this.allMembers.forEach(member => {
                    // Não mostrar o usuário atual na lista
                    if (this.currentUser && member.id === this.currentUser.id) return;
                    
                    const isFriend = this.currentUser && 
                                    this.currentUser.friends && 
                                    this.currentUser.friends.includes(member.id);
                    
                    const memberCard = document.createElement('div');
                    memberCard.className = 'member-card';
                    memberCard.innerHTML = `
                        <div class="member-header">
                            <div class="member-avatar ${member.level}">${member.avatar}</div>
                            <div class="member-info">
                                <h4>${member.codename || member.username}</h4>
                                <p>${member.specialty || 'Matemática Geral'}</p>
                                <p style="font-size: 12px;">
                                    <i class="fas fa-circle" style="color: ${member.online ? '#2ecc71' : '#e74c3c'}; font-size: 10px;"></i>
                                    ${member.online ? 'Online' : 'Offline'}
                                </p>
                            </div>
                        </div>
                        <div class="member-actions">
                            <button class="add-friend-btn ${isFriend ? 'added' : ''}" data-member-id="${member.id}">
                                <i class="fas fa-${isFriend ? 'check' : 'plus'}"></i>
                                ${isFriend ? 'Contacto Adicionado' : 'Adicionar Contacto'}
                            </button>
                        </div>
                    `;
                    
                    membersGrid.appendChild(memberCard);
                });
                
                // Adicionar event listeners aos botões de adicionar amigo
                document.querySelectorAll('.add-friend-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const memberId = e.currentTarget.dataset.memberId;
                        this.addFriend(memberId);
                    });
                });
            },
            
            // Atualizar lista de teorias
            updateTheoriesList() {
                const theoriesList = document.getElementById('theoriesList');
                const recentTheories = document.getElementById('recentTheories');
                
                if (theoriesList) {
                    theoriesList.innerHTML = '';
                    
                    if (this.theories.length === 0) {
                        theoriesList.innerHTML = `
                            <div class="content-card">
                                <h3 class="card-title">Nenhuma teoria publicada ainda</h3>
                                <p style="color: var(--text-secondary);">Seja o primeiro a publicar uma teoria revolucionária!</p>
                            </div>
                        `;
                    } else {
                        // Ordenar por data (mais recentes primeiro)
                        const sortedTheories = [...this.theories].sort((a, b) => new Date(b.date) - new Date(a.date));
                        
                        sortedTheories.forEach(theory => {
                            const author = this.allMembers.find(m => m.id === theory.authorId);
                            const theoryCard = document.createElement('div');
                            theoryCard.className = 'content-card';
                            theoryCard.innerHTML = `
                                <div class="card-header">
                                    <h3 class="card-title">${theory.title}</h3>
                                    <div class="card-date">${theory.date}</div>
                                </div>
                                <div class="card-author">
                                    <div class="author-avatar">${author ? author.avatar : 'AR'}</div>
                                    <div class="author-info">
                                        <h4>${theory.authorName}</h4>
                                        <p>${author ? author.specialty : 'Pesquisador Algebra Renova'}</p>
                                    </div>
                                </div>
                                <div class="theory-content">
                                    ${this.formatTheoryContent(theory.content)}
                                </div>
                                <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                                    <button class="btn btn-secondary" style="padding: 5px 15px;">
                                        <i class="fas fa-heart"></i> ${theory.likes || 0}
                                    </button>
                                    <div style="color: var(--text-secondary); font-size: 14px;">
                                        Teoria ID: ${theory.id}
                                    </div>
                                </div>
                            `;
                            
                            theoriesList.appendChild(theoryCard);
                        });
                    }
                }
                
                // Atualizar teorias recentes na home
                if (recentTheories) {
                    recentTheories.innerHTML = '';
                    
                    // Pegar as 3 teorias mais recentes
                    const recent = [...this.theories]
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 3);
                    
                    if (recent.length === 0) {
                        recentTheories.innerHTML = `
                            <p style="color: var(--text-secondary); text-align: center; padding: 20px;">
                                Nenhuma teoria publicada ainda
                            </p>
                        `;
                    } else {
                        recent.forEach(theory => {
                            const author = this.allMembers.find(m => m.id === theory.authorId);
                            const theoryItem = document.createElement('div');
                            theoryItem.className = 'content-card';
                            theoryItem.style.padding = '15px';
                            theoryItem.style.marginBottom = '15px';
                            theoryItem.innerHTML = `
                                <h3 style="font-size: 18px; margin-bottom: 10px;">${theory.title}</h3>
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div class="author-avatar" style="width: 30px; height: 30px; font-size: 12px;">${author ? author.avatar : 'AR'}</div>
                                    <div style="margin-left: 10px;">
                                        <div style="font-size: 14px;">${theory.authorName}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">${theory.date}</div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 14px; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                    ${theory.content.replace(/[#*`$]/g, '').substring(0, 150)}...
                                </p>
                            `;
                            
                            recentTheories.appendChild(theoryItem);
                        });
                    }
                }
                
                // Renderizar LaTeX após atualizar as teorias
                setTimeout(() => {
                    if (window.MathJax) {
                        window.MathJax.typeset();
                    }
                }, 100);
            },
            
            // Formatar conteúdo da teoria (converter LaTeX)
            formatTheoryContent(content) {
                // Converter quebras de linha para <p>
                let formatted = content.split('\n\n').map(paragraph => {
                    if (paragraph.trim() === '') return '';
                    return `<p>${paragraph}</p>`;
                }).join('');
                
                return formatted;
            },
            
            // Atualizar estatísticas
            updateStats() {
                const totalMembers = document.getElementById('totalMembers');
                const totalTheories = document.getElementById('totalTheories');
                const totalMessages = document.getElementById('totalMessages');
                
                if (totalMembers) totalMembers.textContent = this.allMembers.length;
                if (totalTheories) totalTheories.textContent = this.theories.length;
                
                // Calcular total de mensagens
                let messageCount = 0;
                Object.values(this.privateMessages).forEach(conversation => {
                    messageCount += conversation.length;
                });
                
                if (totalMessages) totalMessages.textContent = messageCount;
            },
            
            // ============================================
            // FUNÇÕES PRINCIPAIS
            // ============================================
            
            // Manipular login
            handleLogin(username, email, level) {
                // Verificar se o usuário já existe
                let user = this.allMembers.find(m => 
                    m.username === username || m.email === email
                );
                
                if (user) {
                    // Usuário existe, fazer login
                    this.currentUser = user;
                    user.online = true;
                } else {
                    // Criar novo usuário
                    const userId = Date.now().toString();
                    user = {
                        id: userId,
                        username: username,
                        email: email,
                        codename: username,
                        specialty: 'Matemática Geral',
                        level: level,
                        avatar: this.generateAvatar(username),
                        friends: [],
                        online: true
                    };
                    
                    this.allMembers.push(user);
                    this.currentUser = user;
                }
                
                this.saveState();
                this.updateUI();
                
                // Fechar modal de login
                document.getElementById('loginModal').classList.remove('active');
                
                // Mostrar mensagem de boas-vindas
                this.showNotification(`Bem-vindo, ${user.codename}! A revolução aguarda.`);
            },
            
            // Alternar entre abas
            switchTab(tabName) {
                // Esconder todas as abas
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Remover classe active de todos os botões
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Mostrar aba selecionada
                const tabContent = document.getElementById(`${tabName}Content`);
                if (tabContent) {
                    tabContent.classList.add('active');
                }
                
                // Ativar botão correspondente
                const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
                if (tabBtn) {
                    tabBtn.classList.add('active');
                }
                
                // Se for a aba de chat, garantir que o chat esteja limpo
                if (tabName === 'chat') {
                    document.getElementById('chatSelection').style.display = 'block';
                    document.getElementById('chatContainer').style.display = 'none';
                }
            },
            
            // Adicionar amigo
            addFriend(memberId) {
                if (!this.currentUser) return;
                
                // Verificar se já é amigo
                if (this.currentUser.friends && this.currentUser.friends.includes(memberId)) {
                    this.showNotification('Este membro já está na sua lista de contactos.');
                    return;
                }
                
                // Adicionar à lista de amigos
                if (!this.currentUser.friends) {
                    this.currentUser.friends = [];
                }
                
                this.currentUser.friends.push(memberId);
                
                // Atualizar interface
                this.updateFriendsList();
                this.updateMembersList();
                
                // Salvar estado
                this.saveState();
                
                // Mostrar notificação
                const member = this.allMembers.find(m => m.id === memberId);
                this.showNotification(`${member.codename || member.username} adicionado aos seus contactos.`);
            },
            
            // Enviar mensagem
            sendMessage(friendId, messageText) {
                if (!this.currentUser || !messageText.trim()) return;
                
                // Criar ID da conversa (ordem alfabética dos IDs para garantir unicidade)
                const conversationId = [this.currentUser.id, friendId].sort().join('_');
                
                // Inicializar array de mensagens se não existir
                if (!this.privateMessages[conversationId]) {
                    this.privateMessages[conversationId] = [];
                }
                
                // Criar mensagem
                const message = {
                    id: Date.now().toString(),
                    senderId: this.currentUser.id,
                    receiverId: friendId,
                    text: messageText,
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                // Adicionar à conversa
                this.privateMessages[conversationId].push(message);
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface do chat
                this.updateChatMessages(friendId);
                
                // Rolagem para a última mensagem
                setTimeout(() => {
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                }, 100);
                
                return message;
            },
            
            // Salvar teoria
            saveTheory(title, content) {
                if (!this.currentUser || !title.trim() || !content.trim()) return;
                
                // Criar nova teoria
                const theory = {
                    id: Date.now().toString(),
                    title: title,
                    content: content,
                    authorId: this.currentUser.id,
                    authorName: this.currentUser.codename || this.currentUser.username,
                    date: new Date().toISOString().split('T')[0],
                    likes: 0
                };
                
                // Adicionar à lista de teorias
                this.theories.unshift(theory); // Adicionar no início
                
                // Salvar estado
                this.saveState();
                
                // Atualizar interface
                this.updateTheoriesList();
                this.updateStats();
                
                // Mostrar notificação
                this.showNotification('Teoria publicada com sucesso!');
                
                return theory;
            },
            
            // Abrir chat com um amigo
            openChat(friend) {
                // Mostrar container do chat
                document.getElementById('chatSelection').style.display = 'none';
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.style.display = 'flex';
                
                // Atualizar cabeçalho do chat
                chatContainer.innerHTML = `
                    <div class="chat-header">
                        <button class="chat-back-btn" id="chatBackBtn">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="chat-friend-info">
                            <h4>${friend.codename || friend.username}</h4>
                            <p>${friend.specialty || 'Matemática Geral'}</p>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <!-- Mensagens serão carregadas aqui -->
                    </div>
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Digite sua mensagem... (LaTeX: $$fórmula$$)">
                        <button class="send-btn" id="sendMessageBtn">
                            <i class="fas fa-paper-plane"></i> Enviar
                        </button>
                    </div>
                `;
                
                // Adicionar event listeners
                document.getElementById('chatBackBtn').addEventListener('click', () => {
                    document.getElementById('chatSelection').style.display = 'block';
                    chatContainer.style.display = 'none';
                });
                
                document.getElementById('sendMessageBtn').addEventListener('click', () => {
                    const input = document.getElementById('chatInput');
                    const message = input.value.trim();
                    
                    if (message) {
                        this.sendMessage(friend.id, message);
                        input.value = '';
                        input.focus();
                    }
                });
                
                document.getElementById('chatInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('sendMessageBtn').click();
                    }
                });
                
                // Carregar mensagens
                this.updateChatMessages(friend.id);
            },
            
            // Atualizar mensagens do chat
            updateChatMessages(friendId) {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;
                
                // Criar ID da conversa
                const conversationId = [this.currentUser.id, friendId].sort().join('_');
                const messages = this.privateMessages[conversationId] || [];
                
                chatMessages.innerHTML = '';
                
                if (messages.length === 0) {
                    chatMessages.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary); padding: 40px;">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px;"></i>
                            <p>Nenhuma mensagem ainda. Inicie a conversa!</p>
                        </div>
                    `;
                } else {
                    messages.forEach(msg => {
                        const isSent = msg.senderId === this.currentUser.id;
                        const time = new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        
                        const messageDiv = document.createElement('div');
                        messageDiv.className = `message ${isSent ? 'sent' : 'received'}`;
                        messageDiv.innerHTML = `
                            <div>${this.formatMessageText(msg.text)}</div>
                            <div class="message-time">${time}</div>
                        `;
                        
                        chatMessages.appendChild(messageDiv);
                    });
                    
                    // Rolagem para a última mensagem
                    setTimeout(() => {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 100);
                }
                
                // Renderizar LaTeX nas mensagens
                setTimeout(() => {
                    if (window.MathJax) {
                        window.MathJax.typeset([chatMessages]);
                    }
                }, 100);
            },
            
            // Formatar texto da mensagem (suporte a LaTeX)
            formatMessageText(text) {
                // Converter LaTeX inline
                let formatted = text.replace(/\$\$(.*?)\$\$/g, '\\[$1\\]');
                formatted = formatted.replace(/\$(.*?)\$/g, '\\($1\\)');
                
                return formatted;
            },
            
            // ============================================
            // FUNÇÕES AUXILIARES
            // ============================================
            
            // Gerar avatar a partir do nome
            generateAvatar(username) {
                if (!username) return 'AR';
                
                // Pegar as duas primeiras letras em maiúsculas
                const parts = username.split(' ');
                if (parts.length >= 2) {
                    return (parts[0][0] + parts[1][0]).toUpperCase();
                } else {
                    return username.substring(0, 2).toUpperCase();
                }
            },
            
            // Mostrar notificação
            showNotification(message) {
                // Criar elemento de notificação
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background-color: var(--card-bg);
                    color: var(--text-primary);
                    padding: 15px 25px;
                    border-radius: 8px;
                    border-left: 4px solid var(--accent-neon);
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                    z-index: 10000;
                    max-width: 300px;
                    animation: slideIn 0.3s, fadeOut 0.3s 2.7s;
                `;
                
                notification.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <i class="fas fa-info-circle" style="color: var(--accent-neon); margin-right: 10px;"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Remover após 3 segundos
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
                
                // Adicionar estilos de animação
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            },
            
            // Fazer logout
            logout() {
                if (this.currentUser) {
                    // Marcar como offline
                    const user = this.allMembers.find(m => m.id === this.currentUser.id);
                    if (user) user.online = false;
                    
                    this.currentUser = null;
                    this.saveState();
                    
                    // Mostrar modal de login
                    document.getElementById('loginModal').classList.add('active');
                    
                    // Resetar interface
                    this.updateUI();
                }
            }
        };

        // ============================================
        // INICIALIZAÇÃO DA APLICAÇÃO
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar estado da aplicação
            AppState.init();
            
            // Verificar se há usuário logado
            if (!AppState.currentUser) {
                document.getElementById('loginModal').classList.add('active');
            }
            
            // ============================================
            // EVENT LISTENERS
            // ============================================
            
            // Login
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value.trim();
                const email = document.getElementById('userEmail').value.trim();
                const level = document.getElementById('initialLevel').value;
                
                if (username && email) {
                    AppState.handleLogin(username, email, level);
                }
            });
            
            // Navegação por abas
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    AppState.switchTab(tabName);
                });
            });
            
            // Botão de nova teoria
            document.getElementById('newTheoryBtn').addEventListener('click', openTheoryModal);
            document.getElementById('newTheoryBtn2').addEventListener('click', openTheoryModal);
            
            // Modal de teoria
            document.getElementById('closeTheoryModal').addEventListener('click', closeTheoryModal);
            document.getElementById('cancelTheoryBtn').addEventListener('click', closeTheoryModal);
            
            // Formulário de teoria
            document.getElementById('theoryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const title = document.getElementById('theoryTitle').value.trim();
                const content = document.getElementById('theoryContent').value.trim();
                
                if (title && content) {
                    AppState.saveTheory(title, content);
                    closeTheoryModal();
                    AppState.switchTab('theories');
                }
            });
            
            // Pré-visualização LaTeX
            document.getElementById('theoryContent').addEventListener('input', function() {
                const preview = document.getElementById('latexPreview');
                const content = this.value;
                
                // Extrair fórmulas LaTeX
                const latexMatches = content.match(/\$\$.*?\$\$/g) || [];
                
                if (latexMatches.length > 0) {
                    let previewHTML = '';
                    latexMatches.forEach((formula, index) => {
                        previewHTML += `<div style="margin-bottom: 10px;">Fórmula ${index + 1}: ${formula}</div>`;
                    });
                    
                    preview.innerHTML = previewHTML;
                    
                    // Tentar renderizar o LaTeX
                    setTimeout(() => {
                        if (window.MathJax) {
                            window.MathJax.typeset([preview]);
                        }
                    }, 100);
                } else {
                    preview.innerHTML = '<div style="color: var(--text-secondary);">Nenhuma fórmula LaTeX detectada. Use $$...$$ para fórmulas.</div>';
                }
            });
            
            // Formulário de perfil
            document.getElementById('profileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const codename = document.getElementById('codename').value.trim();
                const specialty = document.getElementById('specialty').value.trim();
                const level = document.getElementById('level').value;
                
                if (AppState.currentUser) {
                    AppState.currentUser.codename = codename || AppState.currentUser.username;
                    AppState.currentUser.specialty = specialty || 'Matemática Geral';
                    AppState.currentUser.level = level;
                    AppState.currentUser.avatar = AppState.generateAvatar(codename || AppState.currentUser.username);
                    
                    AppState.saveState();
                    AppState.updateUI();
                    
                    AppState.showNotification('Perfil atualizado com sucesso!');
                    AppState.switchTab('home');
                }
            });
            
            // Botão cancelar perfil
            document.getElementById('cancelProfileBtn').addEventListener('click', function() {
                AppState.switchTab('home');
            });
            
            // Botão de logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                AppState.logout();
            });
            
            // ============================================
            // FUNÇÕES AUXILIARES DA INTERFACE
            // ============================================
            
            function openTheoryModal() {
                document.getElementById('theoryModal').classList.add('active');
                document.getElementById('theoryTitle').focus();
            }
            
            function closeTheoryModal() {
                document.getElementById('theoryModal').classList.remove('active');
                document.getElementById('theoryForm').reset();
                document.getElementById('latexPreview').innerHTML = '';
            }
            
            // Fechar modal ao clicar fora
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        if (this.id === 'loginModal') return; // Não fechar modal de login
                        this.classList.remove('active');
                    }
                });
            });
            
            // Preencher formulário de perfil com dados atuais
            document.querySelector('.tab-btn[data-tab="profile"]').addEventListener('click', function() {
                if (AppState.currentUser) {
                    document.getElementById('codename').value = AppState.currentUser.codename || AppState.currentUser.username;
                    document.getElementById('specialty').value = AppState.currentUser.specialty || '';
                    document.getElementById('level').value = AppState.currentUser.level || 'initiate';
                }
            });
            
            // Inicializar MathJax
            if (window.MathJax) {
                window.MathJax = {
                    tex: {
                        inlineMath: [['$', '$'], ['\\(', '\\)']],
                        displayMath: [['$$', '$$'], ['\\[', '\\]']]
                    },
                    options: {
                        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                    }
                };
            }
        });
    </script>
</body>
</html>
